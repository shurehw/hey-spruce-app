<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Portal - Hey Spruce</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            /* Layout Variables */
            --sidebar-width: 260px;
            --header-height: 60px;
            
            /* Portal Theme Colors - Client (Purple) */
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #e0e7ff;
            --secondary: #8b5cf6;
            --secondary-dark: #7c3aed;
            --secondary-light: #ede9fe;
            
            /* Status Colors */
            --success: #10b981;
            --success-light: #d1fae5;
            --warning: #f59e0b;
            --warning-light: #fed7aa;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --info: #3b82f6;
            --info-light: #dbeafe;
            
            /* Gray Scale */
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            
            /* Typography */
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            
            /* Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            
            /* Border Radius */
            --radius-sm: 4px;
            --radius-md: 6px;
            --radius-lg: 8px;
            --radius-xl: 12px;
            --radius-full: 9999px;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: white;
            color: var(--gray-900);
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }
        
        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: white;
            border-bottom: 1px solid var(--gray-200);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .header-logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .header-badge {
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .notification-icon {
            cursor: pointer;
            color: var(--gray-600);
            font-size: 1.25rem;
            position: relative;
        }
        
        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        /* User Dropdown */
        .user-dropdown {
            position: relative;
        }
        
        .user-dropdown-toggle {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            transition: background 0.2s;
            background: transparent;
            border: none;
            font-family: inherit;
            font-size: inherit;
        }
        
        .user-dropdown-toggle:hover {
            background: var(--gray-100);
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .user-name {
            font-weight: 500;
            color: var(--gray-900);
        }
        
        .dropdown-arrow {
            font-size: 0.625rem;
            color: var(--gray-600);
            transition: transform 0.2s;
        }
        
        .user-dropdown.active .dropdown-arrow {
            transform: rotate(180deg);
        }
        
        .user-dropdown-menu {
            position: absolute;
            top: calc(100% + 0.5rem);
            right: 0;
            background: white;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 240px;
            display: none;
            z-index: 1000;
        }
        
        .user-dropdown.active .user-dropdown-menu {
            display: block;
        }
        
        .dropdown-header {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .dropdown-company {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }
        
        .dropdown-email {
            font-size: 0.875rem;
            color: var(--gray-600);
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: var(--gray-700);
            text-decoration: none;
            transition: background 0.2s;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 0.875rem;
        }
        
        .dropdown-item:hover {
            background: var(--gray-50);
        }
        
        .dropdown-item-icon {
            width: 1.25rem;
            color: var(--gray-600);
        }
        
        .dropdown-divider {
            height: 1px;
            background: var(--gray-200);
            margin: 0;
        }
        
        /* Layout */
        .app-container {
            display: flex;
            min-height: 100vh;
            background: white;
            padding-top: 60px;
        }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            border-right: 1px solid var(--gray-200);
            display: flex;
            flex-direction: column;
            position: fixed;
            left: 0;
            top: 60px;
            height: calc(100vh - 60px);
            z-index: 50;
        }
        
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            color: var(--gray-900);
        }
        
        .logo img {
            height: 32px;
        }
        
        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
        }
        
        .portal-badge {
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: auto;
        }
        
        .sidebar-nav {
            flex: 1;
            padding: 1rem 0;
            overflow-y: auto;
        }
        
        .sidebar-section {
            margin-bottom: 2rem;
        }
        
        .sidebar-title {
            padding: 0 1.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--gray-500);
            letter-spacing: 0.05em;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 1.5rem;
            color: var(--gray-700);
            text-decoration: none;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .nav-item:hover {
            background: var(--gray-50);
            color: var(--primary);
        }
        
        .nav-item.active {
            background: var(--primary-light);
            color: var(--primary);
            font-weight: 500;
            position: relative;
        }
        
        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--primary);
        }
        
        .nav-item .icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            margin-top: 60px;
            padding: 0.25rem 2rem;
            overflow-y: auto;
            min-height: calc(100vh - 60px);
            background: white;
        }
        
        /* Header Bar */
        .header-bar {
            background: white;
            padding: 0.25rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .header-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .notification-btn {
            position: relative;
            background: none;
            border: none;
            padding: 0.5rem;
            cursor: pointer;
            color: var(--gray-600);
        }
        
        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--danger);
            color: white;
            font-size: 0.625rem;
            padding: 0.125rem 0.375rem;
            border-radius: 9999px;
            min-width: 18px;
            text-align: center;
        }
        
        .user-menu {
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            background: var(--gray-50);
            border-radius: 8px;
            cursor: pointer;
        }
        
        .user-menu:hover {
            background: var(--gray-100);
        }
        
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--gray-200);
            padding: 0.5rem 0;
            min-width: 200px;
            z-index: 1000;
            display: none;
        }
        
        .user-dropdown.show {
            display: block;
        }
        
        .dropdown-item {
            display: block;
            width: 100%;
            padding: 0.5rem 1rem;
            text-align: left;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            color: var(--gray-700);
            text-decoration: none;
        }
        
        .dropdown-item:hover {
            background: var(--gray-50);
            color: var(--gray-900);
        }
        
        .dropdown-divider {
            height: 1px;
            background: var(--gray-200);
            margin: 0.25rem 0;
        }
        
        .location-selector {
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: white;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            cursor: pointer;
            min-width: 250px;
        }
        
        .location-selector:hover {
            border-color: var(--gray-400);
        }
        
        .location-selector .location-icon {
            color: var(--gray-500);
        }
        
        .location-selector .location-name {
            flex: 1;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-900);
        }
        
        .location-selector .location-type {
            font-size: 0.75rem;
            color: var(--gray-500);
        }
        
        .location-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--gray-200);
            margin-top: 0.5rem;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        .location-dropdown.show {
            display: block;
        }
        
        .location-group {
            padding: 0.5rem 0;
        }
        
        .location-group-title {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray-500);
            text-transform: uppercase;
        }
        
        .location-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .location-item:hover {
            background: var(--gray-50);
        }
        
        .location-item.selected {
            background: var(--primary-light);
        }
        
        .location-item .location-details {
            flex: 1;
        }
        
        .location-item .location-name {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-900);
        }
        
        .location-item .location-address {
            font-size: 0.75rem;
            color: var(--gray-500);
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        /* Cards and Containers */
        .dashboard-grid, .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .stat-card {
            background: white;
            padding: 0.75rem;
            border-radius: 6px;
            border: 1px solid var(--gray-200);
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .stat-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.125rem;
            line-height: 1.2;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: var(--gray-600);
            margin-bottom: 0.25rem;
            line-height: 1.3;
        }
        
        .stat-trend {
            font-size: 0.75rem;
            color: var(--gray-500);
        }
        
        .stat-trend.positive {
            color: var(--success);
        }
        
        .stat-trend.negative {
            color: var(--danger);
        }
        
        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .action-card {
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: var(--gray-900);
        }
        
        .action-card:hover {
            border-color: var(--primary);
            background: var(--primary-light);
            transform: translateY(-2px);
        }
        
        .action-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 1rem;
            background: var(--primary-light);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }
        
        .action-card:hover .action-icon {
            background: var(--primary);
            color: white;
        }
        
        .action-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .action-description {
            font-size: 0.875rem;
            color: var(--gray-600);
        }
        
        /* Tables */
        .table-container {
            background: white;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
            overflow: hidden;
            margin-bottom: 1rem;
        }
        
        .table-header {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-title {
            font-size: 1rem;
            font-weight: 600;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            text-align: left;
            padding: 0.75rem 1.5rem;
            background: var(--gray-50);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--gray-600);
            letter-spacing: 0.05em;
        }
        
        td {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--gray-200);
            color: var(--gray-700);
        }
        
        tr:hover {
            background: var(--gray-50);
        }
        
        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 0.125rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.625rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-badge.open {
            background: var(--info-light);
            color: var(--info);
        }
        
        .status-badge.in-progress {
            background: var(--warning-light);
            color: var(--warning);
        }
        
        .status-badge.completed {
            background: var(--success-light);
            color: var(--success);
        }
        
        .status-badge.pending {
            background: var(--secondary-light);
            color: var(--secondary);
        }
        
        .status-badge.urgent {
            background: var(--danger-light);
            color: var(--danger);
        }
        
        /* Buttons */
        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.875rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-secondary {
            background: white;
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }
        
        .btn-secondary:hover {
            background: var(--gray-50);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }
        
        .star-rating {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .star-rating:hover {
            color: #ffc107;
        }
        
        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-400);
            cursor: pointer;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.625rem;
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 0.875rem;
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            z-index: 10000;
        }
        
        .toast {
            background: white;
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-bottom: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        .toast.success {
            border-left: 4px solid var(--success);
        }
        
        .toast.error {
            border-left: 4px solid var(--danger);
        }
        
        .toast.warning {
            border-left: 4px solid var(--warning);
        }
        
        .toast.info {
            border-left: 4px solid var(--info);
        }
    </style>
    <script src="/common-header.js"></script>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left" style="display: flex; align-items: center; gap: 1rem;">
            <img src="https://cdn.prod.website-files.com/67edc7c78e3151d3b06686b2/681007b1b7f5a5cc527f1b94_Hey_SPRUCE_logo_font.png" alt="Hey Spruce" class="header-logo" style="height: 32px; width: auto;">
            <span class="header-badge">Client Portal</span>
        </div>
        
        <!-- Global Search -->
        <div class="header-search" style="flex: 1; max-width: 400px; margin: 0 2rem;">
            <div style="position: relative;">
                <input type="text" 
                       id="globalSearch" 
                       placeholder="Search work orders, locations, vendors..." 
                       style="width: 100%; padding: 0.5rem 0.75rem 0.5rem 2.5rem; border: 1px solid var(--gray-300); border-radius: 6px; font-size: 0.875rem;"
                       onkeyup="handleGlobalSearch(this.value)"
                       onkeydown="handleSearchKeydown(event)">
                <div style="position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: var(--gray-400); pointer-events: none;">
                    üîç
                </div>
                <div id="searchResults" class="search-results" style="position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid var(--gray-200); border-top: none; border-radius: 0 0 6px 6px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); z-index: 1000; display: none; max-height: 300px; overflow-y: auto;">
                    <!-- Search results will be populated here -->
                </div>
                <div style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); font-size: 0.75rem; color: var(--gray-400); pointer-events: none;">
                    Ctrl+K
                </div>
            </div>
        </div>
        
        <div class="header-right">
            <div class="notification-icon">
                üîî
                <span class="notification-badge">3</span>
            </div>
            <div class="user-dropdown" id="userDropdown">
                <button class="user-dropdown-toggle" onclick="toggleUserDropdown()">
                    <div class="user-avatar">NR</div>
                    <span class="user-name">Nice Restaurant Group</span>
                    <span class="dropdown-arrow">‚ñº</span>
                </button>
                <div class="user-dropdown-menu">
                    <div class="dropdown-header">
                        <div class="dropdown-company">Nice Restaurant Group</div>
                        <div class="dropdown-email">admin@nicerestaurant.com</div>
                    </div>
                    <a href="#" class="dropdown-item" onclick="loadSection('profile'); closeUserDropdown(); return false;">
                        <span class="dropdown-item-icon">üë§</span>
                        <span>Profile</span>
                    </a>
                    <a href="#" class="dropdown-item" onclick="loadSection('settings'); closeUserDropdown(); return false;">
                        <span class="dropdown-item-icon">‚öôÔ∏è</span>
                        <span>Settings</span>
                    </a>
                    <a href="#" class="dropdown-item" onclick="loadSection('team'); closeUserDropdown(); return false;">
                        <span class="dropdown-item-icon">üë•</span>
                        <span>Team Management</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item" onclick="alert('Logging out...'); return false;">
                        <span class="dropdown-item-icon">üö™</span>
                        <span>Sign Out</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-nav">
                <div class="sidebar-section">
                    <div class="sidebar-title">Main</div>
                    <a href="#dashboard" class="nav-item active" onclick="loadSection('dashboard')">
                        <span class="icon"></span>
                        Dashboard
                    </a>
                    <a href="#work-orders" class="nav-item" onclick="loadSection('work-orders')">
                        <span class="icon"></span>
                        Work Orders
                    </a>
                    <a href="#service-calendar" class="nav-item" onclick="loadSection('service-calendar')">
                        <span class="icon"></span>
                        Service Calendar
                    </a>
                    <a href="#quotes" class="nav-item" onclick="loadSection('quotes')">
                        <span class="icon"></span>
                        Quotes
                    </a>
                    <a href="#invoices" class="nav-item" onclick="loadSection('invoices')">
                        <span class="icon"></span>
                        Invoices
                    </a>
                </div>
                
                <div class="sidebar-section">
                    <div class="sidebar-title">Communication</div>
                    <a href="#messages" class="nav-item" onclick="loadSection('messages')">
                        <span class="icon">üí¨</span>
                        Messages
                        <span class="notification-badge" id="messagesBadge" style="background: var(--danger); color: white; font-size: 0.75rem; padding: 0.125rem 0.375rem; border-radius: 10px; margin-left: 0.5rem;">3</span>
                    </a>
                    <a href="#notifications" class="nav-item" onclick="loadSection('notifications')">
                        <span class="icon">üîî</span>
                        Notifications
                        <span class="notification-badge" id="notificationsBadge" style="background: var(--warning); color: white; font-size: 0.75rem; padding: 0.125rem 0.375rem; border-radius: 10px; margin-left: 0.5rem;">5</span>
                    </a>
                </div>
                
                <div class="sidebar-section">
                    <div class="sidebar-title">Properties</div>
                    <a href="#locations" class="nav-item" onclick="loadSection('locations')">
                        <span class="icon"></span>
                        Locations
                    </a>
                    <a href="#assets" class="nav-item" onclick="loadSection('assets')">
                        <span class="icon"></span>
                        Assets
                    </a>
                    <a href="#vendors" class="nav-item" onclick="loadSection('vendors')">
                        <span class="icon"></span>
                        Preferred Vendors
                    </a>
                    <a href="#documents" class="nav-item" onclick="loadSection('documents')">
                        <span class="icon"></span>
                        Documents
                    </a>
                </div>
                
                <div class="sidebar-section">
                    <div class="sidebar-title">Analytics</div>
                    <a href="#analytics" class="nav-item" onclick="loadSection('analytics')">
                        <span class="icon">üìä</span>
                        Cross-Portal Analytics
                    </a>
                    <a href="#reports" class="nav-item" onclick="loadSection('reports')">
                        <span class="icon"></span>
                        Reports
                    </a>
                    <a href="#spend-analysis" class="nav-item" onclick="loadSection('spend-analysis')">
                        <span class="icon"></span>
                        Spend Analysis
                    </a>
                </div>
            </div>
        </nav>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Breadcrumb Navigation -->
            <div id="breadcrumbContainer" style="padding: 0.5rem 20px 0;"></div>
            
            <div id="content">
                <!-- Content will be loaded here -->
            </div>
        </main>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>
    
    <!-- Advanced Features Script -->
    <script src="/scripts/advanced-features.js"></script>
    
    <script>
        // Initialize dashboard on load
        document.addEventListener('DOMContentLoaded', () => {
            loadSection('dashboard');
        });
        
        // User Dropdown Functions
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('active');
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function closeDropdown(e) {
                if (!dropdown.contains(e.target)) {
                    dropdown.classList.remove('active');
                    document.removeEventListener('click', closeDropdown);
                }
            });
            
            // Prevent the document click from immediately closing
            event.stopPropagation();
        }
        
        function closeUserDropdown() {
            document.getElementById('userDropdown').classList.remove('active');
        }
        
        function loadSection(section, param) {
            const content = document.getElementById('content');
            
            // Update active nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            const activeNav = document.querySelector(`[onclick="loadSection('${section}')"]`);
            if (activeNav) {
                activeNav.classList.add('active');
            }
            
            switch(section) {
                case 'dashboard':
                    content.innerHTML = getDashboardContent();
                    // Initialize role-based visibility after content loads
                    setTimeout(() => initializeRoleBasedVisibility(), 10);
                    break;
                case 'work-orders':
                    content.innerHTML = getWorkOrdersContent();
                    break;
                case 'service-calendar':
                    content.innerHTML = getServiceCalendarContent();
                    setTimeout(() => {
                        initializeServiceCalendar();
                    }, 100);
                    break;
                case 'quotes':
                    content.innerHTML = getQuotesContent();
                    break;
                case 'invoices':
                    content.innerHTML = getInvoicesContent();
                    break;
                case 'messages':
                    content.innerHTML = getMessagesContent();
                    break;
                case 'budget':
                    content.innerHTML = getBudgetContent();
                    break;
                case 'locations':
                    content.innerHTML = getLocationsContent();
                    break;
                case 'assets':
                    content.innerHTML = getAssetsContent();
                    break;
                case 'vendors':
                    content.innerHTML = getVendorsContent();
                    break;
                case 'documents':
                    content.innerHTML = getDocumentsContent();
                    break;
                case 'analytics':
                    content.innerHTML = getCrossPortalAnalyticsContent();
                    break;
                case 'reports':
                    content.innerHTML = getReportsContent();
                    break;
                case 'spend-analysis':
                    content.innerHTML = getSpendAnalysisContent();
                    break;
                case 'profile':
                    content.innerHTML = getProfileContent();
                    break;
                case 'settings':
                    content.innerHTML = getSettingsContent();
                    break;
                case 'team':
                    content.innerHTML = getTeamManagementContent();
                    break;
                case 'user-admin':
                    content.innerHTML = getUserAdminContent();
                    break;
                case 'notifications':
                    content.innerHTML = getNotificationsContent();
                    break;
                case 'billing':
                    content.innerHTML = getBillingContent();
                    break;
                case 'location-detail':
                    content.innerHTML = getLocationDetailContent(param);
                    break;
                default:
                    content.innerHTML = getDashboardContent();
            }
        }
        window.loadSection = loadSection;
        
        function getDashboardContent() {
            return `
                <!-- Dashboard Content without duplicate header -->
                <div style="padding: 0 2rem;">
                    <h1 class="header-title" style="font-size: 1.5rem; margin-bottom: 1rem; margin-top: 0;">Welcome back, McDonald's Corporation</h1>
                </div>
                
                <!-- Stats Overview -->
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-label">Open Work Orders</div>
                        <div class="stat-value">12</div>
                        <div class="stat-trend negative">3 urgent</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Pending Quotes</div>
                        <div class="stat-value">5</div>
                        <div class="stat-trend">Awaiting approval</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">This Month Spend</div>
                        <div class="stat-value">$24,567</div>
                        <div class="stat-trend positive">‚Üì 12% vs last month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Active Locations</div>
                        <div class="stat-value">8</div>
                        <div class="stat-trend">2 need attention</div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Quick Actions</h2>
                <div class="quick-actions">
                    <div class="action-card" onclick="showCreateWorkOrderModal()">
                        <div class="action-icon">‚ûï</div>
                        <div class="action-title">New Service Request</div>
                        <div class="action-description">Submit a new service request</div>
                    </div>
                    <div class="action-card" onclick="loadSection('quotes')">
                        <div class="action-icon" style="font-weight: bold;">OK</div>
                        <div class="action-title">Review Quotes</div>
                        <div class="action-description">5 pending approval</div>
                    </div>
                    <div class="action-card" onclick="loadSection('invoices')">
                        <div class="action-icon" style="font-weight: bold;">$</div>
                        <div class="action-title">Pay Invoices</div>
                        <div class="action-description">3 outstanding</div>
                    </div>
                    <div class="action-card" onclick="loadSection('reports')">
                        <div class="action-icon" style="font-weight: bold;">R</div>
                        <div class="action-title">View Reports</div>
                        <div class="action-description">Analytics & insights</div>
                    </div>
                </div>
                
                <!-- Recent Work Orders -->
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Recent Work Orders</h3>
                        <button class="btn btn-secondary" onclick="loadSection('work-orders')">View All</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>WO #</th>
                                <th>Location</th>
                                <th>Issue</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Vendor</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>#WO-2024-001</strong></td>
                                <td>McDonald's - Sunset</td>
                                <td>HVAC Not Cooling</td>
                                <td><span class="status-badge urgent">Urgent</span></td>
                                <td><span class="status-badge in-progress">In Progress</span></td>
                                <td>ABC Maintenance</td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="viewWorkOrder('WO-2024-001')">View</button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>#WO-2024-002</strong></td>
                                <td>Burger King - Melrose</td>
                                <td>Plumbing Leak</td>
                                <td><span class="status-badge">Standard</span></td>
                                <td><span class="status-badge pending">Scheduled</span></td>
                                <td>XYZ Plumbing</td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="viewWorkOrder('WO-2024-002')">View</button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>#WO-2024-003</strong></td>
                                <td>Delilah LA</td>
                                <td>Electrical Issue</td>
                                <td><span class="status-badge">Standard</span></td>
                                <td><span class="status-badge open">Open</span></td>
                                <td>-</td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="viewWorkOrder('WO-2024-003')">View</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        function getServiceCalendarContent() {
            return `
                <div class="header-bar">
                    <h1 class="header-title">Service Calendar</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="loadSection('work-orders')">List View</button>
                        <button class="btn btn-secondary" onclick="showPreventativeMaintenanceModal()">+ Preventative Maintenance</button>
                        <button class="btn btn-primary" onclick="showCreateWorkOrderModal()">+ Request Service</button>
                    </div>
                </div>

                <!-- Client Service Info - Compact Horizontal Tiles -->
                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 150px; background: white; border: 1px solid var(--gray-200); border-radius: 8px; padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.75rem;">
                        <div style="font-size: 1.25rem; font-weight: bold;">S</div>
                        <div>
                            <div style="font-size: 1rem; font-weight: 600; color: var(--gray-900);" id="nextServiceDate">Aug 28</div>
                            <div style="font-size: 0.75rem; color: var(--gray-500);">Next Service</div>
                        </div>
                    </div>
                    <div style="flex: 1; min-width: 150px; background: white; border: 1px solid var(--gray-200); border-radius: 8px; padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.75rem;">
                        <div style="font-size: 1.25rem; font-weight: bold;">R</div>
                        <div>
                            <div style="font-size: 1rem; font-weight: 600; color: var(--gray-900);">Monthly</div>
                            <div style="font-size: 0.75rem; color: var(--gray-500);">Service Type</div>
                        </div>
                    </div>
                    <div style="flex: 1; min-width: 150px; background: white; border: 1px solid var(--gray-200); border-radius: 8px; padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.75rem;">
                        <div style="font-size: 1.25rem; font-weight: bold;">C</div>
                        <div>
                            <div style="font-size: 1rem; font-weight: 600; color: var(--gray-900);">3</div>
                            <div style="font-size: 0.75rem; color: var(--gray-500);">Completed This Month</div>
                        </div>
                    </div>
                    <div style="flex: 1; min-width: 150px; background: white; border: 1px solid var(--gray-200); border-radius: 8px; padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.75rem;">
                        <div style="font-size: 1.25rem; font-weight: bold;">P</div>
                        <div>
                            <div style="font-size: 1rem; font-weight: 600; color: var(--gray-900);">2</div>
                            <div style="font-size: 0.75rem; color: var(--gray-500);">Upcoming Services</div>
                        </div>
                    </div>
                </div>

                <!-- Calendar Controls -->
                <div class="table-container" style="margin-bottom: 1rem;">
                    <div class="table-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                        <h3 class="table-title">Calendar View</h3>
                        <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                            <select id="calendarView" onchange="changeServiceCalendarView()" style="padding: 0.5rem; border: 1px solid var(--gray-300); border-radius: 6px;">
                                <option value="month">Month</option>
                                <option value="week">Week</option>
                                <option value="list">List View</option>
                            </select>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-secondary" onclick="previousServicePeriod()" style="padding: 0.5rem 1rem;">‚Äπ</button>
                                <button class="btn btn-secondary" onclick="nextServicePeriod()" style="padding: 0.5rem 1rem;">‚Ä∫</button>
                                <button class="btn btn-secondary" onclick="goToServiceToday()" style="padding: 0.5rem 1rem;">Today</button>
                            </div>
                        </div>
                    </div>
                    <div style="padding: 1.5rem;">
                        <div id="currentServicePeriod" style="text-align: center; font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--primary);">
                            <!-- Current period will be displayed here -->
                        </div>
                        <div id="serviceCalendarGrid" style="min-height: 500px;">
                            <!-- Calendar will be rendered here -->
                        </div>
                    </div>
                </div>

                <!-- Legend -->
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Legend</h3>
                    </div>
                    <div style="padding: 1.5rem;">
                        <div style="display: flex; flex-wrap: wrap; gap: 2rem; justify-content: center;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 20px; height: 20px; background: var(--success); border-radius: 4px;"></div>
                                <span>Completed Service</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 20px; height: 20px; background: var(--primary); border-radius: 4px;"></div>
                                <span>Scheduled Service</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 20px; height: 20px; background: var(--warning); border-radius: 4px;"></div>
                                <span>Upcoming Service</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 20px; height: 20px; background: var(--secondary); border-radius: 4px;"></div>
                                <span>Recurring Service</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getWorkOrdersContent() {
            return `
                <div class="header-bar">
                    <h1 class="header-title">Work Orders</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="showServiceHistory()">
                            üìä Service History
                        </button>
                        <button class="btn btn-secondary" onclick="showRecurringServices()">
                            ‚ü≥ Recurring Services
                        </button>
                        <button class="btn btn-primary" onclick="showCreateWorkOrderModal()">
                            + New Service Request
                        </button>
                    </div>
                </div>
                
                <!-- View Toggle -->
                <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                    <button id="clientListViewBtn" class="btn btn-primary" onclick="switchToClientListView()" style="padding: 0.5rem 1rem;">
                        üìã List View
                    </button>
                    <button id="clientCalendarViewBtn" class="btn btn-secondary" onclick="switchToClientCalendarView()" style="padding: 0.5rem 1rem;">
                        üìÖ Calendar View
                    </button>
                </div>
                
                <!-- List View Container -->
                <div id="clientListViewContainer">
                    <!-- Filters -->
                    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                        <select class="form-select" style="width: 200px;">
                            <option>All Locations</option>
                            <option>McDonald's - Sunset</option>
                            <option>Burger King - Melrose</option>
                            <option>Delilah LA</option>
                        </select>
                        <select class="form-select" style="width: 150px;">
                            <option>All Status</option>
                            <option>Open</option>
                            <option>In Progress</option>
                            <option>Completed</option>
                        </select>
                        <select class="form-select" style="width: 150px;">
                            <option>All Priority</option>
                            <option>Emergency</option>
                            <option>Urgent</option>
                            <option>Standard</option>
                        </select>
                        <input type="search" class="form-input" placeholder="Search work orders..." style="width: 300px;">
                    </div>
                    
                    <!-- Work Orders List -->
                    <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">All Work Orders</h3>
                        <button class="btn btn-secondary" onclick="exportWorkOrders()">Export</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>WO #</th>
                                <th>Created</th>
                                <th>Location</th>
                                <th>Description</th>
                                <th>Category</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Vendor</th>
                                <th>Cost</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${getWorkOrderRows()}
                        </tbody>
                    </table>
                    </div>
                </div>
                
                <!-- Calendar View Container -->
                <div id="clientCalendarViewContainer" style="display: none;">
                    <div class="table-container">
                        <div class="table-header" style="display: flex; justify-content: space-between; align-items: center;">
                            <h3 class="table-title">Calendar View</h3>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <button class="btn btn-secondary" onclick="previousClientPeriod()" style="padding: 0.5rem;">‚óÄ</button>
                                <button class="btn btn-secondary" onclick="goToClientToday()">Today</button>
                                <button class="btn btn-secondary" onclick="nextClientPeriod()" style="padding: 0.5rem;">‚ñ∂</button>
                                <select id="clientCalendarView" onchange="changeClientCalendarView()" style="padding: 0.5rem; border: 1px solid var(--gray-300); border-radius: 6px; margin-left: 1rem;">
                                    <option value="month">Month View</option>
                                    <option value="week">Week View</option>
                                    <option value="day">Day View</option>
                                </select>
                            </div>
                        </div>
                        <div style="padding: 1.5rem;">
                            <h2 id="clientCurrentPeriod" style="text-align: center; font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">September 2025</h2>
                            <div id="clientCalendarGrid">
                                <!-- Calendar will be rendered here -->
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getWorkOrderRows() {
            const workOrders = [
                { id: 'WO-2024-001', date: '2024-10-15', location: 'McDonald\'s - Sunset', desc: 'HVAC Not Cooling', category: 'HVAC', priority: 'Urgent', status: 'In Progress', vendor: 'ABC Maintenance', cost: '$1,250' },
                { id: 'WO-2024-002', date: '2024-10-14', location: 'Burger King - Melrose', desc: 'Plumbing Leak', category: 'Plumbing', priority: 'Standard', status: 'Completed', vendor: 'XYZ Plumbing', cost: '$875' },
                { id: 'WO-2024-003', date: '2024-10-13', location: 'Delilah LA', desc: 'Electrical Issue', category: 'Electrical', priority: 'Standard', status: 'Completed', vendor: 'Elite Electric', cost: '$450' },
                { id: 'WO-2024-004', date: '2024-10-12', location: 'The Nice Guy', desc: 'Kitchen Equipment Repair', category: 'Equipment', priority: 'Urgent', status: 'Open', vendor: '-', cost: 'TBD' }
            ];
            
            return workOrders.map(wo => `
                <tr>
                    <td><strong>#${wo.id}</strong></td>
                    <td>${wo.date}</td>
                    <td>${wo.location}</td>
                    <td>${wo.desc}</td>
                    <td>${wo.category}</td>
                    <td><span class="status-badge ${wo.priority.toLowerCase()}">${wo.priority}</span></td>
                    <td><span class="status-badge ${wo.status.toLowerCase().replace(' ', '-')}">${wo.status}</span></td>
                    <td>${wo.vendor}</td>
                    <td>${wo.cost}</td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="viewWorkOrder('${wo.id}')">View</button>
                        ${wo.status === 'Completed' ? 
                            '<button class="btn btn-sm btn-warning" onclick="reviewWorkOrder(\'' + wo.id + '\')">üì∏ Review & Approve</button>' : 
                            ''}
                    </td>
                </tr>
            `).join('');
        }
        
        function getQuotesContent() {
            // Get quotes from localStorage (created by supplier portal)
            const quotes = JSON.parse(localStorage.getItem('clientQuotes') || '[]');
            const pendingQuotes = quotes.filter(q => q.status === 'pending');
            const approvedQuotes = quotes.filter(q => q.status === 'approved');
            const totalValue = quotes.reduce((sum, q) => sum + q.totalAmount, 0);
            
            return `
                <div class="header-bar">
                    <h1 class="header-title">Quotes</h1>
                </div>
                
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-label">Pending Approval</div>
                        <div class="stat-value">${pendingQuotes.length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Approved This Month</div>
                        <div class="stat-value">${approvedQuotes.length}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Quote Value</div>
                        <div class="stat-value">$${totalValue.toFixed(2)}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Avg Approval Time</div>
                        <div class="stat-value">2.3 days</div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Pending Quotes</h3>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Quote #</th>
                                <th>Service</th>
                                <th>Client</th>
                                <th>Bid Amount</th>
                                <th>Platform Fee</th>
                                <th>Total Amount</th>
                                <th>Valid Until</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${pendingQuotes.length > 0 ? pendingQuotes.map(quote => `
                                <tr>
                                    <td><strong>#${quote.id}</strong></td>
                                    <td>${quote.service}</td>
                                    <td>${quote.clientName}</td>
                                    <td>$${quote.bidAmount.toFixed(2)}</td>
                                    <td>$${quote.platformFee.toFixed(2)}</td>
                                    <td><strong>$${quote.totalAmount.toFixed(2)}</strong></td>
                                    <td>${new Date(quote.expiresAt).toLocaleDateString()}</td>
                                    <td>
                                        <button class="btn btn-sm btn-success" onclick="approveQuote('${quote.id}')">Approve</button>
                                        <button class="btn btn-sm btn-secondary" onclick="viewQuoteDetails('${quote.id}')">View</button>
                                        <button class="btn btn-sm btn-danger" onclick="rejectQuote('${quote.id}')">Reject</button>
                                    </td>
                                </tr>
                            `).join('') : `
                                <tr>
                                    <td colspan="8" style="text-align: center; padding: 2rem; color: var(--gray-500);">
                                        No pending quotes at this time
                                    </td>
                                </tr>
                            `}
                        </tbody>
                    </table>
                </div>
                
                ${approvedQuotes.length > 0 ? `
                <div class="table-container" style="margin-top: 2rem;">
                    <div class="table-header">
                        <h3 class="table-title">Approved Quotes</h3>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Quote #</th>
                                <th>Service</th>
                                <th>Total Amount</th>
                                <th>Approved Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${approvedQuotes.map(quote => `
                                <tr>
                                    <td><strong>#${quote.id}</strong></td>
                                    <td>${quote.service}</td>
                                    <td><strong>$${quote.totalAmount.toFixed(2)}</strong></td>
                                    <td>${new Date(quote.approvedAt || quote.createdAt).toLocaleDateString()}</td>
                                    <td><span class="status-badge approved">Approved</span></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                ` : ''}
            `;
        }
        
        function getInvoicesContent() {
            return `
                <div class="header-bar">
                    <h1 class="header-title">Invoices</h1>
                </div>
                
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-label">Outstanding</div>
                        <div class="stat-value">$12,450</div>
                        <div class="stat-trend negative">3 invoices</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Paid This Month</div>
                        <div class="stat-value">$45,230</div>
                        <div class="stat-trend">15 invoices</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Average Payment Time</div>
                        <div class="stat-value">18 days</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total YTD</div>
                        <div class="stat-value">$487,293</div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Outstanding Invoices</h3>
                        <button class="btn btn-primary" onclick="payAllInvoices()">Pay All</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Invoice #</th>
                                <th>Date</th>
                                <th>Vendor</th>
                                <th>Work Order</th>
                                <th>Amount</th>
                                <th>Due Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>#INV-2024-089</strong></td>
                                <td>Oct 10, 2024</td>
                                <td>ABC Maintenance</td>
                                <td>WO-2024-001</td>
                                <td><strong>$1,250.00</strong></td>
                                <td>Oct 25, 2024</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="payInvoice('INV-2024-089')">Pay Now</button>
                                    <button class="btn btn-sm btn-secondary" onclick="viewInvoice('INV-2024-089')">View</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        function getLocationsContent() {
            return `
                <div class="header-bar">
                    <h1 class="header-title">Locations</h1>
                    <div class="header-actions">
                        <input type="text" placeholder="Search locations..." class="form-input" style="width: 250px;" onkeyup="filterLocations(this.value)">
                        <select class="form-select" onchange="filterByRegion(this.value)">
                            <option value="all">All Regions</option>
                            <option value="midwest">Midwest</option>
                            <option value="northeast">Northeast</option>
                            <option value="west">West</option>
                            <option value="south">South</option>
                        </select>
                    </div>
                </div>
                
                <!-- Location Stats -->
                <div class="dashboard-grid" style="margin-bottom: 2rem;">
                    <div class="stat-card">
                        <div class="stat-label">Total Locations</div>
                        <div class="stat-value">127</div>
                        <div class="stat-trend">Across 4 regions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Active Work Orders</div>
                        <div class="stat-value">34</div>
                        <div class="stat-trend negative">8 urgent</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Assets</div>
                        <div class="stat-value">5,432</div>
                        <div class="stat-trend">$12.4M value</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Avg Response Time</div>
                        <div class="stat-value">2.4h</div>
                        <div class="stat-trend positive">‚Üì 15% this month</div>
                    </div>
                </div>
                
                <!-- Locations List/Grid Toggle -->
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">All Locations</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-sm btn-secondary" onclick="setLocationView('grid')">Grid View</button>
                            <button class="btn btn-sm btn-primary" onclick="setLocationView('list')">List View</button>
                        </div>
                    </div>
                    
                    <div id="locations-container">
                        ${getLocationsList()}
                    </div>
                </div>
            `;
        }
        
        function getLocationsList() {
            const locations = [
                { 
                    id: 'chi-001',
                    name: 'Chicago - State Street',
                    address: '123 N State St, Chicago, IL 60602',
                    region: 'Midwest',
                    manager: 'Sarah Johnson',
                    phone: '(312) 555-0100',
                    workOrders: 3,
                    assets: 45,
                    sqft: '4,500',
                    type: 'Restaurant',
                    status: 'operational'
                },
                { 
                    id: 'chi-002',
                    name: 'Chicago - Michigan Ave',
                    address: '600 N Michigan Ave, Chicago, IL 60611',
                    region: 'Midwest',
                    manager: 'Mike Davis',
                    phone: '(312) 555-0101',
                    workOrders: 1,
                    assets: 38,
                    sqft: '3,800',
                    type: 'Restaurant',
                    status: 'operational'
                },
                { 
                    id: 'nyc-001',
                    name: 'Times Square',
                    address: '1560 Broadway, New York, NY 10036',
                    region: 'Northeast',
                    manager: 'Jennifer Lee',
                    phone: '(212) 555-0200',
                    workOrders: 5,
                    assets: 62,
                    sqft: '6,200',
                    type: 'Restaurant',
                    status: 'operational'
                },
                { 
                    id: 'la-001',
                    name: 'Hollywood Boulevard',
                    address: '6801 Hollywood Blvd, Los Angeles, CA 90028',
                    region: 'West',
                    manager: 'Carlos Rodriguez',
                    phone: '(323) 555-0300',
                    workOrders: 2,
                    assets: 51,
                    sqft: '5,100',
                    type: 'Restaurant',
                    status: 'renovation'
                }
            ];
            
            return `
                <table>
                    <thead>
                        <tr>
                            <th style="width: 25%;">Location</th>
                            <th style="width: 15%;">Region</th>
                            <th style="width: 15%;">Manager</th>
                            <th style="width: 10%; text-align: center;">WOs</th>
                            <th style="width: 10%; text-align: center;">Assets</th>
                            <th style="width: 10%;">Status</th>
                            <th style="width: 15%; text-align: center;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${locations.map(loc => `
                            <tr style="cursor: pointer;" onclick="viewLocationDetails('${loc.id}')">
                                <td>
                                    <div>
                                        <strong style="display: block; margin-bottom: 0.25rem;">${loc.name}</strong>
                                        <div style="font-size: 0.75rem; color: var(--gray-500); margin-bottom: 0.125rem;">${loc.address}</div>
                                        <div style="font-size: 0.75rem; color: var(--gray-400);">${loc.type} ‚Ä¢ ${loc.sqft} sq ft</div>
                                    </div>
                                </td>
                                <td>${loc.region}</td>
                                <td>
                                    <div>
                                        <div style="font-weight: 500;">${loc.manager}</div>
                                        <div style="font-size: 0.75rem; color: var(--gray-500);">${loc.phone}</div>
                                    </div>
                                </td>
                                <td style="text-align: center;">
                                    <span class="badge ${loc.workOrders > 0 ? 'badge-warning' : 'badge-success'}">
                                        ${loc.workOrders}
                                    </span>
                                </td>
                                <td style="text-align: center;">${loc.assets}</td>
                                <td>
                                    <span class="status-badge ${loc.status === 'operational' ? 'completed' : 'pending'}">
                                        ${loc.status}
                                    </span>
                                </td>
                                <td style="text-align: center;">
                                    <button class="btn btn-sm btn-primary" onclick="event.stopPropagation(); viewLocationDetails('${loc.id}')">
                                        View
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        function viewLocationDetails(locationId) {
            console.log('Viewing location:', locationId);
            loadSection('location-detail', locationId);
        }
        window.viewLocationDetails = viewLocationDetails;
        
        function filterLocations(searchTerm) {
            showToast(`Searching for: ${searchTerm}`, 'info');
        }
        window.filterLocations = filterLocations;
        
        function filterByRegion(region) {
            showToast(`Filtering by region: ${region}`, 'info');
        }
        window.filterByRegion = filterByRegion;
        
        function setLocationView(view) {
            showToast(`Switching to ${view} view`, 'info');
        }
        window.setLocationView = setLocationView;
        
        function getLocationDetailContent(locationId) {
            // Mock data - in real app would fetch from API based on locationId
            const location = {
                id: locationId,
                name: 'Chicago - State Street',
                address: '123 N State St, Chicago, IL 60602',
                region: 'Midwest',
                type: 'Restaurant',
                sqft: '4,500',
                yearBuilt: '2018',
                leaseExpiry: '2028-12-31',
                status: 'operational',
                manager: 'Sarah Johnson',
                phone: '(312) 555-0100',
                email: 'sarah.johnson@mcdonalds.com',
                operatingHours: 'Mon-Sun: 6:00 AM - 11:00 PM'
            };
            
            return `
                <div class="header-bar">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <button class="btn btn-sm btn-secondary" onclick="loadSection('locations')">‚Üê Back</button>
                        <h1 class="header-title">${location.name}</h1>
                        <span class="status-badge ${location.status === 'operational' ? 'completed' : 'pending'}">
                            ${location.status}
                        </span>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="requestService('${location.id}')">Request Service</button>
                    </div>
                </div>
                
                <!-- Location Overview -->
                <div class="dashboard-grid" style="margin-bottom: 2rem;">
                    <div class="stat-card">
                        <div class="stat-label">Square Footage</div>
                        <div class="stat-value">${location.sqft}</div>
                        <div class="stat-trend">Built ${location.yearBuilt}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Active Work Orders</div>
                        <div class="stat-value">3</div>
                        <div class="stat-trend negative">1 urgent</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Assets</div>
                        <div class="stat-value">45</div>
                        <div class="stat-trend">$486K value</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Monthly Spend</div>
                        <div class="stat-value">$8,542</div>
                        <div class="stat-trend positive">‚Üì 12% vs last month</div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <!-- Location Details -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Location Information</h3>
                        </div>
                        <div style="padding: 1.5rem;">
                            <div style="display: grid; gap: 1rem;">
                                <div>
                                    <label style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">Address</label>
                                    <p style="font-weight: 500;">${location.address}</p>
                                </div>
                                <div>
                                    <label style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">Operating Hours</label>
                                    <p style="font-weight: 500;">${location.operatingHours}</p>
                                </div>
                                <div>
                                    <label style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">Lease Expiry</label>
                                    <p style="font-weight: 500;">${location.leaseExpiry}</p>
                                </div>
                                <div>
                                    <label style="font-size: 0.75rem; color: var(--gray-500); text-transform: uppercase;">Property Type</label>
                                    <p style="font-weight: 500;">${location.type}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contacts -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Contacts</h3>
                        </div>
                        <div style="padding: 1.5rem;">
                            <div style="display: grid; gap: 1.5rem;">
                                <div style="border-left: 3px solid var(--primary); padding-left: 1rem;">
                                    <div style="font-weight: 600;">${location.manager}</div>
                                    <div style="font-size: 0.875rem; color: var(--gray-600);">Location Manager</div>
                                    <div style="font-size: 0.875rem; margin-top: 0.5rem;">
                                        <div>${location.phone}</div>
                                        <div>${location.email}</div>
                                    </div>
                                </div>
                                <div style="border-left: 3px solid var(--gray-300); padding-left: 1rem;">
                                    <div style="font-weight: 600;">Regional Support</div>
                                    <div style="font-size: 0.875rem; color: var(--gray-600);">24/7 Helpdesk</div>
                                    <div style="font-size: 0.875rem; margin-top: 0.5rem;">
                                        <div>(800) 555-HELP</div>
                                        <div>support@facilities.com</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Work Orders -->
                <div class="table-container" style="margin-top: 2rem;">
                    <div class="table-header">
                        <h3 class="table-title">Recent Work Orders</h3>
                        <button class="btn btn-sm btn-secondary" onclick="loadSection('work-orders')">View All</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>WO #</th>
                                <th>Description</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Assigned To</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>#WO-2024-0145</strong></td>
                                <td>HVAC Unit 3 - No cooling</td>
                                <td><span class="badge badge-danger">Urgent</span></td>
                                <td><span class="status-badge pending">In Progress</span></td>
                                <td>TechPro Services</td>
                                <td>2 hours ago</td>
                                <td><button class="btn btn-sm btn-secondary">View</button></td>
                            </tr>
                            <tr>
                                <td><strong>#WO-2024-0143</strong></td>
                                <td>Parking lot lighting repair</td>
                                <td><span class="badge badge-warning">Medium</span></td>
                                <td><span class="status-badge scheduled">Scheduled</span></td>
                                <td>BrightLight Electric</td>
                                <td>1 day ago</td>
                                <td><button class="btn btn-sm btn-secondary">View</button></td>
                            </tr>
                            <tr>
                                <td><strong>#WO-2024-0141</strong></td>
                                <td>Quarterly pest control service</td>
                                <td><span class="badge badge-success">Low</span></td>
                                <td><span class="status-badge completed">Completed</span></td>
                                <td>PestShield Pro</td>
                                <td>3 days ago</td>
                                <td><button class="btn btn-sm btn-secondary">View</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Assets -->
                <div class="table-container" style="margin-top: 2rem;">
                    <div class="table-header">
                        <h3 class="table-title">Key Assets</h3>
                        <button class="btn btn-sm btn-secondary" onclick="loadSection('assets')">View All Assets</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Asset Name</th>
                                <th>Type</th>
                                <th>Serial #</th>
                                <th>Install Date</th>
                                <th>Warranty</th>
                                <th>Last Service</th>
                                <th>Next Service</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>HVAC Unit 1</strong></td>
                                <td>Rooftop Unit</td>
                                <td>RTU-2018-001</td>
                                <td>03/15/2018</td>
                                <td><span class="badge badge-success">Active</span></td>
                                <td>10/15/2024</td>
                                <td>01/15/2025</td>
                            </tr>
                            <tr>
                                <td><strong>Walk-in Freezer</strong></td>
                                <td>Refrigeration</td>
                                <td>WIF-2019-045</td>
                                <td>06/20/2019</td>
                                <td><span class="badge badge-success">Active</span></td>
                                <td>11/01/2024</td>
                                <td>02/01/2025</td>
                            </tr>
                            <tr>
                                <td><strong>Fryer Station 1</strong></td>
                                <td>Kitchen Equipment</td>
                                <td>FRY-2020-112</td>
                                <td>01/10/2020</td>
                                <td><span class="badge badge-warning">Expiring Soon</span></td>
                                <td>10/30/2024</td>
                                <td>12/30/2024</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        function requestService(locationId) {
            showToast('Opening service request form...', 'info');
            // Would open a modal or navigate to service request form
        }
        window.requestService = requestService;
        
        function getAssetsContent() {
            return `
                <div class="header-bar">
                    <h1 class="header-title">Assets</h1>
                    <div class="header-actions">
                        <input type="text" placeholder="Search assets..." class="form-input" style="width: 250px;" onkeyup="filterAssets(this.value)">
                        <select class="form-select" onchange="filterAssetsByLocation(this.value)">
                            <option value="all">All Locations</option>
                            <option value="chi-001">Chicago - State Street</option>
                            <option value="chi-002">Chicago - Michigan Ave</option>
                            <option value="nyc-001">Times Square</option>
                        </select>
                        <button class="btn btn-secondary" onclick="exportAssets()">Export CSV</button>
                    </div>
                </div>
                
                <!-- Asset Stats -->
                <div class="dashboard-grid" style="margin-bottom: 2rem;">
                    <div class="stat-card">
                        <div class="stat-label">Total Assets</div>
                        <div class="stat-value">5,432</div>
                        <div class="stat-trend">$12.4M total value</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Warranties Expiring</div>
                        <div class="stat-value">18</div>
                        <div class="stat-trend negative">Within 30 days</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Service Due</div>
                        <div class="stat-value">34</div>
                        <div class="stat-trend warning">This month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Compliance Rate</div>
                        <div class="stat-value">97.2%</div>
                        <div class="stat-trend positive">‚Üë 2.1% from last month</div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Asset Inventory</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <select class="form-select" onchange="filterAssetCategory(this.value)">
                                <option>All Categories</option>
                                <option>HVAC</option>
                                <option>Kitchen Equipment</option>
                                <option>Refrigeration</option>
                                <option>Electrical</option>
                                <option>Plumbing</option>
                            </select>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Asset ID</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Location</th>
                                <th>Serial #</th>
                                <th>Age</th>
                                <th>Last Service</th>
                                <th>Next Service</th>
                                <th>Warranty</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>#A-001</strong></td>
                                <td>Rooftop HVAC Unit 1</td>
                                <td>HVAC</td>
                                <td>Chicago - State St</td>
                                <td>RTU-2018-001</td>
                                <td>6 years</td>
                                <td>Oct 15, 2024</td>
                                <td>Jan 15, 2025</td>
                                <td><span class="badge badge-success">Active</span></td>
                                <td><span class="status-badge completed">Operational</span></td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="viewAssetDetail('A-001')">View</button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>#A-002</strong></td>
                                <td>Walk-in Freezer</td>
                                <td>Refrigeration</td>
                                <td>Chicago - State St</td>
                                <td>WIF-2019-045</td>
                                <td>5 years</td>
                                <td>Nov 01, 2024</td>
                                <td>Feb 01, 2025</td>
                                <td><span class="badge badge-success">Active</span></td>
                                <td><span class="status-badge completed">Operational</span></td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="viewAssetDetail('A-002')">View</button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>#A-003</strong></td>
                                <td>Fryer Station 1</td>
                                <td>Kitchen Equipment</td>
                                <td>Chicago - State St</td>
                                <td>FRY-2020-112</td>
                                <td>4 years</td>
                                <td>Oct 30, 2024</td>
                                <td>Dec 30, 2024</td>
                                <td><span class="badge badge-warning">Expiring</span></td>
                                <td><span class="status-badge completed">Operational</span></td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="viewAssetDetail('A-003')">View</button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>#A-004</strong></td>
                                <td>Emergency Generator</td>
                                <td>Electrical</td>
                                <td>Times Square</td>
                                <td>GEN-2021-203</td>
                                <td>3 years</td>
                                <td>Sep 20, 2024</td>
                                <td>Mar 20, 2025</td>
                                <td><span class="badge badge-success">Active</span></td>
                                <td><span class="status-badge completed">Operational</span></td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="viewAssetDetail('A-004')">View</button>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>#A-005</strong></td>
                                <td>Dishwasher Unit</td>
                                <td>Kitchen Equipment</td>
                                <td>Michigan Ave</td>
                                <td>DW-2022-089</td>
                                <td>2 years</td>
                                <td>Nov 10, 2024</td>
                                <td>Jan 10, 2025</td>
                                <td><span class="badge badge-success">Active</span></td>
                                <td><span class="status-badge pending">Needs Service</span></td>
                                <td>
                                    <button class="btn btn-sm btn-secondary" onclick="viewAssetDetail('A-005')">View</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        function filterAssets(searchTerm) {
            showToast(`Searching assets for: ${searchTerm}`, 'info');
        }
        window.filterAssets = filterAssets;
        
        function filterAssetsByLocation(location) {
            showToast(`Filtering assets by location: ${location}`, 'info');
        }
        window.filterAssetsByLocation = filterAssetsByLocation;
        
        function filterAssetCategory(category) {
            showToast(`Filtering by category: ${category}`, 'info');
        }
        window.filterAssetCategory = filterAssetCategory;
        
        function exportAssets() {
            showToast('Exporting assets to CSV...', 'success');
        }
        window.exportAssets = exportAssets;
        
        function viewAssetDetail(assetId) {
            showToast(`Opening asset details for ${assetId}...`, 'info');
            // In a real app, this would navigate to asset detail page
        }
        window.viewAssetDetail = viewAssetDetail;
        
        function getVendorsContent() {
            return `
                <div class="header-bar">
                    <h1 class="header-title">Preferred Vendors</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="showVendorMetrics()">
                            üìä Performance Metrics
                        </button>
                        <button class="btn btn-primary" onclick="showAddVendorModal()">
                            + Add Vendor
                        </button>
                    </div>
                </div>
                
                <!-- Performance Overview Cards -->
                <div class="stats-grid" style="margin-bottom: 1rem;">
                    <div class="stat-card">
                        <div class="stat-value">4.7</div>
                        <div class="stat-label">Avg Vendor Rating</div>
                        <div class="stat-change positive">+0.2 this quarter</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">2.4h</div>
                        <div class="stat-label">Avg Response Time</div>
                        <div class="stat-change positive">-15% improvement</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">94%</div>
                        <div class="stat-label">On-Time Completion</div>
                        <div class="stat-change">Industry avg: 87%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">12</div>
                        <div class="stat-label">Active Vendors</div>
                        <div class="stat-change">3 pending reviews</div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Your Vendor Network</h3>
                        <select class="form-select" style="width: 180px;" onchange="filterVendors(this.value)">
                            <option>All Vendors</option>
                            <option>Top Performers</option>
                            <option>Needs Review</option>
                            <option>New Vendors</option>
                        </select>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Vendor</th>
                                <th>Services</th>
                                <th>Performance Rating</th>
                                <th>Jobs Completed</th>
                                <th>Avg Response</th>
                                <th>Total Spend</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div>
                                        <strong>CoolAir HVAC Services</strong>
                                        <div style="font-size: 0.875rem; color: var(--gray-600);">Since 2022</div>
                                    </div>
                                </td>
                                <td>HVAC, Refrigeration</td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="color: var(--warning);">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                        <strong>4.9</strong>
                                        <span style="color: var(--gray-600);">(87)</span>
                                    </div>
                                </td>
                                <td>87</td>
                                <td>1.8 hours</td>
                                <td>$145,280</td>
                                <td><span class="badge badge-success">Top Performer</span></td>
                                <td>
                                    <button class="btn btn-sm" onclick="viewVendorDetails(1)">View</button>
                                    <button class="btn btn-sm" onclick="rateVendor(1)">Rate</button>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div>
                                        <strong>Elite Plumbing Solutions</strong>
                                        <div style="font-size: 0.875rem; color: var(--gray-600);">Since 2023</div>
                                    </div>
                                </td>
                                <td>Plumbing, Drainage</td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="color: var(--warning);">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                        <strong>4.6</strong>
                                        <span style="color: var(--gray-600);">(52)</span>
                                    </div>
                                </td>
                                <td>52</td>
                                <td>2.3 hours</td>
                                <td>$87,432</td>
                                <td><span class="badge badge-success">Preferred</span></td>
                                <td>
                                    <button class="btn btn-sm" onclick="viewVendorDetails(2)">View</button>
                                    <button class="btn btn-sm" onclick="rateVendor(2)">Rate</button>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div>
                                        <strong>Sparkle Clean Pro</strong>
                                        <div style="font-size: 0.875rem; color: var(--gray-600);">Since 2021</div>
                                    </div>
                                </td>
                                <td>Cleaning, Sanitation</td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="color: var(--warning);">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                        <strong>4.3</strong>
                                        <span style="color: var(--gray-600);">(124)</span>
                                    </div>
                                </td>
                                <td>124</td>
                                <td>3.1 hours</td>
                                <td>$98,560</td>
                                <td><span class="badge badge-warning">Review Pending</span></td>
                                <td>
                                    <button class="btn btn-sm" onclick="viewVendorDetails(3)">View</button>
                                    <button class="btn btn-sm btn-primary" onclick="rateVendor(3)">Rate Now</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Recent Reviews Section -->
                <div class="table-container" style="margin-top: 2rem;">
                    <div class="table-header">
                        <h3 class="table-title">Recent Vendor Reviews</h3>
                        <button class="btn btn-secondary" onclick="viewAllReviews()">View All</button>
                    </div>
                    <div style="padding: 1.5rem;">
                        <div style="border-bottom: 1px solid var(--gray-200); padding-bottom: 1rem; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>CoolAir HVAC Services</strong>
                                <span style="color: var(--warning);">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                            </div>
                            <p style="color: var(--gray-700); margin: 0.5rem 0;">Excellent emergency response. Fixed our AC unit within 2 hours of calling. Professional and efficient service.</p>
                            <div style="font-size: 0.875rem; color: var(--gray-600);">
                                WO #2024-1547 ‚Ä¢ Reviewed by John Smith ‚Ä¢ Nov 25, 2024
                            </div>
                        </div>
                        <div style="border-bottom: 1px solid var(--gray-200); padding-bottom: 1rem; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>Elite Plumbing Solutions</strong>
                                <span style="color: var(--warning);">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                            </div>
                            <p style="color: var(--gray-700); margin: 0.5rem 0;">Good work overall but arrived 30 minutes late. Fixed the issue thoroughly and cleaned up well.</p>
                            <div style="font-size: 0.875rem; color: var(--gray-600);">
                                WO #2024-1543 ‚Ä¢ Reviewed by Sarah Johnson ‚Ä¢ Nov 24, 2024
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function rateVendor(vendorId) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-overlay" onclick="this.parentElement.remove()"></div>
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header">
                        <h2>Rate Vendor Performance</h2>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form onsubmit="event.preventDefault(); submitVendorRating();">
                            <div class="form-group">
                                <label>Work Order</label>
                                <select class="form-select" required>
                                    <option value="">Select work order...</option>
                                    <option>WO-2024-1547 - Emergency AC Repair</option>
                                    <option>WO-2024-1523 - Monthly Maintenance</option>
                                    <option>WO-2024-1498 - Filter Replacement</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Overall Rating</label>
                                <div style="display: flex; gap: 0.5rem; font-size: 1.5rem;">
                                    <span style="cursor: pointer;" onclick="setRating(1)">‚≠ê</span>
                                    <span style="cursor: pointer;" onclick="setRating(2)">‚≠ê</span>
                                    <span style="cursor: pointer;" onclick="setRating(3)">‚≠ê</span>
                                    <span style="cursor: pointer;" onclick="setRating(4)">‚≠ê</span>
                                    <span style="cursor: pointer;" onclick="setRating(5)">‚≠ê</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Rate Specific Areas</label>
                                <div style="display: grid; gap: 0.75rem;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span>Quality of Work</span>
                                        <select class="form-select" style="width: 120px;">
                                            <option>Excellent</option>
                                            <option>Good</option>
                                            <option>Average</option>
                                            <option>Poor</option>
                                        </select>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span>Response Time</span>
                                        <select class="form-select" style="width: 120px;">
                                            <option>Excellent</option>
                                            <option>Good</option>
                                            <option>Average</option>
                                            <option>Poor</option>
                                        </select>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span>Professionalism</span>
                                        <select class="form-select" style="width: 120px;">
                                            <option>Excellent</option>
                                            <option>Good</option>
                                            <option>Average</option>
                                            <option>Poor</option>
                                        </select>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span>Value for Money</span>
                                        <select class="form-select" style="width: 120px;">
                                            <option>Excellent</option>
                                            <option>Good</option>
                                            <option>Average</option>
                                            <option>Poor</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Comments (Optional)</label>
                                <textarea class="form-input" rows="4" placeholder="Share your experience..."></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" checked>
                                    Would you recommend this vendor?
                                </label>
                            </div>
                            
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                                <button type="submit" class="btn btn-primary">Submit Rating</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function viewVendorDetails(vendorId) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-overlay" onclick="this.parentElement.remove()"></div>
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h2>Vendor Performance Details</h2>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                            <div>
                                <h3>CoolAir HVAC Services</h3>
                                <p style="color: var(--gray-600);">License #HVAC-2022-1234</p>
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin: 1rem 0;">
                                    <span style="color: var(--warning); font-size: 1.25rem;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                    <strong style="font-size: 1.25rem;">4.9</strong>
                                    <span style="color: var(--gray-600);">(87 reviews)</span>
                                </div>
                            </div>
                            <div>
                                <h4>Contact Information</h4>
                                <p style="color: var(--gray-700);">
                                    üìû (555) 123-4567<br>
                                    ‚úâÔ∏è service@coolairhvac.com<br>
                                    üåê www.coolairhvac.com
                                </p>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 2rem;">
                            <div style="background: var(--gray-50); padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">87</div>
                                <div style="font-size: 0.875rem; color: var(--gray-600);">Jobs Completed</div>
                            </div>
                            <div style="background: var(--gray-50); padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">1.8h</div>
                                <div style="font-size: 0.875rem; color: var(--gray-600);">Avg Response</div>
                            </div>
                            <div style="background: var(--gray-50); padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">96%</div>
                                <div style="font-size: 0.875rem; color: var(--gray-600);">On-Time Rate</div>
                            </div>
                            <div style="background: var(--gray-50); padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">92%</div>
                                <div style="font-size: 0.875rem; color: var(--gray-600);">First-Fix Rate</div>
                            </div>
                        </div>
                        
                        <h4>Performance Breakdown</h4>
                        <div style="margin-bottom: 2rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin: 0.75rem 0;">
                                <span>Quality of Work</span>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <div style="background: var(--gray-200); height: 8px; width: 200px; border-radius: 4px;">
                                        <div style="background: var(--primary); height: 100%; width: 98%; border-radius: 4px;"></div>
                                    </div>
                                    <span>4.95</span>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin: 0.75rem 0;">
                                <span>Response Time</span>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <div style="background: var(--gray-200); height: 8px; width: 200px; border-radius: 4px;">
                                        <div style="background: var(--primary); height: 100%; width: 94%; border-radius: 4px;"></div>
                                    </div>
                                    <span>4.7</span>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin: 0.75rem 0;">
                                <span>Professionalism</span>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <div style="background: var(--gray-200); height: 8px; width: 200px; border-radius: 4px;">
                                        <div style="background: var(--primary); height: 100%; width: 96%; border-radius: 4px;"></div>
                                    </div>
                                    <span>4.8</span>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin: 0.75rem 0;">
                                <span>Value for Money</span>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <div style="background: var(--gray-200); height: 8px; width: 200px; border-radius: 4px;">
                                        <div style="background: var(--primary); height: 100%; width: 92%; border-radius: 4px;"></div>
                                    </div>
                                    <span>4.6</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="exportVendorReport(1)">Export Report</button>
                            <button class="btn btn-primary" onclick="this.closest('.modal').remove()">Close</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function submitVendorRating() {
            alert('Thank you for your feedback! Your rating has been submitted.');
            document.querySelector('.modal').remove();
        }
        
        function getCrossPortalAnalyticsContent() {
            // Initialize analytics when content loads
            setTimeout(() => {
                initializeAnalytics();
            }, 100);
            
            return `
                <div class="header-bar">
                    <h1 class="header-title">Cross-Portal Analytics Dashboard</h1>
                    <div class="header-actions">
                        <select class="form-select" id="analyticsPerio‚Äãd" style="width: 150px;" onchange="updateAnalyticsPeriod(this.value)">
                            <option value="7d">Last 7 Days</option>
                            <option value="30d" selected>Last 30 Days</option>
                            <option value="90d">Last 90 Days</option>
                            <option value="1y">Last Year</option>
                        </select>
                        <button class="btn btn-secondary" onclick="exportAnalytics()">
                            üìä Export Report
                        </button>
                        <button class="btn btn-primary" onclick="scheduleReport()">
                            ‚è∞ Schedule Report
                        </button>
                    </div>
                </div>
                
                <!-- Loading State -->
                <div id="analyticsLoading" style="display: flex; justify-content: center; align-items: center; height: 200px; color: var(--gray-500);">
                    <div>Loading analytics data...</div>
                </div>
                
                <!-- Analytics Content -->
                <div id="analyticsContent" style="display: none;">
                    <!-- Executive Summary Cards -->
                    <div class="stats-grid" id="executiveSummary" style="margin-bottom: 2rem;">
                        <!-- Will be populated by JavaScript -->
                    </div>
                    
                    <!-- Charts Section -->
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                        <div class="table-container">
                            <div class="table-header">
                                <h3 class="table-title">Work Order Trends</h3>
                            </div>
                            <div style="padding: 1rem; height: 400px;">
                                <canvas id="workOrderTrendChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <div class="table-header">
                                <h3 class="table-title">Status Distribution</h3>
                            </div>
                            <div style="padding: 1rem; height: 400px; display: flex; align-items: center; justify-content: center;">
                                <canvas id="statusDistributionChart" style="max-height: 300px;"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Financial Analytics -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                        <div class="table-container">
                            <div class="table-header">
                                <h3 class="table-title">Monthly Spend Analysis</h3>
                            </div>
                            <div style="padding: 1rem; height: 300px;">
                                <canvas id="monthlySpendChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <div class="table-header">
                                <h3 class="table-title">Category Breakdown</h3>
                            </div>
                            <div style="padding: 1rem; height: 300px; display: flex; align-items: center; justify-content: center;">
                                <canvas id="categoryBreakdownChart" style="max-height: 250px;"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Performance Metrics Table -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Performance Metrics</h3>
                            <button class="btn btn-sm btn-secondary" onclick="refreshMetrics()">Refresh</button>
                        </div>
                        <div id="performanceMetrics">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Analytics JavaScript Functions
        let analyticsCharts = {};
        let currentAnalyticsPeriod = '30d';
        
        async function initializeAnalytics() {
            try {
                showAnalyticsLoading(true);
                await loadAnalyticsData(currentAnalyticsPeriod);
                showAnalyticsLoading(false);
            } catch (error) {
                console.error('Failed to initialize analytics:', error);
                showAnalyticsError('Failed to load analytics data');
            }
        }
        
        async function loadAnalyticsData(period) {
            const token = localStorage.getItem('supabase_token');
            if (!token) {
                throw new Error('Authentication required');
            }
            
            try {
                // Load different types of analytics data
                const [overview, workOrders, financial, performance] = await Promise.all([
                    fetch(`/api/analytics?type=overview&period=${period}`, {
                        headers: { Authorization: `Bearer ${token}` }
                    }).then(r => r.json()),
                    fetch(`/api/analytics?type=work-orders&period=${period}`, {
                        headers: { Authorization: `Bearer ${token}` }
                    }).then(r => r.json()),
                    fetch(`/api/analytics?type=financial&period=${period}`, {
                        headers: { Authorization: `Bearer ${token}` }
                    }).then(r => r.json()),
                    fetch(`/api/analytics?type=performance&period=${period}`, {
                        headers: { Authorization: `Bearer ${token}` }
                    }).then(r => r.json())
                ]);
                
                // Update executive summary cards
                updateExecutiveSummary(overview.data);
                
                // Create or update charts
                createWorkOrderTrendChart(workOrders.data);
                createStatusDistributionChart(workOrders.data);
                createMonthlySpendChart(financial.data);
                createCategoryBreakdownChart(financial.data);
                
                // Update performance metrics table
                updatePerformanceMetrics(performance.data);
                
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }
        
        function updateExecutiveSummary(data) {
            const summaryHTML = `
                <div class="stat-card">
                    <div class="stat-value">${data.total_work_orders || 0}</div>
                    <div class="stat-label">Total Work Orders</div>
                    <div class="stat-change positive">‚Üó ${data.completion_rate}% complete</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${data.completed_work_orders || 0}</div>
                    <div class="stat-label">Completed</div>
                    <div class="stat-change positive">‚Üó ${data.completion_rate}% rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${data.pending_work_orders || 0}</div>
                    <div class="stat-label">Pending</div>
                    <div class="stat-change">${data.in_progress_work_orders || 0} in progress</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${data.unread_notifications || 0}</div>
                    <div class="stat-label">Notifications</div>
                    <div class="stat-change">Total: ${data.total_notifications || 0}</div>
                </div>
            `;
            document.getElementById('executiveSummary').innerHTML = summaryHTML;
        }
        
        function createWorkOrderTrendChart(data) {
            const ctx = document.getElementById('workOrderTrendChart').getContext('2d');
            
            if (analyticsCharts.workOrderTrend) {
                analyticsCharts.workOrderTrend.destroy();
            }
            
            const labels = data.daily_counts?.map(d => new Date(d.date).toLocaleDateString()) || [];
            const createdData = data.daily_counts?.map(d => d.created) || [];
            const completedData = data.daily_counts?.map(d => d.completed) || [];
            
            analyticsCharts.workOrderTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Created',
                        data: createdData,
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Completed',
                        data: completedData,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        function createStatusDistributionChart(data) {
            const ctx = document.getElementById('statusDistributionChart').getContext('2d');
            
            if (analyticsCharts.statusDistribution) {
                analyticsCharts.statusDistribution.destroy();
            }
            
            const statusData = data.status_distribution || {};
            
            analyticsCharts.statusDistribution = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Pending', 'In Progress', 'Completed', 'Cancelled'],
                    datasets: [{
                        data: [
                            statusData.pending || 0,
                            statusData.in_progress || 0,
                            statusData.completed || 0,
                            statusData.cancelled || 0
                        ],
                        backgroundColor: [
                            '#f59e0b',
                            '#3b82f6',
                            '#10b981',
                            '#ef4444'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        function createMonthlySpendChart(data) {
            const ctx = document.getElementById('monthlySpendChart').getContext('2d');
            
            if (analyticsCharts.monthlySpend) {
                analyticsCharts.monthlySpend.destroy();
            }
            
            const monthlyData = data.monthly_spend || [];
            const labels = monthlyData.map(d => d.month);
            const amounts = monthlyData.map(d => d.amount);
            
            analyticsCharts.monthlySpend = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Monthly Spend',
                        data: amounts,
                        backgroundColor: '#6366f1',
                        borderColor: '#4f46e5',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function createCategoryBreakdownChart(data) {
            const ctx = document.getElementById('categoryBreakdownChart').getContext('2d');
            
            if (analyticsCharts.categoryBreakdown) {
                analyticsCharts.categoryBreakdown.destroy();
            }
            
            const categoryData = data.category_breakdown || [];
            const labels = categoryData.map(d => d.category);
            const amounts = categoryData.map(d => d.amount);
            
            analyticsCharts.categoryBreakdown = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: amounts,
                        backgroundColor: [
                            '#6366f1',
                            '#8b5cf6',
                            '#10b981',
                            '#f59e0b',
                            '#ef4444',
                            '#3b82f6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        function updatePerformanceMetrics(data) {
            const metricsHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Value</th>
                            <th>Period</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Completion Rate</td>
                            <td><strong>${data.completion_rate}%</strong></td>
                            <td>${data.period}</td>
                        </tr>
                        <tr>
                            <td>On-Time Rate</td>
                            <td><strong>${data.on_time_rate}%</strong></td>
                            <td>${data.period}</td>
                        </tr>
                        <tr>
                            <td>Average Rating</td>
                            <td><strong>${data.average_rating}‚òÖ</strong></td>
                            <td>${data.period}</td>
                        </tr>
                        <tr>
                            <td>Customer Satisfaction</td>
                            <td><strong>${data.customer_satisfaction}%</strong></td>
                            <td>${data.period}</td>
                        </tr>
                    </tbody>
                </table>
            `;
            document.getElementById('performanceMetrics').innerHTML = metricsHTML;
        }
        
        function showAnalyticsLoading(show) {
            document.getElementById('analyticsLoading').style.display = show ? 'flex' : 'none';
            document.getElementById('analyticsContent').style.display = show ? 'none' : 'block';
        }
        
        function showAnalyticsError(message) {
            document.getElementById('analyticsLoading').innerHTML = `
                <div style="text-align: center; color: var(--danger);">
                    <div style="font-size: 1.5rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                    <div>${message}</div>
                    <button class="btn btn-secondary" onclick="initializeAnalytics()" style="margin-top: 1rem;">
                        Retry
                    </button>
                </div>
            `;
            document.getElementById('analyticsLoading').style.display = 'flex';
            document.getElementById('analyticsContent').style.display = 'none';
        }
        
        async function updateAnalyticsPeriod(period) {
            currentAnalyticsPeriod = period;
            await loadAnalyticsData(period);
            showToast(`Analytics updated for ${period} period`, 'info');
        }
        
        function refreshMetrics() {
            initializeAnalytics();
        }
        
        // Export global functions
        window.initializeAnalytics = initializeAnalytics;
        window.updateAnalyticsPeriod = updateAnalyticsPeriod;
        window.refreshMetrics = refreshMetrics;
        
        // Global Search Functions
        let searchTimeout;
        let searchData = {
            workOrders: [
                { id: 'WO-2024-001', title: 'HVAC Not Cooling', location: 'McDonald\'s - Sunset', type: 'work-order' },
                { id: 'WO-2024-002', title: 'Plumbing Leak', location: 'Burger King - Melrose', type: 'work-order' },
                { id: 'WO-2024-003', title: 'Electrical Issue', location: 'Delilah LA', type: 'work-order' }
            ],
            locations: [
                { id: 'chi-001', title: 'Chicago - State Street', address: '123 N State St', type: 'location' },
                { id: 'chi-002', title: 'Chicago - Michigan Ave', address: '456 Michigan Ave', type: 'location' },
                { id: 'ny-001', title: 'New York - Times Square', address: '789 Broadway', type: 'location' }
            ],
            vendors: [
                { id: 'v-001', title: 'ABC Maintenance', service: 'HVAC & Plumbing', type: 'vendor' },
                { id: 'v-002', title: 'Elite Electric', service: 'Electrical Services', type: 'vendor' },
                { id: 'v-003', title: 'TechPro Services', service: 'General Maintenance', type: 'vendor' }
            ]
        };
        
        function handleGlobalSearch(query) {
            clearTimeout(searchTimeout);
            
            if (query.length < 2) {
                hideSearchResults();
                return;
            }
            
            searchTimeout = setTimeout(() => {
                performSearch(query);
            }, 300);
        }
        
        function performSearch(query) {
            const results = [];
            const lowerQuery = query.toLowerCase();
            
            // Search work orders
            searchData.workOrders.forEach(wo => {
                if (wo.title.toLowerCase().includes(lowerQuery) || 
                    wo.location.toLowerCase().includes(lowerQuery) ||
                    wo.id.toLowerCase().includes(lowerQuery)) {
                    results.push(wo);
                }
            });
            
            // Search locations
            searchData.locations.forEach(loc => {
                if (loc.title.toLowerCase().includes(lowerQuery) || 
                    loc.address.toLowerCase().includes(lowerQuery)) {
                    results.push(loc);
                }
            });
            
            // Search vendors
            searchData.vendors.forEach(vendor => {
                if (vendor.title.toLowerCase().includes(lowerQuery) || 
                    vendor.service.toLowerCase().includes(lowerQuery)) {
                    results.push(vendor);
                }
            });
            
            displaySearchResults(results, query);
        }
        
        function displaySearchResults(results, query) {
            const resultsContainer = document.getElementById('searchResults');
            
            if (results.length === 0) {
                resultsContainer.innerHTML = `
                    <div style="padding: 1rem; text-align: center; color: var(--gray-500);">
                        No results found for "${query}"
                    </div>
                `;
            } else {
                const resultHTML = results.map(result => {
                    let icon, subtitle;
                    switch(result.type) {
                        case 'work-order':
                            icon = 'üìã';
                            subtitle = result.location;
                            break;
                        case 'location':
                            icon = 'üìç';
                            subtitle = result.address;
                            break;
                        case 'vendor':
                            icon = 'üè¢';
                            subtitle = result.service;
                            break;
                    }
                    
                    return `
                        <div class="search-result-item" style="padding: 0.75rem; border-bottom: 1px solid var(--gray-100); cursor: pointer; transition: background-color 0.15s;" 
                             onclick="selectSearchResult('${result.type}', '${result.id}')"
                             onmouseover="this.style.backgroundColor='var(--gray-50)'"
                             onmouseout="this.style.backgroundColor='white'">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <span style="font-size: 1.25rem;">${icon}</span>
                                <div>
                                    <div style="font-weight: 600; color: var(--gray-900);">${result.title}</div>
                                    <div style="font-size: 0.875rem; color: var(--gray-600);">${subtitle}</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                resultsContainer.innerHTML = resultHTML;
            }
            
            resultsContainer.style.display = 'block';
        }
        
        function selectSearchResult(type, id) {
            hideSearchResults();
            document.getElementById('globalSearch').value = '';
            
            // Navigate to the appropriate section
            switch(type) {
                case 'work-order':
                    loadSection('work-orders');
                    showToast(`Navigated to work order ${id}`, 'info');
                    break;
                case 'location':
                    loadSection('location-detail', id);
                    break;
                case 'vendor':
                    loadSection('vendors');
                    showToast(`Navigated to vendor ${id}`, 'info');
                    break;
            }
        }
        
        function hideSearchResults() {
            document.getElementById('searchResults').style.display = 'none';
        }
        
        function handleSearchKeydown(event) {
            const resultsContainer = document.getElementById('searchResults');
            
            if (event.key === 'Escape') {
                hideSearchResults();
                document.getElementById('globalSearch').blur();
            } else if (event.key === 'Enter') {
                const firstResult = resultsContainer.querySelector('.search-result-item');
                if (firstResult) {
                    firstResult.click();
                }
            }
        }
        
        // Keyboard shortcut for search (Ctrl+K)
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                document.getElementById('globalSearch').focus();
            }
        });
        
        // Hide search results when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.header-search')) {
                hideSearchResults();
            }
        });
        
        // Export search functions
        window.handleGlobalSearch = handleGlobalSearch;
        window.handleSearchKeydown = handleSearchKeydown;
        window.selectSearchResult = selectSearchResult;
        function getReportsContent() {
            return `
                <div class="header-bar">
                    <h1 class="header-title">Reports</h1>
                </div>
                
                <div class="quick-actions">
                    <div class="action-card" onclick="generateReport('monthly')">
                        <div class="action-icon" style="font-weight: bold;">A</div>
                        <div class="action-title">Monthly Summary</div>
                        <div class="action-description">October 2024</div>
                    </div>
                    <div class="action-card" onclick="generateReport('vendor')">
                        <div class="action-icon" style="font-weight: bold;">T</div>
                        <div class="action-title">Vendor Performance</div>
                        <div class="action-description">All vendors</div>
                    </div>
                    <div class="action-card" onclick="generateReport('location')">
                        <div class="action-icon" style="font-weight: bold;">L</div>
                        <div class="action-title">Location Analysis</div>
                        <div class="action-description">All locations</div>
                    </div>
                    <div class="action-card" onclick="generateReport('custom')">
                        <div class="action-icon" style="font-weight: bold;">S</div>
                        <div class="action-title">Custom Report</div>
                        <div class="action-description">Build your own</div>
                    </div>
                </div>
            `;
        }
        
        function getSpendAnalysisContent() {
            return `
                <div class="header-bar">
                    <h1 class="header-title">Spend Analysis</h1>
                </div>
                
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-label">YTD Spend</div>
                        <div class="stat-value">$487,293</div>
                        <div class="stat-trend positive">‚Üì 8% vs last year</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Budget Remaining</div>
                        <div class="stat-value">$112,707</div>
                        <div class="stat-trend">18.8% left</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Top Category</div>
                        <div class="stat-value">HVAC</div>
                        <div class="stat-trend">$145,280 (30%)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Cost per Location</div>
                        <div class="stat-value">$60,911</div>
                        <div class="stat-trend">Average</div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Spend by Category</h3>
                    </div>
                    <div style="padding: 1.5rem;">
                        ${getSpendBars()}
                    </div>
                </div>
            `;
        }
        
        function getSpendBars() {
            const categories = [
                { name: 'HVAC', amount: 145280, percent: 30 },
                { name: 'Plumbing', amount: 87432, percent: 18 },
                { name: 'Electrical', amount: 72981, percent: 15 },
                { name: 'General Maintenance', amount: 181600, percent: 37 }
            ];
            
            return categories.map(cat => `
                <div style="margin-bottom: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>${cat.name}</span>
                        <strong>$${cat.amount.toLocaleString()} (${cat.percent}%)</strong>
                    </div>
                    <div style="height: 8px; background: var(--gray-200); border-radius: 4px;">
                        <div style="width: ${cat.percent}%; height: 100%; background: var(--primary); border-radius: 4px;"></div>
                    </div>
                </div>
            `).join('');
        }
        
        function getProfileContent() {
            return `
                <div class="header-bar">
                    <h1 class="header-title">Profile Settings</h1>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Account Information</h3>
                    </div>
                    <div style="padding: 2rem;">
                        <form>
                            <div class="form-group">
                                <label class="form-label">Name</label>
                                <input type="text" class="form-input" value="John Doe">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-input" value="john.doe@mcdonalds.com">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Phone</label>
                                <input type="tel" class="form-input" value="(555) 123-4567">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Role</label>
                                <input type="text" class="form-input" value="Facility Manager" readonly>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="saveProfile()">Save Changes</button>
                        </form>
                    </div>
                </div>
            `;
        }
        
        function getTeamManagementContent() {
            return `
                <div class="header-bar">
                    <h1 class="header-title">Team Management</h1>
                    <button class="btn btn-primary" onclick="openAddTeamMemberModal()">+ Add Team Member</button>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Team Members</h3>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Permissions</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>John Doe</td>
                                <td>john.doe@nicerestaurant.com</td>
                                <td>Admin</td>
                                <td>Full Access</td>
                                <td><span class="badge badge-success">Active</span></td>
                                <td>
                                    <button class="btn-icon" onclick="editTeamMember('1')">‚úèÔ∏è</button>
                                    <button class="btn-icon" onclick="removeTeamMember('1')">üóëÔ∏è</button>
                                </td>
                            </tr>
                            <tr>
                                <td>Jane Smith</td>
                                <td>jane.smith@nicerestaurant.com</td>
                                <td>Manager</td>
                                <td>Location Management</td>
                                <td><span class="badge badge-success">Active</span></td>
                                <td>
                                    <button class="btn-icon" onclick="editTeamMember('2')">‚úèÔ∏è</button>
                                    <button class="btn-icon" onclick="removeTeamMember('2')">üóëÔ∏è</button>
                                </td>
                            </tr>
                            <tr>
                                <td>Mike Wilson</td>
                                <td>mike.wilson@nicerestaurant.com</td>
                                <td>Viewer</td>
                                <td>Read Only</td>
                                <td><span class="badge badge-success">Active</span></td>
                                <td>
                                    <button class="btn-icon" onclick="editTeamMember('3')">‚úèÔ∏è</button>
                                    <button class="btn-icon" onclick="removeTeamMember('3')">üóëÔ∏è</button>
                                </td>
                            </tr>
                            <tr>
                                <td>Sarah Johnson</td>
                                <td>sarah.johnson@nicerestaurant.com</td>
                                <td>Accountant</td>
                                <td>Billing & Invoices</td>
                                <td><span class="badge badge-warning">Pending</span></td>
                                <td>
                                    <button class="btn-icon" onclick="resendInvite('4')">üìß</button>
                                    <button class="btn-icon" onclick="removeTeamMember('4')">üóëÔ∏è</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Add Team Member Modal -->
                <div id="addTeamMemberModal" class="modal" style="display: none;">
                    <div class="modal-content" style="max-width: 600px;">
                        <div class="modal-header">
                            <h2>Add Team Member</h2>
                            <span class="close" onclick="closeAddTeamMemberModal()">&times;</span>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">First Name</label>
                                <input type="text" class="form-input" id="teamFirstName" placeholder="Enter first name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Last Name</label>
                                <input type="text" class="form-input" id="teamLastName" placeholder="Enter last name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-input" id="teamEmail" placeholder="Enter email address">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Phone</label>
                                <input type="tel" class="form-input" id="teamPhone" placeholder="Enter phone number">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Role</label>
                                <select class="form-input" id="teamRole" onchange="updatePermissions()">
                                    <option value="">Select a role</option>
                                    <option value="admin">Admin</option>
                                    <option value="manager">Manager</option>
                                    <option value="accountant">Accountant</option>
                                    <option value="viewer">Viewer</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Permissions</label>
                                <div id="permissionsList" style="display: grid; gap: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" id="perm1"> View Work Orders
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" id="perm2"> Create Work Orders
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" id="perm3"> Manage Billing
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" id="perm4"> View Reports
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" id="perm5"> Manage Team
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="sendInvite" checked>
                                    Send invitation email
                                </label>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeAddTeamMemberModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="addTeamMember()">Add Team Member</button>
                        </div>
                    </div>
                </div>
                
                <!-- Quality Assurance Review Modal -->
                <div id="qaReviewModal" class="modal" style="display: none;">
                    <div class="modal-content" style="max-width: 900px;">
                        <div class="modal-header">
                            <h2>Quality Assurance Review</h2>
                            <span class="close" onclick="closeQAReviewModal()">&times;</span>
                        </div>
                        <div class="modal-body">
                            <div style="background: var(--info-light); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                                <h4 id="qaWorkOrderTitle">Work Order: WO-2024-002</h4>
                                <p id="qaWorkOrderDetails">Plumbing Leak - Burger King - Melrose</p>
                                <p><strong>Completed by:</strong> XYZ Plumbing | <strong>Cost:</strong> $875</p>
                            </div>
                            
                            <!-- Photo Verification Section -->
                            <div style="margin-bottom: 2rem;">
                                <h4 style="margin-bottom: 1rem;">üì∏ Before & After Photos</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                                    <div>
                                        <h5 style="margin-bottom: 0.5rem;">Before Work</h5>
                                        <div style="border: 2px dashed var(--gray-300); border-radius: 8px; padding: 2rem; text-align: center; background: var(--gray-50);">
                                            <img src="https://via.placeholder.com/300x200?text=Leak+Under+Sink" style="max-width: 100%; border-radius: 4px;" alt="Before photo">
                                            <p style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--gray-600);">Leak under kitchen sink</p>
                                        </div>
                                    </div>
                                    <div>
                                        <h5 style="margin-bottom: 0.5rem;">After Work</h5>
                                        <div style="border: 2px dashed var(--gray-300); border-radius: 8px; padding: 2rem; text-align: center; background: var(--gray-50);">
                                            <img src="https://via.placeholder.com/300x200?text=Repaired+Plumbing" style="max-width: 100%; border-radius: 4px;" alt="After photo">
                                            <p style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--gray-600);">Repaired pipe connections</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Work Summary -->
                            <div style="background: white; border: 1px solid var(--gray-200); border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
                                <h4 style="margin-bottom: 1rem;">Work Completed Summary</h4>
                                <ul style="list-style: none; padding: 0; margin: 0;">
                                    <li style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                        <span style="color: var(--success);">‚úì</span>
                                        <span>Replaced damaged pipe section under kitchen sink</span>
                                    </li>
                                    <li style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                        <span style="color: var(--success);">‚úì</span>
                                        <span>Tightened all connection joints</span>
                                    </li>
                                    <li style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                        <span style="color: var(--success);">‚úì</span>
                                        <span>Tested for leaks - no issues found</span>
                                    </li>
                                    <li style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                        <span style="color: var(--success);">‚úì</span>
                                        <span>Cleaned work area</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <!-- Quality Assessment -->
                            <div style="margin-bottom: 2rem;">
                                <h4 style="margin-bottom: 1rem;">Quality Assessment</h4>
                                <div style="display: grid; gap: 1rem;">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span><strong>Work Quality:</strong></span>
                                        <div id="workQualityRating">
                                            <button class="star-rating" onclick="setRating('quality', 1)">‚òÖ</button>
                                            <button class="star-rating" onclick="setRating('quality', 2)">‚òÖ</button>
                                            <button class="star-rating" onclick="setRating('quality', 3)">‚òÖ</button>
                                            <button class="star-rating" onclick="setRating('quality', 4)">‚òÖ</button>
                                            <button class="star-rating" onclick="setRating('quality', 5)">‚òÖ</button>
                                        </div>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span><strong>Timeliness:</strong></span>
                                        <div id="timelinessRating">
                                            <button class="star-rating" onclick="setRating('timeliness', 1)">‚òÖ</button>
                                            <button class="star-rating" onclick="setRating('timeliness', 2)">‚òÖ</button>
                                            <button class="star-rating" onclick="setRating('timeliness', 3)">‚òÖ</button>
                                            <button class="star-rating" onclick="setRating('timeliness', 4)">‚òÖ</button>
                                            <button class="star-rating" onclick="setRating('timeliness', 5)">‚òÖ</button>
                                        </div>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span><strong>Communication:</strong></span>
                                        <div id="communicationRating">
                                            <button class="star-rating" onclick="setRating('communication', 1)">‚òÖ</button>
                                            <button class="star-rating" onclick="setRating('communication', 2)">‚òÖ</button>
                                            <button class="star-rating" onclick="setRating('communication', 3)">‚òÖ</button>
                                            <button class="star-rating" onclick="setRating('communication', 4)">‚òÖ</button>
                                            <button class="star-rating" onclick="setRating('communication', 5)">‚òÖ</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Comments Section -->
                            <div style="margin-bottom: 2rem;">
                                <label class="form-label"><strong>Additional Comments (Optional)</strong></label>
                                <textarea class="form-input" id="qaComments" rows="4" placeholder="Share any feedback about the work performed..."></textarea>
                            </div>
                            
                            <!-- Approval Decision -->
                            <div style="background: var(--gray-50); padding: 1.5rem; border-radius: 8px;">
                                <h4 style="margin-bottom: 1rem;">Approval Decision</h4>
                                <div style="display: flex; gap: 1rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="radio" name="approval" value="approve" id="approveWork">
                                        <span style="color: var(--success); font-weight: 600;">‚úì Approve Work</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="radio" name="approval" value="request-changes" id="requestChanges">
                                        <span style="color: var(--warning); font-weight: 600;">‚ö† Request Changes</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="radio" name="approval" value="reject" id="rejectWork">
                                        <span style="color: var(--danger); font-weight: 600;">‚úó Reject Work</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeQAReviewModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="submitQAReview()">Submit Review</button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getSettingsContent() {
            return `
                <div class="header-bar">
                    <h1 class="header-title">Settings</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="showMobileAppSetup()">
                            üì± Mobile App Setup
                        </button>
                    </div>
                </div>
                
                <!-- Mobile App Integration Status -->
                <div style="background: linear-gradient(135deg, var(--primary-light), var(--primary)); color: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="margin: 0 0 0.5rem 0;">Hey Spruce Mobile App</h3>
                            <p style="margin: 0; opacity: 0.9;">Stay connected with your facilities on the go</p>
                        </div>
                        <div style="text-align: right;">
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <button class="btn btn-sm" style="background: white; color: var(--primary);" onclick="downloadApp('ios')">
                                    üçé Download iOS
                                </button>
                                <button class="btn btn-sm" style="background: white; color: var(--primary);" onclick="downloadApp('android')">
                                    ü§ñ Download Android
                                </button>
                            </div>
                            <div style="font-size: 0.875rem;">
                                <span style="display: inline-flex; align-items: center; gap: 0.25rem;">
                                    <span style="width: 8px; height: 8px; background: #4ade80; border-radius: 50%;"></span>
                                    3 devices connected
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Notification Preferences</h3>
                    </div>
                    <div style="padding: 2rem;">
                        <div style="display: grid; gap: 1.5rem;">
                            <!-- Work Order Updates -->
                            <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 1rem;">
                                <div style="font-weight: 600; margin-bottom: 0.5rem;">Work Order Updates</div>
                                <div style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 1rem;">Receive notifications when work orders are created, updated, or completed</div>
                                <div style="display: flex; gap: 1rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked>
                                        <span>Email</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked>
                                        <span>Text</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox">
                                        <span>App</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Quote Notifications -->
                            <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 1rem;">
                                <div style="font-weight: 600; margin-bottom: 0.5rem;">Quote Notifications</div>
                                <div style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 1rem;">Get notified about new quotes, approvals, and expirations</div>
                                <div style="display: flex; gap: 1rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked>
                                        <span>Email</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox">
                                        <span>Text</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked>
                                        <span>App</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Invoice & Payment -->
                            <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 1rem;">
                                <div style="font-weight: 600; margin-bottom: 0.5rem;">Invoice & Payment Notifications</div>
                                <div style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 1rem;">Receive alerts for new invoices and payment confirmations</div>
                                <div style="display: flex; gap: 1rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked>
                                        <span>Email</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox">
                                        <span>Text</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox">
                                        <span>App</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Emergency Alerts -->
                            <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 1rem;">
                                <div style="font-weight: 600; margin-bottom: 0.5rem;">Emergency Service Alerts</div>
                                <div style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 1rem;">Get immediate notifications for emergency service requests</div>
                                <div style="display: flex; gap: 1rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked>
                                        <span>Email</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked>
                                        <span>Text</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked>
                                        <span>App</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <button type="button" class="btn btn-primary" style="margin-top: 1.5rem;" onclick="saveNotificationSettings()">Save Notification Settings</button>
                    </div>
                </div>
            `;
        }
        
        function getNotificationsContent() {
            return `
                <div class="header-bar">
                    <h1 class="header-title">Notifications</h1>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Recent Notifications</h3>
                        <button class="btn btn-secondary" onclick="markAllRead()">Mark All Read</button>
                    </div>
                    <div style="padding: 1rem;">
                        ${getNotificationItems()}
                    </div>
                </div>
            `;
        }
        
        function getNotificationItems() {
            const notifications = [
                { type: 'success', title: 'Work Order Completed', message: 'WO-2024-001 has been completed by ABC Maintenance', time: '2 hours ago', unread: true },
                { type: 'warning', title: 'Quote Expiring Soon', message: 'Quote Q-2024-015 will expire in 2 days', time: '5 hours ago', unread: true },
                { type: 'info', title: 'New Invoice', message: 'Invoice INV-2024-089 is ready for payment', time: '1 day ago', unread: true }
            ];
            
            return notifications.map(notif => `
                <div style="padding: 1rem; border-bottom: 1px solid var(--gray-200); ${notif.unread ? 'background: var(--gray-50);' : ''}">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <div style="font-weight: 600; margin-bottom: 0.25rem;">${notif.title}</div>
                            <div style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 0.25rem;">${notif.message}</div>
                            <div style="font-size: 0.75rem; color: var(--gray-500);">${notif.time}</div>
                        </div>
                        ${notif.unread ? '<span style="width: 8px; height: 8px; background: var(--primary); border-radius: 50%;"></span>' : ''}
                    </div>
                </div>
            `).join('');
        }
        
        function getUserAdminContent() {
            return `
                <div class="header-bar">
                    <h1 class="header-title">User Administration</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="showAddUserModal()">+ Add User</button>
                        <button class="btn btn-secondary" onclick="showBulkInviteModal()">Bulk Invite</button>
                    </div>
                </div>
                
                <!-- Role Overview Cards -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 2rem;">
                    <div class="stat-card">
                        <div class="stat-label">Corporate Admins</div>
                        <div class="stat-value">3</div>
                        <div class="stat-trend">Full access to all locations</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Regional Managers</div>
                        <div class="stat-value">8</div>
                        <div class="stat-trend">Multi-location access</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Location Managers</div>
                        <div class="stat-value">12</div>
                        <div class="stat-trend">Single location access</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Pending Invites</div>
                        <div class="stat-value">5</div>
                        <div class="stat-trend negative">Awaiting acceptance</div>
                    </div>
                </div>
                
                <!-- User Filters -->
                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; align-items: center;">
                    <select class="form-select" style="width: 150px;" onchange="filterUsersByRole()">
                        <option value="">All Roles</option>
                        <option value="corporate_admin">Corporate Admin</option>
                        <option value="regional_manager">Regional Manager</option>
                        <option value="location_manager">Location Manager</option>
                        <option value="staff">Staff</option>
                    </select>
                    <select class="form-select" style="width: 200px;" onchange="filterUsersByLocation()">
                        <option value="">All Locations</option>
                        <option value="corporate">Corporate (All Locations)</option>
                        <option value="mcdonalds-sunset">McDonald's - Sunset</option>
                        <option value="burger-king-melrose">Burger King - Melrose</option>
                        <option value="delilah-la">Delilah LA</option>
                        <option value="craigs">Craig's</option>
                    </select>
                    <select class="form-select" style="width: 150px;" onchange="filterUsersByStatus()">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="pending">Pending</option>
                        <option value="suspended">Suspended</option>
                    </select>
                    <input type="search" class="form-input" placeholder="Search users..." style="width: 300px;" onkeyup="searchUsers()">
                    <button class="btn btn-secondary" onclick="exportUsers()">Export</button>
                </div>
                
                <!-- Users Table -->
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Users & Permissions</h3>
                        <div style="display: flex; gap: 1rem;">
                            <button class="btn btn-secondary" onclick="showRoleManagementModal()">Manage Roles</button>
                            <button class="btn btn-secondary" onclick="showPermissionTemplatesModal()">Permission Templates</button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Role</th>
                                <th>Location Access</th>
                                <th>Last Login</th>
                                <th>Status</th>
                                <th>Permissions</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                                        <div class="user-avatar" style="width: 32px; height: 32px;">JD</div>
                                        <div>
                                            <div style="font-weight: 600;">John Doe</div>
                                            <div style="font-size: 0.875rem; color: var(--gray-600);">john.doe@mcdonalds.com</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="status-badge" style="background: var(--danger-light); color: var(--danger);">Corporate Admin</span>
                                </td>
                                <td>
                                    <span style="font-size: 0.875rem; color: var(--gray-600);">All Locations (4)</span>
                                    <div style="font-size: 0.75rem; color: var(--success);">Full Access</div>
                                </td>
                                <td>2 hours ago</td>
                                <td><span class="status-badge completed">Active</span></td>
                                <td>
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                                        <span style="background: var(--gray-100); padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 0.75rem;">Admin</span>
                                        <span style="background: var(--gray-100); padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 0.75rem;">Users</span>
                                        <span style="background: var(--gray-100); padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 0.75rem;">Reports</span>
                                        <span style="background: var(--gray-100); padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 0.75rem;">+5</span>
                                    </div>
                                </td>
                                <td>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button class="btn btn-sm btn-secondary" onclick="editUser('john-doe')">Edit</button>
                                        <button class="btn btn-sm btn-secondary" onclick="viewUserPermissions('john-doe')">Permissions</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                                        <div class="user-avatar" style="width: 32px; height: 32px; background: var(--secondary);">SM</div>
                                        <div>
                                            <div style="font-weight: 600;">Sarah Miller</div>
                                            <div style="font-size: 0.875rem; color: var(--gray-600);">sarah.miller@mcdonalds.com</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="status-badge" style="background: var(--warning-light); color: var(--warning);">Regional Manager</span>
                                </td>
                                <td>
                                    <span style="font-size: 0.875rem; color: var(--gray-600);">West Hollywood Region (2)</span>
                                    <div style="font-size: 0.75rem; color: var(--gray-500);">McDonald's, Burger King</div>
                                </td>
                                <td>1 day ago</td>
                                <td><span class="status-badge completed">Active</span></td>
                                <td>
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                                        <span style="background: var(--gray-100); padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 0.75rem;">WO</span>
                                        <span style="background: var(--gray-100); padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 0.75rem;">Quotes</span>
                                        <span style="background: var(--gray-100); padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 0.75rem;">Reports</span>
                                    </div>
                                </td>
                                <td>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button class="btn btn-sm btn-secondary" onclick="editUser('sarah-miller')">Edit</button>
                                        <button class="btn btn-sm btn-secondary" onclick="viewUserPermissions('sarah-miller')">Permissions</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                                        <div class="user-avatar" style="width: 32px; height: 32px; background: var(--success);">MJ</div>
                                        <div>
                                            <div style="font-weight: 600;">Mike Johnson</div>
                                            <div style="font-size: 0.875rem; color: var(--gray-600);">mike.johnson@delilah-la.com</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="status-badge" style="background: var(--info-light); color: var(--info);">Location Manager</span>
                                </td>
                                <td>
                                    <span style="font-size: 0.875rem; color: var(--gray-600);">Delilah LA Only</span>
                                    <div style="font-size: 0.75rem; color: var(--gray-500);">Single Location Access</div>
                                </td>
                                <td>3 hours ago</td>
                                <td><span class="status-badge completed">Active</span></td>
                                <td>
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                                        <span style="background: var(--gray-100); padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 0.75rem;">WO</span>
                                        <span style="background: var(--gray-100); padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 0.75rem;">Assets</span>
                                    </div>
                                </td>
                                <td>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button class="btn btn-sm btn-secondary" onclick="editUser('mike-johnson')">Edit</button>
                                        <button class="btn btn-sm btn-secondary" onclick="viewUserPermissions('mike-johnson')">Permissions</button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                                        <div class="user-avatar" style="width: 32px; height: 32px; background: var(--gray-400);">LS</div>
                                        <div>
                                            <div style="font-weight: 600;">Lisa Smith</div>
                                            <div style="font-size: 0.875rem; color: var(--gray-600);">lisa.smith@mcdonalds.com</div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="status-badge" style="background: var(--gray-100); color: var(--gray-600);">Staff</span>
                                </td>
                                <td>
                                    <span style="font-size: 0.875rem; color: var(--gray-600);">McDonald's - Sunset</span>
                                    <div style="font-size: 0.75rem; color: var(--gray-500);">Limited Access</div>
                                </td>
                                <td>
                                    <span style="color: var(--warning);">Pending Invitation</span>
                                </td>
                                <td><span class="status-badge pending">Pending</span></td>
                                <td>
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.25rem;">
                                        <span style="background: var(--gray-100); padding: 0.125rem 0.375rem; border-radius: 4px; font-size: 0.75rem;">View Only</span>
                                    </div>
                                </td>
                                <td>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button class="btn btn-sm btn-secondary" onclick="resendInvite('lisa-smith')">Resend</button>
                                        <button class="btn btn-sm btn-danger" onclick="cancelInvite('lisa-smith')">Cancel</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Permission Templates -->
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Quick Permission Templates</h3>
                        <button class="btn btn-secondary" onclick="showCreateTemplateModal()">+ Create Template</button>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; padding: 1.5rem;">
                        <div class="action-card" onclick="applyPermissionTemplate('full-access')">
                            <div class="action-icon" style="background: var(--danger-light); color: var(--danger);">üëë</div>
                            <div class="action-title">Full Access</div>
                            <div class="action-description">All permissions across all locations</div>
                            <div style="font-size: 0.75rem; color: var(--gray-600); margin-top: 0.5rem;">8 permissions ‚Ä¢ Corporate Level</div>
                        </div>
                        <div class="action-card" onclick="applyPermissionTemplate('location-manager')">
                            <div class="action-icon" style="background: var(--warning-light); color: var(--warning); font-weight: bold;">B</div>
                            <div class="action-title">Location Manager</div>
                            <div class="action-description">Manage work orders, assets, and reports for assigned locations</div>
                            <div style="font-size: 0.75rem; color: var(--gray-600); margin-top: 0.5rem;">5 permissions ‚Ä¢ Location Level</div>
                        </div>
                        <div class="action-card" onclick="applyPermissionTemplate('staff-member')">
                            <div class="action-icon" style="background: var(--info-light); color: var(--info); font-weight: bold;">U</div>
                            <div class="action-title">Staff Member</div>
                            <div class="action-description">View work orders and submit basic requests</div>
                            <div style="font-size: 0.75rem; color: var(--gray-600); margin-top: 0.5rem;">2 permissions ‚Ä¢ Read Only</div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getBillingContent() {
            return `
                <div class="header-bar">
                    <h1 class="header-title">Billing & Payments</h1>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Payment Methods</h3>
                        <button class="btn btn-primary" onclick="addPaymentMethod()">+ Add Method</button>
                    </div>
                    <div style="padding: 1.5rem;">
                        <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 600;">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4242</div>
                                    <div style="font-size: 0.875rem; color: var(--gray-600);">Expires 12/25</div>
                                </div>
                                <span class="status-badge completed">Default</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Modal Functions
        function showRecurringServices() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-overlay" onclick="this.parentElement.remove()"></div>
                <div class="modal-content" style="max-width: 900px;">
                    <div class="modal-header">
                        <h2>Recurring Service Schedules</h2>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div style="margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center;">
                            <h3>Active Recurring Services</h3>
                            <button class="btn btn-primary" onclick="showAddRecurringService()">+ Add Recurring Service</button>
                        </div>
                        
                        <div class="recurring-services-list">
                            <div class="recurring-service-card" style="background: white; border: 1px solid var(--gray-200); border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                    <div>
                                        <h4 style="margin: 0 0 0.5rem 0;">HVAC Maintenance - All Locations</h4>
                                        <div style="display: flex; gap: 1rem; color: var(--gray-600); font-size: 0.875rem;">
                                            <span>üìÖ Monthly (First Monday)</span>
                                            <span>üè¢ 5 Locations</span>
                                            <span>üí∞ $2,500/month</span>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button class="btn btn-sm" onclick="editRecurringService(1)">Edit</button>
                                        <button class="btn btn-sm btn-danger" onclick="pauseRecurringService(1)">Pause</button>
                                    </div>
                                </div>
                                <div style="background: var(--gray-50); padding: 1rem; border-radius: 4px;">
                                    <div style="font-size: 0.875rem; color: var(--gray-700);">
                                        <strong>Next Service:</strong> Monday, December 2, 2024<br>
                                        <strong>Vendor:</strong> CoolAir HVAC Services<br>
                                        <strong>Services Completed:</strong> 11 of 12 this year
                                    </div>
                                </div>
                            </div>
                            
                            <div class="recurring-service-card" style="background: white; border: 1px solid var(--gray-200); border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                    <div>
                                        <h4 style="margin: 0 0 0.5rem 0;">Deep Cleaning - Kitchen Areas</h4>
                                        <div style="display: flex; gap: 1rem; color: var(--gray-600); font-size: 0.875rem;">
                                            <span>üìÖ Weekly (Sundays)</span>
                                            <span>üè¢ 3 Restaurants</span>
                                            <span>üí∞ $1,200/week</span>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button class="btn btn-sm" onclick="editRecurringService(2)">Edit</button>
                                        <button class="btn btn-sm btn-danger" onclick="pauseRecurringService(2)">Pause</button>
                                    </div>
                                </div>
                                <div style="background: var(--gray-50); padding: 1rem; border-radius: 4px;">
                                    <div style="font-size: 0.875rem; color: var(--gray-700);">
                                        <strong>Next Service:</strong> Sunday, December 1, 2024<br>
                                        <strong>Vendor:</strong> Sparkle Clean Pro<br>
                                        <strong>Services Completed:</strong> 47 of 52 this year
                                    </div>
                                </div>
                            </div>
                            
                            <div class="recurring-service-card" style="background: white; border: 1px solid var(--gray-200); border-radius: 8px; padding: 1.5rem; margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                    <div>
                                        <h4 style="margin: 0 0 0.5rem 0;">Pest Control Service</h4>
                                        <div style="display: flex; gap: 1rem; color: var(--gray-600); font-size: 0.875rem;">
                                            <span>üìÖ Quarterly</span>
                                            <span>üè¢ All Locations</span>
                                            <span>üí∞ $3,000/quarter</span>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button class="btn btn-sm" onclick="editRecurringService(3)">Edit</button>
                                        <button class="btn btn-sm btn-danger" onclick="pauseRecurringService(3)">Pause</button>
                                    </div>
                                </div>
                                <div style="background: var(--gray-50); padding: 1rem; border-radius: 4px;">
                                    <div style="font-size: 0.875rem; color: var(--gray-700);">
                                        <strong>Next Service:</strong> January 15, 2025<br>
                                        <strong>Vendor:</strong> SafeGuard Pest Solutions<br>
                                        <strong>Services Completed:</strong> 3 of 4 this year
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function showAddRecurringService() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-overlay" onclick="this.parentElement.remove()"></div>
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h2>Create Recurring Service Schedule</h2>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form onsubmit="event.preventDefault(); saveRecurringService();">
                            <div class="form-group">
                                <label>Service Type</label>
                                <select class="form-select" required>
                                    <option value="">Select service type...</option>
                                    <option>HVAC Maintenance</option>
                                    <option>Cleaning Services</option>
                                    <option>Pest Control</option>
                                    <option>Landscaping</option>
                                    <option>Equipment Inspection</option>
                                    <option>Fire System Testing</option>
                                    <option>Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Frequency</label>
                                <select class="form-select" required onchange="updateFrequencyOptions(this.value)">
                                    <option value="">Select frequency...</option>
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="biweekly">Bi-weekly</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                    <option value="semiannual">Semi-annual</option>
                                    <option value="annual">Annual</option>
                                </select>
                            </div>
                            
                            <div id="frequencyOptions" style="display: none;">
                                <div class="form-group">
                                    <label>Schedule Details</label>
                                    <div id="scheduleOptions"></div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Locations</label>
                                <div style="max-height: 150px; overflow-y: auto; border: 1px solid var(--gray-200); border-radius: 6px; padding: 0.5rem;">
                                    <label style="display: block; padding: 0.5rem;"><input type="checkbox" checked> All Locations</label>
                                    <label style="display: block; padding: 0.5rem;"><input type="checkbox"> McDonald's - Sunset</label>
                                    <label style="display: block; padding: 0.5rem;"><input type="checkbox"> Burger King - Melrose</label>
                                    <label style="display: block; padding: 0.5rem;"><input type="checkbox"> Delilah LA</label>
                                    <label style="display: block; padding: 0.5rem;"><input type="checkbox"> The Nice Guy</label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Preferred Vendor</label>
                                <select class="form-select">
                                    <option>Auto-assign based on availability</option>
                                    <option>CoolAir HVAC Services</option>
                                    <option>Sparkle Clean Pro</option>
                                    <option>SafeGuard Pest Solutions</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Budget Per Service</label>
                                <input type="number" class="form-input" placeholder="Enter amount" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Start Date</label>
                                <input type="date" class="form-input" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Auto-Approval</label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked>
                                    <span>Automatically approve work orders within budget</span>
                                </label>
                            </div>
                            
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                                <button type="submit" class="btn btn-primary">Create Schedule</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function updateFrequencyOptions(frequency) {
            const optionsDiv = document.getElementById('frequencyOptions');
            const scheduleDiv = document.getElementById('scheduleOptions');
            
            if (!frequency) {
                optionsDiv.style.display = 'none';
                return;
            }
            
            optionsDiv.style.display = 'block';
            
            switch(frequency) {
                case 'weekly':
                    scheduleDiv.innerHTML = `
                        <select class="form-select">
                            <option>Every Monday</option>
                            <option>Every Tuesday</option>
                            <option>Every Wednesday</option>
                            <option>Every Thursday</option>
                            <option>Every Friday</option>
                            <option>Every Saturday</option>
                            <option>Every Sunday</option>
                        </select>
                    `;
                    break;
                case 'monthly':
                    scheduleDiv.innerHTML = `
                        <select class="form-select">
                            <option>First Monday</option>
                            <option>Second Monday</option>
                            <option>Third Monday</option>
                            <option>Last Monday</option>
                            <option>On the 1st</option>
                            <option>On the 15th</option>
                            <option>Last day of month</option>
                        </select>
                    `;
                    break;
                case 'quarterly':
                    scheduleDiv.innerHTML = `
                        <input type="text" class="form-input" placeholder="e.g., Jan 15, Apr 15, Jul 15, Oct 15">
                    `;
                    break;
                default:
                    scheduleDiv.innerHTML = `
                        <input type="text" class="form-input" placeholder="Specify schedule details">
                    `;
            }
        }
        
        function saveRecurringService() {
            alert('Recurring service schedule created successfully!');
            document.querySelector('.modal').remove();
        }
        
        function editRecurringService(id) {
            showAddRecurringService();
        }
        
        function pauseRecurringService(id) {
            if (confirm('Are you sure you want to pause this recurring service?')) {
                alert('Service paused. You can resume it anytime from the recurring services menu.');
            }
        }
        
        function showServiceHistory() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-overlay" onclick="this.parentElement.remove()"></div>
                <div class="modal-content" style="max-width: 1000px;">
                    <div class="modal-header">
                        <h2>Service History Timeline</h2>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <!-- Filters -->
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                            <select class="form-select" style="width: 200px;">
                                <option>All Locations</option>
                                <option>McDonald's - Sunset</option>
                                <option>Burger King - Melrose</option>
                                <option>Delilah LA</option>
                            </select>
                            <select class="form-select" style="width: 150px;">
                                <option>All Services</option>
                                <option>HVAC</option>
                                <option>Plumbing</option>
                                <option>Electrical</option>
                                <option>Cleaning</option>
                            </select>
                            <select class="form-select" style="width: 150px;">
                                <option>Last 30 days</option>
                                <option>Last 90 days</option>
                                <option>Last 6 months</option>
                                <option>This year</option>
                            </select>
                            <button class="btn btn-secondary" onclick="exportServiceHistory()">Export Report</button>
                        </div>
                        
                        <!-- Timeline View Toggle -->
                        <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem;">
                            <button class="btn btn-sm btn-primary" onclick="setTimelineView('timeline')">Timeline View</button>
                            <button class="btn btn-sm" onclick="setTimelineView('calendar')">Calendar View</button>
                            <button class="btn btn-sm" onclick="setTimelineView('list')">List View</button>
                        </div>
                        
                        <!-- Service Timeline -->
                        <div class="service-timeline" style="position: relative; padding-left: 40px;">
                            <!-- Timeline Line -->
                            <div style="position: absolute; left: 15px; top: 0; bottom: 0; width: 2px; background: var(--gray-300);"></div>
                            
                            <!-- November 2024 -->
                            <div style="margin-bottom: 2rem;">
                                <h4 style="color: var(--primary); margin-bottom: 1rem;">November 2024</h4>
                                
                                <!-- Service Entry -->
                                <div style="position: relative; margin-bottom: 1.5rem;">
                                    <div style="position: absolute; left: -30px; width: 12px; height: 12px; background: var(--primary); border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);"></div>
                                    <div style="background: white; border: 1px solid var(--gray-200); border-radius: 8px; padding: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                            <div>
                                                <strong>Emergency AC Repair</strong>
                                                <div style="font-size: 0.875rem; color: var(--gray-600);">Nov 28, 2024 ‚Ä¢ 2:30 PM</div>
                                            </div>
                                            <span class="badge badge-danger">Emergency</span>
                                        </div>
                                        <p style="margin: 0.5rem 0; color: var(--gray-700);">Compressor replacement at McDonald's - Sunset</p>
                                        <div style="display: flex; gap: 1rem; font-size: 0.875rem; color: var(--gray-600);">
                                            <span>üîß CoolAir HVAC</span>
                                            <span>üí∞ $8,500</span>
                                            <span>‚è±Ô∏è 3.5 hours</span>
                                            <span>‚≠ê 5.0 rating</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Service Entry -->
                                <div style="position: relative; margin-bottom: 1.5rem;">
                                    <div style="position: absolute; left: -30px; width: 12px; height: 12px; background: var(--success); border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);"></div>
                                    <div style="background: white; border: 1px solid var(--gray-200); border-radius: 8px; padding: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                            <div>
                                                <strong>Monthly Deep Cleaning</strong>
                                                <div style="font-size: 0.875rem; color: var(--gray-600);">Nov 25, 2024 ‚Ä¢ 10:00 PM</div>
                                            </div>
                                            <span class="badge badge-success">Completed</span>
                                        </div>
                                        <p style="margin: 0.5rem 0; color: var(--gray-700);">Kitchen deep clean at all restaurant locations</p>
                                        <div style="display: flex; gap: 1rem; font-size: 0.875rem; color: var(--gray-600);">
                                            <span>üßπ Sparkle Clean Pro</span>
                                            <span>üí∞ $1,200</span>
                                            <span>‚è±Ô∏è 6 hours</span>
                                            <span>‚≠ê 4.5 rating</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Service Entry -->
                                <div style="position: relative; margin-bottom: 1.5rem;">
                                    <div style="position: absolute; left: -30px; width: 12px; height: 12px; background: var(--warning); border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);"></div>
                                    <div style="background: white; border: 1px solid var(--gray-200); border-radius: 8px; padding: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                            <div>
                                                <strong>Preventive Maintenance</strong>
                                                <div style="font-size: 0.875rem; color: var(--gray-600);">Nov 20, 2024 ‚Ä¢ 8:00 AM</div>
                                            </div>
                                            <span class="badge badge-warning">Scheduled</span>
                                        </div>
                                        <p style="margin: 0.5rem 0; color: var(--gray-700);">HVAC filter replacement and system check</p>
                                        <div style="display: flex; gap: 1rem; font-size: 0.875rem; color: var(--gray-600);">
                                            <span>üîß CoolAir HVAC</span>
                                            <span>üí∞ $450</span>
                                            <span>‚è±Ô∏è 2 hours</span>
                                            <span>‚≠ê 5.0 rating</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- October 2024 -->
                            <div style="margin-bottom: 2rem;">
                                <h4 style="color: var(--primary); margin-bottom: 1rem;">October 2024</h4>
                                
                                <!-- Service Entry -->
                                <div style="position: relative; margin-bottom: 1.5rem;">
                                    <div style="position: absolute; left: -30px; width: 12px; height: 12px; background: var(--success); border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);"></div>
                                    <div style="background: white; border: 1px solid var(--gray-200); border-radius: 8px; padding: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                            <div>
                                                <strong>Quarterly Pest Control</strong>
                                                <div style="font-size: 0.875rem; color: var(--gray-600);">Oct 15, 2024 ‚Ä¢ 6:00 AM</div>
                                            </div>
                                            <span class="badge badge-success">Completed</span>
                                        </div>
                                        <p style="margin: 0.5rem 0; color: var(--gray-700);">Pest control treatment at all locations</p>
                                        <div style="display: flex; gap: 1rem; font-size: 0.875rem; color: var(--gray-600);">
                                            <span>üêõ SafeGuard Pest</span>
                                            <span>üí∞ $3,000</span>
                                            <span>‚è±Ô∏è 4 hours</span>
                                            <span>‚≠ê 4.8 rating</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Summary Stats -->
                        <div style="background: var(--gray-50); padding: 1.5rem; border-radius: 8px; margin-top: 2rem;">
                            <h4 style="margin-bottom: 1rem;">Service Summary</h4>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;">
                                <div>
                                    <div style="font-size: 1.25rem; font-weight: bold; color: var(--primary);">47</div>
                                    <div style="font-size: 0.875rem; color: var(--gray-600);">Total Services</div>
                                </div>
                                <div>
                                    <div style="font-size: 1.25rem; font-weight: bold; color: var(--primary);">$45,280</div>
                                    <div style="font-size: 0.875rem; color: var(--gray-600);">Total Spent</div>
                                </div>
                                <div>
                                    <div style="font-size: 1.25rem; font-weight: bold; color: var(--primary);">4.7</div>
                                    <div style="font-size: 0.875rem; color: var(--gray-600);">Avg Rating</div>
                                </div>
                                <div>
                                    <div style="font-size: 1.25rem; font-weight: bold; color: var(--primary);">2.4h</div>
                                    <div style="font-size: 0.875rem; color: var(--gray-600);">Avg Response</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function getBudgetContent() {
            return `
                <div class="header-bar">
                    <h1 class="header-title">Budget & Approvals</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="showBudgetSettings()">
                            ‚öôÔ∏è Settings
                        </button>
                        <button class="btn btn-primary" onclick="showAddBudgetModal()">
                            + Add Budget
                        </button>
                    </div>
                </div>
                
                <!-- Budget Overview Cards -->
                <div class="stats-grid" style="margin-bottom: 1rem;">
                    <div class="stat-card">
                        <div class="stat-value">$125,000</div>
                        <div class="stat-label">Annual Budget</div>
                        <div class="stat-change positive">+15% vs last year</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">$87,420</div>
                        <div class="stat-label">Spent YTD</div>
                        <div class="stat-change">70% of budget</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">$37,580</div>
                        <div class="stat-label">Remaining</div>
                        <div class="stat-change">1 month left</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">5</div>
                        <div class="stat-label">Pending Approvals</div>
                        <div class="stat-change negative">Requires attention</div>
                    </div>
                </div>
                
                <!-- Pending Approvals -->
                <div class="table-container" style="margin-bottom: 2rem;">
                    <div class="table-header">
                        <h3 class="table-title">Pending Approvals</h3>
                        <button class="btn btn-secondary" onclick="approveAll()">Approve All</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Request Date</th>
                                <th>Work Order</th>
                                <th>Vendor</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Budget Category</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Nov 28, 2024</td>
                                <td><a href="#" style="color: var(--primary);">#WO-2024-1547</a></td>
                                <td>CoolAir HVAC</td>
                                <td>Emergency AC Repair - Compressor replacement</td>
                                <td style="font-weight: 600; color: var(--warning);">$8,500</td>
                                <td>Emergency Repairs</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="approveRequest(1)">Approve</button>
                                    <button class="btn btn-sm" onclick="viewRequestDetails(1)">Details</button>
                                </td>
                            </tr>
                            <tr>
                                <td>Nov 27, 2024</td>
                                <td><a href="#" style="color: var(--primary);">#WO-2024-1543</a></td>
                                <td>Elite Plumbing</td>
                                <td>Kitchen pipe replacement</td>
                                <td style="font-weight: 600;">$3,200</td>
                                <td>Plumbing</td>
                                <td>
                                    <button class="btn btn-sm btn-primary" onclick="approveRequest(2)">Approve</button>
                                    <button class="btn btn-sm" onclick="viewRequestDetails(2)">Details</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Budget Categories -->
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Budget Categories</h3>
                        <select class="form-select" style="width: 200px;" onchange="filterBudgetPeriod(this.value)">
                            <option>This Year</option>
                            <option>This Quarter</option>
                            <option>This Month</option>
                            <option>Last Year</option>
                        </select>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Annual Budget</th>
                                <th>Spent</th>
                                <th>Remaining</th>
                                <th>% Used</th>
                                <th>Status</th>
                                <th>Auto-Approve Limit</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="font-weight: 600;">HVAC Maintenance</td>
                                <td>$30,000</td>
                                <td>$24,500</td>
                                <td>$5,500</td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <div style="background: var(--gray-200); height: 8px; width: 100px; border-radius: 4px; overflow: hidden;">
                                            <div style="background: var(--warning); height: 100%; width: 82%;"></div>
                                        </div>
                                        <span>82%</span>
                                    </div>
                                </td>
                                <td><span class="badge badge-warning">High Usage</span></td>
                                <td>$2,000</td>
                            </tr>
                            <tr>
                                <td style="font-weight: 600;">Cleaning Services</td>
                                <td>$25,000</td>
                                <td>$18,750</td>
                                <td>$6,250</td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <div style="background: var(--gray-200); height: 8px; width: 100px; border-radius: 4px; overflow: hidden;">
                                            <div style="background: var(--primary); height: 100%; width: 75%;"></div>
                                        </div>
                                        <span>75%</span>
                                    </div>
                                </td>
                                <td><span class="badge badge-success">On Track</span></td>
                                <td>$1,500</td>
                            </tr>
                            <tr>
                                <td style="font-weight: 600;">Emergency Repairs</td>
                                <td>$20,000</td>
                                <td>$19,200</td>
                                <td>$800</td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <div style="background: var(--gray-200); height: 8px; width: 100px; border-radius: 4px; overflow: hidden;">
                                            <div style="background: var(--danger); height: 100%; width: 96%;"></div>
                                        </div>
                                        <span>96%</span>
                                    </div>
                                </td>
                                <td><span class="badge badge-danger">Over Budget</span></td>
                                <td>$5,000</td>
                            </tr>
                            <tr>
                                <td style="font-weight: 600;">Electrical</td>
                                <td>$15,000</td>
                                <td>$8,500</td>
                                <td>$6,500</td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <div style="background: var(--gray-200); height: 8px; width: 100px; border-radius: 4px; overflow: hidden;">
                                            <div style="background: var(--primary); height: 100%; width: 57%;"></div>
                                        </div>
                                        <span>57%</span>
                                    </div>
                                </td>
                                <td><span class="badge badge-success">On Track</span></td>
                                <td>$1,000</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        function showBudgetSettings() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-overlay" onclick="this.parentElement.remove()"></div>
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h2>Budget & Approval Settings</h2>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form onsubmit="event.preventDefault(); saveBudgetSettings();">
                            <div class="form-group">
                                <label>Approval Workflow</label>
                                <select class="form-select">
                                    <option>Single Approver</option>
                                    <option>Multi-level Approval</option>
                                    <option>Department-based</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Auto-Approval Threshold</label>
                                <input type="number" class="form-input" value="1000" placeholder="Maximum amount for auto-approval">
                                <small style="color: var(--gray-600);">Work orders under this amount are automatically approved</small>
                            </div>
                            
                            <div class="form-group">
                                <label>Budget Alert Threshold</label>
                                <select class="form-select">
                                    <option>75% of budget used</option>
                                    <option>80% of budget used</option>
                                    <option>90% of budget used</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Approval Notifications</label>
                                <label style="display: block; margin: 0.5rem 0;"><input type="checkbox" checked> Email notifications for pending approvals</label>
                                <label style="display: block; margin: 0.5rem 0;"><input type="checkbox" checked> Text alerts for urgent approvals</label>
                                <label style="display: block; margin: 0.5rem 0;"><input type="checkbox"> Daily digest of approval requests</label>
                            </div>
                            
                            <div class="form-group">
                                <label>Fiscal Year Start</label>
                                <select class="form-select">
                                    <option>January 1</option>
                                    <option>April 1</option>
                                    <option>July 1</option>
                                    <option>October 1</option>
                                </select>
                            </div>
                            
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                                <button type="submit" class="btn btn-primary">Save Settings</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function showAddBudgetModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-overlay" onclick="this.parentElement.remove()"></div>
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header">
                        <h2>Add Budget Category</h2>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form onsubmit="event.preventDefault(); saveBudgetCategory();">
                            <div class="form-group">
                                <label>Category Name</label>
                                <input type="text" class="form-input" placeholder="e.g., Landscaping" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Annual Budget</label>
                                <input type="number" class="form-input" placeholder="Enter amount" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Auto-Approve Limit</label>
                                <input type="number" class="form-input" placeholder="Maximum auto-approval amount">
                            </div>
                            
                            <div class="form-group">
                                <label>Assigned Locations</label>
                                <select class="form-select" multiple style="height: 120px;">
                                    <option selected>All Locations</option>
                                    <option>McDonald's - Sunset</option>
                                    <option>Burger King - Melrose</option>
                                    <option>Delilah LA</option>
                                </select>
                            </div>
                            
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                                <button type="submit" class="btn btn-primary">Add Category</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function approveRequest(id) {
            alert('Work order approved successfully!');
        }
        
        function viewRequestDetails(id) {
            alert('Opening work order details...');
        }
        
        function approveAll() {
            if (confirm('Are you sure you want to approve all pending requests?')) {
                alert('All pending requests have been approved.');
            }
        }
        
        function saveBudgetSettings() {
            alert('Budget settings saved successfully!');
            document.querySelector('.modal').remove();
        }
        
        function saveBudgetCategory() {
            alert('Budget category added successfully!');
            document.querySelector('.modal').remove();
        }
        
        function getDocumentsContent() {
            return `
                <div class="header-bar">
                    <h1 class="header-title">Document Management</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="showPendingSignatures()">
                            ‚úçÔ∏è Pending Signatures (2)
                        </button>
                        <button class="btn btn-secondary" onclick="showDocumentCategories()">
                            üìÅ Categories
                        </button>
                        <button class="btn btn-primary" onclick="showUploadDocumentModal()">
                            ‚Üë Upload Document
                        </button>
                    </div>
                </div>
                
                <!-- Document Workflow Status -->
                <div class=\"stats-grid\" style=\"margin-bottom: 1rem;\">
                    <div class=\"stat-card\">
                        <div class=\"stat-value\">358</div>
                        <div class=\"stat-label\">Total Documents</div>
                        <div class=\"stat-change\">12 added this month</div>
                    </div>
                    <div class=\"stat-card\">
                        <div class=\"stat-value\">2</div>
                        <div class=\"stat-label\">Awaiting Signature</div>
                        <div class=\"stat-change negative\">Action required</div>
                    </div>
                    <div class=\"stat-card\">
                        <div class=\"stat-value\">5</div>
                        <div class=\"stat-label\">Shared with Vendors</div>
                        <div class=\"stat-change\">Cross-portal access</div>
                    </div>
                    <div class=\"stat-card\">
                        <div class=\"stat-value\">15</div>
                        <div class=\"stat-label\">Contracts Active</div>
                        <div class=\"stat-change positive\">All digitally signed</div>
                    </div>
                </div>
                
                <!-- Search and Filters -->
                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; align-items: center;">
                    <input type="search" class="form-input" placeholder="Search documents..." style="flex: 1; max-width: 400px;">
                    <select class="form-select" style="width: 180px;">
                        <option>All Categories</option>
                        <option>Contracts</option>
                        <option>Invoices</option>
                        <option>Work Orders</option>
                        <option>Insurance</option>
                        <option>Compliance</option>
                        <option>Reports</option>
                    </select>
                    <select class="form-select" style="width: 150px;">
                        <option>All Locations</option>
                        <option>McDonald's - Sunset</option>
                        <option>Burger King - Melrose</option>
                        <option>Delilah LA</option>
                    </select>
                    <select class="form-select" style="width: 150px;">
                        <option>Last 30 days</option>
                        <option>Last 90 days</option>
                        <option>Last 6 months</option>
                        <option>This year</option>
                        <option>All time</option>
                    </select>
                </div>
                
                <!-- Document Categories Grid -->
                <div class="action-grid" style="margin-bottom: 2rem;">
                    <div class="action-card" onclick="filterDocumentCategory('contracts')">
                        <div class="action-icon">üìù</div>
                        <div class="action-title">Contracts</div>
                        <div class="action-description">24 documents</div>
                    </div>
                    <div class="action-card" onclick="filterDocumentCategory('invoices')">
                        <div class="action-icon">üí∞</div>
                        <div class="action-title">Invoices</div>
                        <div class="action-description">156 documents</div>
                    </div>
                    <div class="action-card" onclick="filterDocumentCategory('work-orders')">
                        <div class="action-icon">üîß</div>
                        <div class="action-title">Work Orders</div>
                        <div class="action-description">89 documents</div>
                    </div>
                    <div class="action-card" onclick="filterDocumentCategory('insurance')">
                        <div class="action-icon">üõü</div>
                        <div class="action-title">Insurance</div>
                        <div class="action-description">12 documents</div>
                    </div>
                    <div class="action-card" onclick="filterDocumentCategory('compliance')">
                        <div class="action-icon">‚úÖ</div>
                        <div class="action-title">Compliance</div>
                        <div class="action-description">35 documents</div>
                    </div>
                    <div class="action-card" onclick="filterDocumentCategory('reports')">
                        <div class="action-icon">üìä</div>
                        <div class="action-title">Reports</div>
                        <div class="action-description">42 documents</div>
                    </div>
                </div>
                
                <!-- Recent Documents Table -->
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Recent Documents</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-sm" onclick="toggleDocumentView()">Grid View</button>
                            <button class="btn btn-secondary" onclick="exportDocuments()">Export List</button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 40px;"><input type="checkbox" onclick="selectAllDocuments(this)"></th>
                                <th>Document Name</th>
                                <th>Category</th>
                                <th>Location</th>
                                <th>Uploaded By</th>
                                <th>Date</th>
                                <th>Size</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="checkbox" class="doc-select"></td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="color: var(--primary);">üìÑ</span>
                                        <a href="#" style="color: var(--primary); text-decoration: none;">Service Agreement - CoolAir HVAC.pdf</a>
                                    </div>
                                </td>
                                <td><span class="badge">Contract</span></td>
                                <td>All Locations</td>
                                <td>John Smith</td>
                                <td>Nov 28, 2024</td>
                                <td>2.4 MB</td>
                                <td>
                                    <button class="btn btn-sm" onclick="viewDocument(1)">View</button>
                                    <button class="btn btn-sm" onclick="downloadDocument(1)">Download</button>
                                    <button class="btn btn-sm" onclick="shareDocument(1)">Share</button>
                                    <button class="btn btn-sm btn-warning" onclick="requestSignature(1)">‚úçÔ∏è Request Signature</button>
                                </td>
                            </tr>
                            <tr>
                                <td><input type="checkbox" class="doc-select"></td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="color: var(--primary);">üìÑ</span>
                                        <a href="#" style="color: var(--primary); text-decoration: none;">Insurance Certificate 2024.pdf</a>
                                    </div>
                                </td>
                                <td><span class="badge">Insurance</span></td>
                                <td>McDonald's - Sunset</td>
                                <td>Sarah Johnson</td>
                                <td>Nov 27, 2024</td>
                                <td>1.8 MB</td>
                                <td>
                                    <button class="btn btn-sm" onclick="viewDocument(2)">View</button>
                                    <button class="btn btn-sm" onclick="downloadDocument(2)">Download</button>
                                    <button class="btn btn-sm" onclick="shareDocument(2)">Share</button>
                                    <button class="btn btn-sm btn-warning" onclick="requestSignature(2)">‚úçÔ∏è Request Signature</button>
                                </td>
                            </tr>
                            <tr>
                                <td><input type="checkbox" class="doc-select"></td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="color: var(--primary);">üìä</span>
                                        <a href="#" style="color: var(--primary); text-decoration: none;">Monthly Maintenance Report.xlsx</a>
                                    </div>
                                </td>
                                <td><span class="badge">Report</span></td>
                                <td>All Locations</td>
                                <td>Mike Wilson</td>
                                <td>Nov 25, 2024</td>
                                <td>456 KB</td>
                                <td>
                                    <button class="btn btn-sm" onclick="viewDocument(3)">View</button>
                                    <button class="btn btn-sm" onclick="downloadDocument(3)">Download</button>
                                    <button class="btn btn-sm" onclick="shareDocument(3)">Share</button>
                                    <button class="btn btn-sm btn-warning" onclick="requestSignature(3)">‚úçÔ∏è Request Signature</button>
                                </td>
                            </tr>
                            <tr>
                                <td><input type="checkbox" class="doc-select"></td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="color: var(--primary);">üìÑ</span>
                                        <a href="#" style="color: var(--primary); text-decoration: none;">Fire Safety Compliance Certificate.pdf</a>
                                    </div>
                                </td>
                                <td><span class="badge">Compliance</span></td>
                                <td>Delilah LA</td>
                                <td>Amanda Brown</td>
                                <td>Nov 24, 2024</td>
                                <td>892 KB</td>
                                <td>
                                    <button class="btn btn-sm" onclick="viewDocument(4)">View</button>
                                    <button class="btn btn-sm" onclick="downloadDocument(4)">Download</button>
                                    <button class="btn btn-sm" onclick="shareDocument(4)">Share</button>
                                    <button class="btn btn-sm btn-warning" onclick="requestSignature(4)">‚úçÔ∏è Request Signature</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Bulk Actions Bar -->
                <div id="bulkActionsBar" style="display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--gray-900); color: white; padding: 1rem 2rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1000;">
                    <span id="selectedCount">0 documents selected</span>
                    <button class="btn btn-sm" style="margin-left: 1rem;" onclick="bulkDownload()">Download All</button>
                    <button class="btn btn-sm" onclick="bulkShare()">Share</button>
                    <button class="btn btn-sm btn-danger" onclick="bulkDelete()">Delete</button>
                    <button class="btn btn-sm" onclick="clearSelection()">Clear</button>
                </div>
            `;
        }
        
        function showUploadDocumentModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-overlay" onclick="this.parentElement.remove()"></div>
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h2>Upload Document</h2>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <form onsubmit="event.preventDefault(); uploadDocument();">
                            <div class="form-group">
                                <label>Select Files</label>
                                <div style="border: 2px dashed var(--gray-300); border-radius: 8px; padding: 2rem; text-align: center; cursor: pointer;" onclick="document.getElementById('fileInput').click()">
                                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìÅ</div>
                                    <p>Click to browse or drag and drop files here</p>
                                    <p style="font-size: 0.875rem; color: var(--gray-600);">PDF, DOC, DOCX, XLS, XLSX, JPG, PNG (Max 10MB)</p>
                                    <input type="file" id="fileInput" multiple style="display: none;" onchange="showSelectedFiles(this)">
                                </div>
                                <div id="selectedFiles" style="margin-top: 1rem;"></div>
                            </div>
                            
                            <div class="form-group">
                                <label>Document Category</label>
                                <select class="form-select" required>
                                    <option value="">Select category...</option>
                                    <option>Contract</option>
                                    <option>Invoice</option>
                                    <option>Work Order</option>
                                    <option>Insurance</option>
                                    <option>Compliance</option>
                                    <option>Report</option>
                                    <option>Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Related Location</label>
                                <select class="form-select">
                                    <option>All Locations</option>
                                    <option>McDonald's - Sunset</option>
                                    <option>Burger King - Melrose</option>
                                    <option>Delilah LA</option>
                                    <option>The Nice Guy</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Description (Optional)</label>
                                <textarea class="form-input" rows="3" placeholder="Add a description..."></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label>Tags (Optional)</label>
                                <input type="text" class="form-input" placeholder="Enter tags separated by commas">
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox">
                                    Notify relevant team members
                                </label>
                            </div>
                            
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                                <button type="submit" class="btn btn-primary">Upload</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function showDocumentCategories() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-overlay" onclick="this.parentElement.remove()"></div>
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header">
                        <h2>Document Categories</h2>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div style="margin-bottom: 1rem;">
                            <button class="btn btn-primary btn-sm" onclick="addDocumentCategory()">+ Add Category</button>
                        </div>
                        <div style="max-height: 400px; overflow-y: auto;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border-bottom: 1px solid var(--gray-200);">
                                <span>Contracts</span>
                                <span style="color: var(--gray-600);">24 documents</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border-bottom: 1px solid var(--gray-200);">
                                <span>Invoices</span>
                                <span style="color: var(--gray-600);">156 documents</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border-bottom: 1px solid var(--gray-200);">
                                <span>Work Orders</span>
                                <span style="color: var(--gray-600);">89 documents</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border-bottom: 1px solid var(--gray-200);">
                                <span>Insurance</span>
                                <span style="color: var(--gray-600);">12 documents</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; border-bottom: 1px solid var(--gray-200);">
                                <span>Compliance</span>
                                <span style="color: var(--gray-600);">35 documents</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem;">
                                <span>Reports</span>
                                <span style="color: var(--gray-600);">42 documents</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function showSelectedFiles(input) {
            const filesDiv = document.getElementById('selectedFiles');
            filesDiv.innerHTML = '';
            if (input.files.length > 0) {
                filesDiv.innerHTML = '<strong>Selected files:</strong><ul style="margin: 0.5rem 0;">';
                for (let file of input.files) {
                    filesDiv.innerHTML += `<li>${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)</li>`;
                }
                filesDiv.innerHTML += '</ul>';
            }
        }
        
        function uploadDocument() {
            alert('Document uploaded successfully!');
            document.querySelector('.modal').remove();
        }
        
        function viewDocument(id) {
            alert('Opening document viewer...');
        }
        
        function downloadDocument(id) {
            alert('Downloading document...');
        }
        
        function shareDocument(id) {
            alert('Opening share dialog...');
        }
        
        function selectAllDocuments(checkbox) {
            const checkboxes = document.querySelectorAll('.doc-select');
            checkboxes.forEach(cb => cb.checked = checkbox.checked);
            updateBulkActionsBar();
        }
        
        function updateBulkActionsBar() {
            const selected = document.querySelectorAll('.doc-select:checked').length;
            const bar = document.getElementById('bulkActionsBar');
            const count = document.getElementById('selectedCount');
            
            if (selected > 0) {
                bar.style.display = 'block';
                count.textContent = `${selected} documents selected`;
            } else {
                bar.style.display = 'none';
            }
        }
        
        function filterDocumentCategory(category) {
            alert(`Filtering by ${category}...`);
        }
        
        function showMobileAppSetup() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-overlay" onclick="this.parentElement.remove()"></div>
                <div class="modal-content" style="max-width: 700px;">
                    <div class="modal-header">
                        <h2>Mobile App Setup & Management</h2>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <!-- App Download Section -->
                        <div style="background: var(--gray-50); padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem;">
                            <h3 style="margin-top: 0;">Download Hey Spruce Mobile App</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                                <div style="text-align: center;">
                                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='150' height='150' viewBox='0 0 150 150'%3E%3Crect width='150' height='150' fill='%23f0f0f0'/%3E%3Ctext x='75' y='75' text-anchor='middle' dy='.3em' font-family='Arial' font-size='14' fill='%23666'%3EQR Code iOS%3C/text%3E%3C/svg%3E" alt="iOS QR Code" style="border: 1px solid var(--gray-300); border-radius: 8px;">
                                    <div style="margin-top: 0.5rem;">
                                        <button class="btn btn-primary btn-sm" onclick="sendAppLink('ios')">üìß Email iOS Link</button>
                                    </div>
                                </div>
                                <div style="text-align: center;">
                                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='150' height='150' viewBox='0 0 150 150'%3E%3Crect width='150' height='150' fill='%23f0f0f0'/%3E%3Ctext x='75' y='75' text-anchor='middle' dy='.3em' font-family='Arial' font-size='14' fill='%23666'%3EQR Code Android%3C/text%3E%3C/svg%3E" alt="Android QR Code" style="border: 1px solid var(--gray-300); border-radius: 8px;">
                                    <div style="margin-top: 0.5rem;">
                                        <button class="btn btn-primary btn-sm" onclick="sendAppLink('android')">üìß Email Android Link</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Connected Devices -->
                        <h3>Connected Devices</h3>
                        <div style="margin-bottom: 2rem;">
                            <table style="width: 100%;">
                                <thead>
                                    <tr style="border-bottom: 1px solid var(--gray-200);">
                                        <th style="padding: 0.75rem; text-align: left;">Device</th>
                                        <th style="padding: 0.75rem; text-align: left;">User</th>
                                        <th style="padding: 0.75rem; text-align: left;">Last Active</th>
                                        <th style="padding: 0.75rem; text-align: left;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="border-bottom: 1px solid var(--gray-100);">
                                        <td style="padding: 0.75rem;">
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <span>üì±</span>
                                                <div>
                                                    <div>iPhone 14 Pro</div>
                                                    <div style="font-size: 0.75rem; color: var(--gray-600);">iOS 17.1</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td style="padding: 0.75rem;">John Smith</td>
                                        <td style="padding: 0.75rem;">
                                            <span style="display: flex; align-items: center; gap: 0.25rem;">
                                                <span style="width: 6px; height: 6px; background: #4ade80; border-radius: 50%;"></span>
                                                Active now
                                            </span>
                                        </td>
                                        <td style="padding: 0.75rem;">
                                            <button class="btn btn-sm" onclick="revokeDevice(1)">Revoke</button>
                                        </td>
                                    </tr>
                                    <tr style="border-bottom: 1px solid var(--gray-100);">
                                        <td style="padding: 0.75rem;">
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <span>üì±</span>
                                                <div>
                                                    <div>Samsung Galaxy S23</div>
                                                    <div style="font-size: 0.75rem; color: var(--gray-600);">Android 14</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td style="padding: 0.75rem;">Sarah Johnson</td>
                                        <td style="padding: 0.75rem;">2 hours ago</td>
                                        <td style="padding: 0.75rem;">
                                            <button class="btn btn-sm" onclick="revokeDevice(2)">Revoke</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 0.75rem;">
                                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                <span>üíª</span>
                                                <div>
                                                    <div>iPad Pro</div>
                                                    <div style="font-size: 0.75rem; color: var(--gray-600);">iPadOS 17.1</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td style="padding: 0.75rem;">Mike Wilson</td>
                                        <td style="padding: 0.75rem;">Yesterday</td>
                                        <td style="padding: 0.75rem;">
                                            <button class="btn btn-sm" onclick="revokeDevice(3)">Revoke</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- App Features -->
                        <h3>Mobile App Features</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; border: 1px solid var(--gray-200); border-radius: 6px;">
                                <input type="checkbox" checked>
                                <div>
                                    <div style="font-weight: 500;">Push Notifications</div>
                                    <div style="font-size: 0.75rem; color: var(--gray-600);">Receive real-time updates</div>
                                </div>
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; border: 1px solid var(--gray-200); border-radius: 6px;">
                                <input type="checkbox" checked>
                                <div>
                                    <div style="font-weight: 500;">Offline Mode</div>
                                    <div style="font-size: 0.75rem; color: var(--gray-600);">Access data without internet</div>
                                </div>
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; border: 1px solid var(--gray-200); border-radius: 6px;">
                                <input type="checkbox" checked>
                                <div>
                                    <div style="font-weight: 500;">Photo Uploads</div>
                                    <div style="font-size: 0.75rem; color: var(--gray-600);">Attach photos to work orders</div>
                                </div>
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; border: 1px solid var(--gray-200); border-radius: 6px;">
                                <input type="checkbox" checked>
                                <div>
                                    <div style="font-weight: 500;">Quick Actions</div>
                                    <div style="font-size: 0.75rem; color: var(--gray-600);">Create requests with one tap</div>
                                </div>
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; border: 1px solid var(--gray-200); border-radius: 6px;">
                                <input type="checkbox">
                                <div>
                                    <div style="font-weight: 500;">Biometric Login</div>
                                    <div style="font-size: 0.75rem; color: var(--gray-600);">Use Face ID or fingerprint</div>
                                </div>
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; border: 1px solid var(--gray-200); border-radius: 6px;">
                                <input type="checkbox" checked>
                                <div>
                                    <div style="font-weight: 500;">Location Services</div>
                                    <div style="font-size: 0.75rem; color: var(--gray-600);">Auto-detect facility location</div>
                                </div>
                            </label>
                        </div>
                        
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">Close</button>
                            <button class="btn btn-primary" onclick="saveMobileSettings()">Save Settings</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function sendAppLink(platform) {
            const email = prompt(`Enter email address to send ${platform} app link:`);
            if (email) {
                alert(`App download link sent to ${email}`);
            }
        }
        
        function revokeDevice(deviceId) {
            if (confirm('Are you sure you want to revoke access for this device?')) {
                alert('Device access revoked successfully.');
            }
        }
        
        function saveMobileSettings() {
            alert('Mobile app settings saved successfully!');
            document.querySelector('.modal').remove();
        }
        
        function downloadApp(platform) {
            alert(`Opening ${platform} app store...`);
        }
        
        function getMessagesContent() {
            return `
                <div class="header-bar">
                    <h1 class="header-title">Messages & Communications</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="showCommunicationSettings()">
                            <span>‚öôÔ∏è</span> Settings
                        </button>
                        <button class="btn btn-primary" onclick="showNewMessageModal()">
                            <span>‚úâÔ∏è</span> New Message
                        </button>
                    </div>
                </div>
                
                <div class="card" style="padding: 0;">
                    <div style="display: flex; height: 600px;">
                        <!-- Conversations List -->
                        <div style="width: 350px; border-right: 1px solid var(--gray-200); overflow-y: auto;">
                            <div style="padding: 0.75rem; border-bottom: 1px solid var(--gray-200);">
                                <input type="text" placeholder="Search conversations..." 
                                    style="width: 100%; padding: 0.5rem; border: 1px solid var(--gray-300); border-radius: 6px;">
                            </div>
                            
                            <!-- Conversation Items -->
                            <div id="conversationsList">
                                <div class="conversation-item active" onclick="selectConversation('1')" 
                                    style="padding: 0.75rem; border-bottom: 1px solid var(--gray-100); cursor: pointer; background: var(--primary-light);">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div style="font-weight: 600; color: var(--gray-900);">Hey Spruce Support</div>
                                            <div style="font-size: 0.75rem; color: var(--gray-600); margin-top: 0.25rem;">Admin Team</div>
                                            <div style="font-size: 0.75rem; color: var(--gray-600); margin-top: 0.25rem;">Regarding maintenance schedule...</div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="font-size: 0.6rem; color: var(--gray-500);">10:30 AM</div>
                                            <div style="background: var(--danger); color: white; border-radius: 10px; padding: 2px 6px; font-size: 0.6rem; margin-top: 0.25rem;">3</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="conversation-item" onclick="selectConversation('2')" 
                                    style="padding: 0.75rem; border-bottom: 1px solid var(--gray-100); cursor: pointer;">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div style="font-weight: 600; color: var(--gray-900);">Johnson Electric</div>
                                            <div style="font-size: 0.75rem; color: var(--gray-600); margin-top: 0.25rem;">Contractor</div>
                                            <div style="font-size: 0.75rem; color: var(--gray-600); margin-top: 0.25rem;">Work order WO-2024-001 completed</div>
                                        </div>
                                        <div style="font-size: 0.6rem; color: var(--gray-500);">Yesterday</div>
                                    </div>
                                </div>
                                
                                <div class="conversation-item" onclick="selectConversation('3')" 
                                    style="padding: 0.75rem; border-bottom: 1px solid var(--gray-100); cursor: pointer;">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div style="font-weight: 600; color: var(--gray-900);">Property Manager</div>
                                            <div style="font-size: 0.75rem; color: var(--gray-600); margin-top: 0.25rem;">Internal Team</div>
                                            <div style="font-size: 0.75rem; color: var(--gray-600); margin-top: 0.25rem;">Budget approval received</div>
                                        </div>
                                        <div style="font-size: 0.6rem; color: var(--gray-500);">2 days ago</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Message Thread -->
                        <div style="flex: 1; display: flex; flex-direction: column;">
                            <!-- Message Header -->
                            <div style="padding: 0.75rem; border-bottom: 1px solid var(--gray-200); background: white;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="font-weight: 600;">Hey Spruce Support</div>
                                        <div style="font-size: 0.75rem; color: var(--gray-600);">Admin Team ‚Ä¢ Online</div>
                                    </div>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button style="padding: 0.5rem; background: none; border: 1px solid var(--gray-300); border-radius: 6px; cursor: pointer;">üìû</button>
                                        <button style="padding: 0.5rem; background: none; border: 1px solid var(--gray-300); border-radius: 6px; cursor: pointer;">üìπ</button>
                                        <button style="padding: 0.5rem; background: none; border: 1px solid var(--gray-300); border-radius: 6px; cursor: pointer;">üìé</button>
                                        <button style="padding: 0.5rem; background: none; border: 1px solid var(--gray-300); border-radius: 6px; cursor: pointer;">‚ÑπÔ∏è</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Messages Container -->
                            <div id="messagesContainer" style="flex: 1; overflow-y: auto; padding: 1rem; background: var(--gray-50);">
                                <!-- Received Message -->
                                <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                                    <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; flex-shrink: 0;">
                                        HS
                                    </div>
                                    <div style="max-width: 70%;">
                                        <div style="background: white; padding: 0.75rem; border-radius: 8px; box-shadow: var(--shadow-sm);">
                                            <div style="font-size: 0.875rem;">Hi! I wanted to follow up on the maintenance schedule for next week. Are all the contractors confirmed?</div>
                                        </div>
                                        <div style="font-size: 0.6rem; color: var(--gray-500); margin-top: 0.25rem;">10:15 AM</div>
                                    </div>
                                </div>
                                
                                <!-- Sent Message -->
                                <div style="display: flex; justify-content: flex-end; margin-bottom: 1rem;">
                                    <div style="max-width: 70%;">
                                        <div style="background: var(--primary); color: white; padding: 0.75rem; border-radius: 8px;">
                                            <div style="font-size: 0.875rem;">Yes, all contractors have been confirmed. Here's the schedule:</div>
                                        </div>
                                        <div style="font-size: 0.6rem; color: var(--gray-500); margin-top: 0.25rem; text-align: right;">10:20 AM ‚Ä¢ Read</div>
                                    </div>
                                </div>
                                
                                <!-- Typing Indicator -->
                                <div style="display: flex; gap: 0.5rem;">
                                    <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; flex-shrink: 0;">
                                        HS
                                    </div>
                                    <div style="background: white; padding: 0.75rem; border-radius: 8px; box-shadow: var(--shadow-sm);">
                                        <div style="display: flex; gap: 0.25rem;">
                                            <div style="width: 8px; height: 8px; background: var(--gray-400); border-radius: 50%; animation: pulse 1.4s infinite;"></div>
                                            <div style="width: 8px; height: 8px; background: var(--gray-400); border-radius: 50%; animation: pulse 1.4s infinite 0.2s;"></div>
                                            <div style="width: 8px; height: 8px; background: var(--gray-400); border-radius: 50%; animation: pulse 1.4s infinite 0.4s;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Message Input -->
                            <div style="padding: 0.75rem; border-top: 1px solid var(--gray-200); background: white;">
                                <div style="display: flex; gap: 0.5rem;">
                                    <button style="padding: 0.5rem; background: none; border: none; cursor: pointer; color: var(--gray-600);">üìé</button>
                                    <input type="text" id="messageInput" placeholder="Type a message..." 
                                        style="flex: 1; padding: 0.5rem; border: 1px solid var(--gray-300); border-radius: 6px;"
                                        onkeypress="if(event.key === 'Enter') sendMessage()">
                                    <button style="padding: 0.5rem; background: none; border: none; cursor: pointer; color: var(--gray-600);">üòä</button>
                                    <button onclick="sendMessage()" style="padding: 0.5rem 1rem; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer;">Send</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <style>
                    @keyframes pulse {
                        0%, 60%, 100% {
                            opacity: 0.3;
                        }
                        30% {
                            opacity: 1;
                        }
                    }
                    
                    .conversation-item:hover {
                        background: var(--gray-50) !important;
                    }
                    
                    .conversation-item.active {
                        background: var(--primary-light) !important;
                    }
                </style>
            `;
        }
        
        // Client Portal View Switching Functions
        function switchToClientListView() {
            document.getElementById('clientListViewContainer').style.display = 'block';
            document.getElementById('clientCalendarViewContainer').style.display = 'none';
            document.getElementById('clientListViewBtn').classList.remove('btn-secondary');
            document.getElementById('clientListViewBtn').classList.add('btn-primary');
            document.getElementById('clientCalendarViewBtn').classList.remove('btn-primary');
            document.getElementById('clientCalendarViewBtn').classList.add('btn-secondary');
        }
        
        function switchToClientCalendarView() {
            document.getElementById('clientListViewContainer').style.display = 'none';
            document.getElementById('clientCalendarViewContainer').style.display = 'block';
            document.getElementById('clientCalendarViewBtn').classList.remove('btn-secondary');
            document.getElementById('clientCalendarViewBtn').classList.add('btn-primary');
            document.getElementById('clientListViewBtn').classList.remove('btn-primary');
            document.getElementById('clientListViewBtn').classList.add('btn-secondary');
            
            // Initialize calendar
            renderClientCalendar();
        }
        
        function renderClientCalendar() {
            const calendarGrid = document.getElementById('clientCalendarGrid');
            if (!calendarGrid) return;
            
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Sample work orders for calendar
            const workOrders = {
                8: [{ title: 'HVAC Maintenance', time: '9:00 AM', status: 'scheduled' }],
                12: [{ title: 'Plumbing Inspection', time: '2:00 PM', status: 'scheduled' }],
                15: [{ title: 'Electrical Repair', time: '10:00 AM', status: 'urgent' }],
                20: [{ title: 'Equipment Service', time: '1:00 PM', status: 'scheduled' }],
                25: [{ title: 'Monthly Review', time: '3:00 PM', status: 'scheduled' }]
            };
            
            let html = '<div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: var(--gray-200);">';
            
            // Day headers
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(day => {
                html += `<div style="background: var(--gray-50); padding: 0.5rem; text-align: center; font-weight: 600; font-size: 0.875rem;">${day}</div>`;
            });
            
            // Empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                html += '<div style="background: white; min-height: 80px; padding: 0.5rem;"></div>';
            }
            
            // Days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const hasWorkOrders = workOrders[day];
                const isToday = day === now.getDate();
                
                html += `<div style="background: ${isToday ? 'var(--primary-light)' : 'white'}; min-height: 80px; padding: 0.5rem; position: relative;">
                    <div style="font-weight: ${isToday ? 'bold' : 'normal'}; margin-bottom: 0.25rem;">${day}</div>`;
                
                if (hasWorkOrders) {
                    hasWorkOrders.forEach(wo => {
                        const color = wo.status === 'urgent' ? 'var(--danger)' : 'var(--primary)';
                        html += `<div style="font-size: 0.625rem; background: ${color}; color: white; padding: 0.125rem 0.25rem; border-radius: 2px; margin-bottom: 0.125rem; cursor: pointer;" onclick="viewWorkOrder('WO-${day}')">${wo.time} - ${wo.title}</div>`;
                    });
                }
                
                html += '</div>';
            }
            
            html += '</div>';
            calendarGrid.innerHTML = html;
        }
        
        function previousClientPeriod() {
            // Navigate to previous month
            showToast('Previous month', 'info');
        }
        
        function nextClientPeriod() {
            // Navigate to next month
            showToast('Next month', 'info');
        }
        
        function goToClientToday() {
            // Navigate to current month
            renderClientCalendar();
            showToast('Today', 'info');
        }
        
        function changeClientCalendarView() {
            const view = document.getElementById('clientCalendarView').value;
            showToast(`Switched to ${view} view`, 'info');
        }
        
        function showCreateWorkOrderModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>New Service Request</h3>
                        <button class="close-btn" onclick="closeModal(this)">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="form-group">
                                <label class="form-label">Location *</label>
                                <select class="form-select" required>
                                    <option value="">Select location...</option>
                                    <option>McDonald's - Sunset</option>
                                    <option>Burger King - Melrose</option>
                                    <option>Delilah LA</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Asset (Optional)</label>
                                <select class="form-select" id="asset-select">
                                    <option value="">Select asset...</option>
                                    <option value="asset-1">HVAC Unit - Rooftop #1</option>
                                    <option value="asset-2">Walk-in Freezer #1</option>
                                    <option value="asset-3">Fryer Station #2</option>
                                    <option value="asset-4">Ice Machine - Front</option>
                                    <option value="asset-5">Dishwasher - Main</option>
                                    <option value="asset-6">Refrigerator - Prep Area</option>
                                    <option value="asset-7">Grease Trap #1</option>
                                    <option value="asset-8">Hot Water Heater</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Category *</label>
                                <select class="form-select" required>
                                    <option value="">Select category...</option>
                                    <option>HVAC</option>
                                    <option>Plumbing</option>
                                    <option>Electrical</option>
                                    <option>General Maintenance</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Priority *</label>
                                <select class="form-select" required>
                                    <option value="">Select priority...</option>
                                    <option>Emergency (2-4 hours)</option>
                                    <option>Urgent (24 hours)</option>
                                    <option>Standard (3-5 days)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Description *</label>
                                <textarea class="form-textarea" required placeholder="Describe the issue in detail..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Attachments</label>
                                <input type="file" class="form-input" multiple accept="image/*">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal(this)">Cancel</button>
                        <button class="btn btn-primary" onclick="submitWorkOrder()">Submit Work Order</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function closeModal(element) {
            const modal = element.closest('.modal');
            if (modal) {
                modal.remove();
            }
        }
        
        function showPreventativeMaintenanceModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <div class="modal-header">
                        <h3>Add Preventative Maintenance</h3>
                        <button class="close-btn" onclick="closeModal(this)">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="pm-form">
                            <!-- Basic Information -->
                            <div class="form-group">
                                <label class="form-label">Title/PM *</label>
                                <input type="text" class="form-input" placeholder="e.g., HVAC Filter Replacement" required>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group" style="flex: 1;">
                                    <label class="form-label">Asset Group *</label>
                                    <select class="form-select" required>
                                        <option value="">Select asset group...</option>
                                        <option>HVAC Systems</option>
                                        <option>Kitchen Equipment</option>
                                        <option>Refrigeration</option>
                                        <option>Plumbing</option>
                                        <option>Electrical</option>
                                        <option>Fire Safety</option>
                                    </select>
                                </div>
                                <div class="form-group" style="flex: 1;">
                                    <label class="form-label">Trade *</label>
                                    <select class="form-select" required>
                                        <option value="">Select trade...</option>
                                        <option>HVAC</option>
                                        <option>Plumbing</option>
                                        <option>Electrical</option>
                                        <option>General Maintenance</option>
                                        <option>Appliance Repair</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group" style="flex: 1;">
                                    <label class="form-label">Category</label>
                                    <select class="form-select">
                                        <option>Maintenance</option>
                                        <option>Inspection</option>
                                        <option>Cleaning</option>
                                        <option>Calibration</option>
                                        <option>Testing</option>
                                    </select>
                                </div>
                                <div class="form-group" style="flex: 1;">
                                    <label class="form-label">Priority *</label>
                                    <select class="form-select" required>
                                        <option>Low</option>
                                        <option selected>Medium</option>
                                        <option>High</option>
                                        <option>Critical</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Service Provider</label>
                                <select class="form-select">
                                    <option value="">Auto-assign based on trade</option>
                                    <option>ABC Maintenance Co.</option>
                                    <option>XYZ HVAC Services</option>
                                    <option>Pro Plumbing Inc.</option>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group" style="flex: 1;">
                                    <label class="form-label">Bill *</label>
                                    <input type="number" class="form-input" placeholder="0.00" step="0.01" min="0">
                                </div>
                                <div class="form-group" style="flex: 1;">
                                    <label class="form-label">Locations *</label>
                                    <select class="form-select" required>
                                        <option value="">Select locations...</option>
                                        <option>All Locations</option>
                                        <option>McDonald's - Sunset</option>
                                        <option>Burger King - Melrose</option>
                                        <option>Delilah LA</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Service Frequency Section -->
                            <div style="background: var(--gray-50); padding: 1rem; border-radius: 8px; margin: 1.5rem 0;">
                                <h4 style="margin-bottom: 1rem;">Service Frequency</h4>
                                
                                <div class="form-group">
                                    <label class="form-label">Service by Month</label>
                                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                        <button type="button" class="month-btn" onclick="toggleMonth(this, 'JAN')">JAN</button>
                                        <button type="button" class="month-btn" onclick="toggleMonth(this, 'FEB')">FEB</button>
                                        <button type="button" class="month-btn" onclick="toggleMonth(this, 'MAR')">MAR</button>
                                        <button type="button" class="month-btn" onclick="toggleMonth(this, 'APR')">APR</button>
                                        <button type="button" class="month-btn" onclick="toggleMonth(this, 'MAY')">MAY</button>
                                        <button type="button" class="month-btn" onclick="toggleMonth(this, 'JUN')">JUN</button>
                                        <button type="button" class="month-btn" onclick="toggleMonth(this, 'JUL')">JUL</button>
                                        <button type="button" class="month-btn" onclick="toggleMonth(this, 'AUG')">AUG</button>
                                        <button type="button" class="month-btn" onclick="toggleMonth(this, 'SEP')">SEP</button>
                                        <button type="button" class="month-btn" onclick="toggleMonth(this, 'OCT')">OCT</button>
                                        <button type="button" class="month-btn" onclick="toggleMonth(this, 'NOV')">NOV</button>
                                        <button type="button" class="month-btn" onclick="toggleMonth(this, 'DEC')">DEC</button>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group" style="flex: 1;">
                                        <label class="form-label">Date of Month</label>
                                        <select class="form-select">
                                            <option value="">Select date...</option>
                                            ${Array.from({length: 31}, (_, i) => `<option>${i + 1}</option>`).join('')}
                                        </select>
                                    </div>
                                    <div class="form-group" style="flex: 1;">
                                        <label class="form-label">OR</label>
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <input type="radio" name="service-day" id="service-by-day">
                                            <label for="service-by-day">Service by Day</label>
                                        </div>
                                    </div>
                                    <div class="form-group" style="flex: 1;">
                                        <label class="form-label">Day Frequency</label>
                                        <select class="form-select">
                                            <option>First Monday</option>
                                            <option>Second Monday</option>
                                            <option>Third Monday</option>
                                            <option>Last Monday</option>
                                            <option>Every Monday</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Work Order Generation -->
                            <div class="form-group">
                                <label class="form-label">Generate WO in Advance *</label>
                                <select class="form-select" required>
                                    <option>Same day</option>
                                    <option>1 day before</option>
                                    <option>3 days before</option>
                                    <option selected>7 days before</option>
                                    <option>14 days before</option>
                                    <option>30 days before</option>
                                </select>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group" style="flex: 1;">
                                    <label class="form-label">Service Starts *</label>
                                    <input type="date" class="form-input" required>
                                </div>
                                <div class="form-group" style="flex: 1;">
                                    <label class="form-label">Date of the Next Work Order</label>
                                    <input type="date" class="form-input" readonly style="background: var(--gray-100);">
                                </div>
                            </div>
                            
                            <!-- PM Setup Info -->
                            <div style="background: var(--info-light); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--info);">
                                    <span style="font-size: 1.25rem; font-weight: bold;">i</span>
                                    <div>
                                        <strong>Preventative Maintenance Setup overview</strong><br>
                                        <small>For Service by Month: Service will be created XX days in advance according to your preferred schedule.<br>
                                        For Service by Day: Based on the Service Starts Date and Days Between Service, your first work order will be created XX days in advance.</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea class="form-input" rows="4" placeholder="Enter maintenance description, special instructions, or checklist items..."></textarea>
                            </div>
                            
                            <!-- Attachments -->
                            <div class="form-group">
                                <label class="form-label">Attachments</label>
                                <div style="border: 2px dashed var(--gray-300); border-radius: 8px; padding: 2rem; text-align: center; cursor: pointer;" onclick="document.getElementById('pm-file-upload').click()">
                                    <div style="font-size: 2rem; margin-bottom: 0.5rem; font-weight: bold;">+</div>
                                    <div>Drag and Drop here<br>or<br><span style="color: var(--primary);">BROWSE FILE</span></div>
                                    <input type="file" id="pm-file-upload" style="display: none;" multiple>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal(this)">Cancel</button>
                        <button class="btn btn-primary" onclick="savePreventativeMaintenance()">Create PM Schedule</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Add custom styles for month buttons
            const style = document.createElement('style');
            style.textContent = `
                .month-btn {
                    padding: 0.5rem 1rem;
                    border: 1px solid var(--gray-300);
                    background: white;
                    border-radius: 4px;
                    cursor: pointer;
                    transition: all 0.2s;
                }
                .month-btn:hover {
                    background: var(--gray-50);
                }
                .month-btn.active {
                    background: var(--primary);
                    color: white;
                    border-color: var(--primary);
                }
                .form-row {
                    display: flex;
                    gap: 1rem;
                    margin-bottom: 1rem;
                }
                .info-light {
                    background: #e0f2fe;
                }
            `;
            document.head.appendChild(style);
        }
        
        function toggleMonth(btn, month) {
            btn.classList.toggle('active');
        }
        
        function savePreventativeMaintenance() {
            showToast('Preventative Maintenance schedule created successfully!', 'success');
            closeModal(document.querySelector('.modal.active .close-btn'));
        }
        
        // Action Functions
        function viewWorkOrder(id) {
            showToast(`Opening work order ${id}...`, 'info');
        }
        
        function approveQuote(id) {
            // Get quotes from localStorage
            let quotes = JSON.parse(localStorage.getItem('clientQuotes') || '[]');
            const quoteIndex = quotes.findIndex(q => q.id === id);
            
            if (quoteIndex !== -1) {
                // Update quote status
                quotes[quoteIndex].status = 'approved';
                quotes[quoteIndex].approvedAt = new Date().toISOString();
                
                // Save back to localStorage
                localStorage.setItem('clientQuotes', JSON.stringify(quotes));
                
                showToast(`Quote ${id} approved successfully! Work order has been assigned.`, 'success');
                
                // Refresh the quotes section
                loadSection('quotes');
            }
        }
        
        function rejectQuote(id) {
            // Get quotes from localStorage
            let quotes = JSON.parse(localStorage.getItem('clientQuotes') || '[]');
            const quoteIndex = quotes.findIndex(q => q.id === id);
            
            if (quoteIndex !== -1) {
                // Update quote status
                quotes[quoteIndex].status = 'rejected';
                quotes[quoteIndex].rejectedAt = new Date().toISOString();
                
                // Save back to localStorage
                localStorage.setItem('clientQuotes', JSON.stringify(quotes));
                
                showToast(`Quote ${id} rejected`, 'warning');
                
                // Refresh the quotes section
                loadSection('quotes');
            }
        }
        
        function viewQuoteDetails(id) {
            // Get the specific quote
            const quotes = JSON.parse(localStorage.getItem('clientQuotes') || '[]');
            const quote = quotes.find(q => q.id === id);
            
            if (!quote) {
                showToast('Quote not found', 'error');
                return;
            }
            
            // Create quote details modal
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h3>Quote Details - ${quote.id}</h3>
                        <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div style="background: var(--gray-50); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                            <h4 style="color: var(--primary); margin-bottom: 1rem;">${quote.service}</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div>
                                    <label style="font-size: 0.875rem; color: var(--gray-600);">Client:</label>
                                    <div style="font-weight: 600;">${quote.clientName}</div>
                                </div>
                                <div>
                                    <label style="font-size: 0.875rem; color: var(--gray-600);">Work Order:</label>
                                    <div style="font-weight: 600;">${quote.workOrderId}</div>
                                </div>
                                <div>
                                    <label style="font-size: 0.875rem; color: var(--gray-600);">Created:</label>
                                    <div style="font-weight: 600;">${new Date(quote.createdAt).toLocaleDateString()}</div>
                                </div>
                                <div>
                                    <label style="font-size: 0.875rem; color: var(--gray-600);">Expires:</label>
                                    <div style="font-weight: 600;">${new Date(quote.expiresAt).toLocaleDateString()}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 1.5rem;">
                            <h4 style="margin-bottom: 1rem;">Cost Breakdown</h4>
                            <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid var(--gray-100);">
                                <span>Service Cost:</span>
                                <span style="font-weight: 600;">$${quote.bidAmount.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid var(--gray-100);">
                                <span>Platform Fee:</span>
                                <span style="font-weight: 600;">$${quote.platformFee.toFixed(2)}</span>
                            </div>
                            ${quote.processingFee ? `
                            <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid var(--gray-100);">
                                <span>Processing Fee:</span>
                                <span style="font-weight: 600;">$${quote.processingFee.toFixed(2)}</span>
                            </div>
                            ` : ''}
                            <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; font-size: 1.125rem;">
                                <span style="font-weight: 700;">Total Amount:</span>
                                <span style="font-weight: 700; color: var(--primary);">$${quote.totalAmount.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">Close</button>
                        ${quote.status === 'pending' ? `
                            <button class="btn btn-success" onclick="this.closest('.modal').remove(); approveQuote('${quote.id}')">Approve Quote</button>
                        ` : ''}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function payInvoice(id) {
            showToast(`Processing payment for invoice ${id}...`, 'info');
        }
        
        async function submitWorkOrder() {
            // Get form data
            const modal = document.querySelector('.modal.active');
            const location = modal.querySelector('select:nth-of-type(1)').value;
            const assetSelect = modal.querySelector('#asset-select');
            const asset = assetSelect ? assetSelect.value : '';
            const categorySelect = modal.querySelectorAll('.form-select')[2];
            const prioritySelect = modal.querySelectorAll('.form-select')[3];
            const category = categorySelect.value;
            const priority = prioritySelect.value;
            const description = modal.querySelector('.form-textarea').value;
            
            // Validate required fields
            if (!location || !category || !priority || !description) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // Create work order object
            const workOrder = {
                location,
                asset_id: asset || null,
                asset_name: asset ? assetSelect.options[assetSelect.selectedIndex].text : null,
                category,
                priority,
                description,
                status: 'pending',
                created_at: new Date().toISOString(),
                client_id: 'current-user' // This should come from auth
            };
            
            try {
                // Send to API
                const response = await fetch('/api/work-orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(workOrder)
                });
                
                if (response.ok) {
                    showToast('Service request submitted successfully', 'success');
                    closeModal(document.querySelector('.modal.active .close-btn'));
                    loadSection('work-orders');
                } else {
                    throw new Error('Failed to submit request');
                }
            } catch (error) {
                console.error('Error submitting work order:', error);
                showToast('Failed to submit request. Please try again.', 'error');
            }
        }
        
        // Toast Notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            const container = document.getElementById('toast-container');
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // Additional functions for missing sections and actions
        function generateReport(type) {
            showToast(`Generating ${type} report...`, 'info');
        }
        
        function exportWorkOrders() {
            showToast('Exporting work orders...', 'info');
        }
        
        function exportAssets() {
            showToast('Exporting assets...', 'info');
        }
        
        function showAddLocationModal() {
            showToast('Opening add location modal...', 'info');
        }
        
        function showAddAssetModal() {
            showToast('Opening add asset modal...', 'info');
        }
        
        function viewLocation(name) {
            showToast(`Loading details for ${name}...`, 'info');
        }
        
        function viewAsset(id) {
            showToast(`Loading asset ${id} details...`, 'info');
        }
        
        function viewInvoice(id) {
            // Create modal overlay
            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay';
            modalOverlay.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0, 0, 0, 0.5); z-index: 1000;
                display: flex; align-items: center; justify-content: center;
            `;
            
            // Create modal content
            modalOverlay.innerHTML = `
                <div class="modal-dialog" style="background: white; border-radius: 12px; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; position: relative;">
                    <div class="modal-header" style="padding: 1.5rem; border-bottom: 1px solid var(--gray-200); display: flex; justify-content: between; align-items: center;">
                        <h2 style="margin: 0; color: var(--gray-900);">Invoice ${id}</h2>
                        <button onclick="this.closest('.modal-overlay').remove()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray-500);">&times;</button>
                    </div>
                    <div class="modal-body" style="padding: 1.5rem;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                            <div>
                                <h4 style="color: var(--gray-700); margin-bottom: 1rem;">Invoice Details</h4>
                                <div style="margin-bottom: 0.5rem;"><strong>Invoice ID:</strong> ${id}</div>
                                <div style="margin-bottom: 0.5rem;"><strong>Date:</strong> ${new Date().toLocaleDateString()}</div>
                                <div style="margin-bottom: 0.5rem;"><strong>Due Date:</strong> ${new Date(Date.now() + 30*24*60*60*1000).toLocaleDateString()}</div>
                                <div style="margin-bottom: 0.5rem;"><strong>Status:</strong> <span style="padding: 0.25rem 0.5rem; background: var(--warning-light); color: var(--warning); border-radius: 4px; font-size: 0.75rem;">Pending</span></div>
                            </div>
                            <div>
                                <h4 style="color: var(--gray-700); margin-bottom: 1rem;">Service Provider</h4>
                                <div style="margin-bottom: 0.5rem;"><strong>Company:</strong> CoolAir HVAC Services</div>
                                <div style="margin-bottom: 0.5rem;"><strong>Contact:</strong> Mike Johnson</div>
                                <div style="margin-bottom: 0.5rem;"><strong>Phone:</strong> (555) 123-4567</div>
                                <div style="margin-bottom: 0.5rem;"><strong>Email:</strong> mike@coolairhvac.com</div>
                            </div>
                        </div>
                        
                        <h4 style="color: var(--gray-700); margin-bottom: 1rem;">Service Items</h4>
                        <div class="table-container">
                            <table class="data-table" style="width: 100%;">
                                <thead>
                                    <tr>
                                        <th>Description</th>
                                        <th>Quantity</th>
                                        <th>Rate</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Emergency HVAC System Repair</td>
                                        <td>1</td>
                                        <td>$450.00</td>
                                        <td>$450.00</td>
                                    </tr>
                                    <tr>
                                        <td>Replacement Parts & Labor</td>
                                        <td>1</td>
                                        <td>$125.00</td>
                                        <td>$125.00</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="margin-top: 2rem; padding: 1rem; background: var(--gray-50); border-radius: 8px;">
                            <div style="display: flex; justify-content: between; margin-bottom: 0.5rem;">
                                <span>Subtotal:</span>
                                <span>$575.00</span>
                            </div>
                            <div style="display: flex; justify-content: between; margin-bottom: 0.5rem;">
                                <span>Tax (8.5%):</span>
                                <span>$48.88</span>
                            </div>
                            <div style="display: flex; justify-content: between; font-weight: bold; font-size: 1.1rem; border-top: 1px solid var(--gray-300); padding-top: 0.5rem;">
                                <span>Total:</span>
                                <span>$623.88</span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="padding: 1.5rem; border-top: 1px solid var(--gray-200); display: flex; gap: 1rem; justify-content: flex-end;">
                        <button class="btn btn-secondary" onclick="downloadInvoice('${id}')">üìÑ Download PDF</button>
                        <button class="btn btn-secondary" onclick="this.closest('.modal-overlay').remove()">Close</button>
                        <button class="btn btn-primary" onclick="payInvoice('${id}')">Pay Now</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modalOverlay);
        }
        
        function downloadInvoice(id) {
            // Create a link to download the PDF
            const link = document.createElement('a');
            link.href = `/api/invoices/${id}/pdf`;
            link.download = `invoice-${id}.pdf`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast(`Downloading invoice ${id}...`, 'success');
        }
        
        function payInvoice(id) {
            // Close the modal first
            const modal = document.querySelector('.modal-overlay');
            if (modal) modal.remove();
            
            showToast(`Processing payment for invoice ${id}...`, 'info');
            // Here you could integrate with actual payment processing
        }
        
        function payAllInvoices() {
            showToast('Processing bulk payment...', 'info');
        }
        
        function saveProfile() {
            showToast('Profile saved successfully', 'success');
        }
        
        function saveNotificationSettings() {
            showToast('Notification preferences saved successfully', 'success');
        }
        
        // Team Management Functions
        function openAddTeamMemberModal() {
            const modal = document.getElementById('addTeamMemberModal');
            if (modal) {
                modal.style.display = 'block';
            }
        }
        
        function closeAddTeamMemberModal() {
            const modal = document.getElementById('addTeamMemberModal');
            if (modal) {
                modal.style.display = 'none';
                // Reset form
                document.getElementById('teamFirstName').value = '';
                document.getElementById('teamLastName').value = '';
                document.getElementById('teamEmail').value = '';
                document.getElementById('teamPhone').value = '';
                document.getElementById('teamRole').value = '';
                document.querySelectorAll('#permissionsList input[type="checkbox"]').forEach(cb => cb.checked = false);
            }
        }
        
        // Messaging Functions
        function openConversation(conversationId) {
            // Update the chat interface with the selected conversation
            const conversations = {
                'wo-2024-1523': {
                    name: 'CoolAir HVAC Services',
                    workOrder: 'WO #2024-1523',
                    avatar: 'CS',
                    color: 'var(--primary)',
                    messages: [
                        { sender: 'them', message: 'On my way to your location now. ETA 15 minutes.', time: '2:45 PM' },
                        { sender: 'them', message: 'We\'re running 15 minutes late due to traffic. ETA now 3:15 PM.', time: '3:00 PM' }
                    ]
                },
                'wo-2024-1519': {
                    name: 'Elite Plumbing Solutions',
                    workOrder: 'WO #2024-1519',
                    avatar: 'EP',
                    color: 'var(--warning)',
                    messages: [
                        { sender: 'you', message: 'How is the repair progressing?', time: '1:30 PM' },
                        { sender: 'them', message: 'Job completed. Please review the work and provide feedback when convenient.', time: '2:00 PM' }
                    ]
                },
                'urgent-repair': {
                    name: 'üö® Urgent Repair Team',
                    workOrder: 'Emergency',
                    avatar: 'UR',
                    color: 'var(--danger)',
                    messages: [
                        { sender: 'them', message: 'Emergency electrical issue resolved. Full report attached.', time: '11:00 AM' },
                        { sender: 'you', message: 'Thank you for the quick response!', time: '11:30 AM' }
                    ]
                }
            };
            
            const conversation = conversations[conversationId];
            if (!conversation) return;
            
            // Update chat header
            const chatInterface = document.getElementById('chatInterface');
            const header = chatInterface.querySelector('.table-header');
            header.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <div style="width: 32px; height: 32px; background: ${conversation.color}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.875rem;">${conversation.avatar}</div>
                    <div>
                        <div style="font-weight: 600;">${conversation.name}</div>
                        <div style="font-size: 0.75rem; color: var(--gray-600);">${conversation.workOrder}</div>
                    </div>
                </div>
                <button class="btn btn-sm btn-secondary" onclick="showToast('Call feature coming soon!', 'info')">üìû Call</button>
            `;
            
            // Update chat messages
            let messagesHtml = conversation.messages.map(msg => {
                const isYou = msg.sender === 'you';
                return `
                    <div style="display: flex; gap: 0.75rem; margin-bottom: 1rem; ${isYou ? 'flex-direction: row-reverse;' : ''}">
                        <div style="width: 32px; height: 32px; background: ${isYou ? 'var(--gray-300)' : conversation.color}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: ${isYou ? 'var(--gray-700)' : 'white'}; font-weight: bold; font-size: 0.75rem; flex-shrink: 0;">
                            ${isYou ? 'You' : conversation.avatar}
                        </div>
                        <div style="flex: 1; max-width: 70%;">
                            <div style="background: ${isYou ? 'var(--primary)' : 'var(--gray-100)'}; color: ${isYou ? 'white' : 'var(--gray-900)'}; padding: 0.75rem; border-radius: 12px; ${isYou ? 'border-bottom-right-radius: 4px;' : 'border-bottom-left-radius: 4px;'}">${msg.message}</div>
                            <div style="font-size: 0.75rem; color: var(--gray-500); margin-top: 0.25rem; ${isYou ? 'text-align: right;' : ''}">${msg.time}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Clear existing content and rebuild
            // Remove placeholder content first
            const placeholderContent = chatInterface.querySelector('div[style*="flex: 1; display: flex; align-items: center"]');
            if (placeholderContent) {
                placeholderContent.remove();
            }
            
            // Remove any existing messages or input areas
            const existingMessages = chatInterface.querySelector('.chat-messages');
            const existingInput = chatInterface.querySelector('.message-input-area');
            if (existingMessages) existingMessages.remove();
            if (existingInput) existingInput.remove();
            
            // Create the message area
            const messageArea = document.createElement('div');
            messageArea.className = 'chat-messages';
            messageArea.style.cssText = 'flex: 1; padding: 1rem; overflow-y: auto; background: var(--gray-50);';
            messageArea.innerHTML = messagesHtml;
            chatInterface.appendChild(messageArea);
            
            // Add message input
            const inputArea = document.createElement('div');
            inputArea.className = 'message-input-area';
            inputArea.style.cssText = 'padding: 1rem; border-top: 1px solid var(--gray-200); background: white; flex-shrink: 0;';
            inputArea.innerHTML = `
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" id="messageInput" placeholder="Type your message..." style="flex: 1; padding: 0.75rem; border: 1px solid var(--gray-300); border-radius: 6px;" onkeypress="if(event.key==='Enter') sendMessage('${conversationId}')">
                    <button class="btn btn-primary" onclick="sendMessage('${conversationId}')">Send</button>
                </div>
            `;
            chatInterface.appendChild(inputArea);
            
            // Mark conversation as active
            document.querySelectorAll('.conversation-item').forEach(item => {
                item.style.background = '';
            });
            event.target.closest('.conversation-item').style.background = 'var(--primary-light)';
        }
        
        function sendMessage(conversationId) {
            const input = document.getElementById('messageInput');
            if (!input || !input.value.trim()) return;
            
            const message = input.value.trim();
            const now = new Date();
            const timeStr = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            // Add message to chat
            const messagesContainer = document.querySelector('.chat-messages');
            if (messagesContainer) {
                const messageHtml = `
                    <div style="display: flex; gap: 0.75rem; margin-bottom: 1rem; flex-direction: row-reverse;">
                        <div style="width: 32px; height: 32px; background: var(--gray-300); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--gray-700); font-weight: bold; font-size: 0.75rem; flex-shrink: 0;">You</div>
                        <div style="flex: 1; max-width: 70%;">
                            <div style="background: var(--primary); color: white; padding: 0.75rem; border-radius: 12px; border-bottom-right-radius: 4px;">${message}</div>
                            <div style="font-size: 0.75rem; color: var(--gray-500); margin-top: 0.25rem; text-align: right;">${timeStr}</div>
                        </div>
                    </div>
                `;
                messagesContainer.innerHTML += messageHtml;
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
            
            input.value = '';
            showToast('Message sent!', 'success');
        }
        
        function startNewConversation() {
            showToast('New conversation feature coming soon!', 'info');
        }
        
        function filterConversations(filter) {
            showToast(`Filtering by: ${filter}`, 'info');
        }
        
        function showCommunicationSettings() {
            showToast('Communication settings coming soon!', 'info');
        }
        
        function updatePermissions() {
            const role = document.getElementById('teamRole').value;
            const checkboxes = document.querySelectorAll('#permissionsList input[type="checkbox"]');
            
            // Reset all checkboxes
            checkboxes.forEach(cb => cb.checked = false);
            
            // Set permissions based on role
            switch(role) {
                case 'admin':
                    checkboxes.forEach(cb => cb.checked = true);
                    break;
                case 'manager':
                    document.getElementById('perm1').checked = true;
                    document.getElementById('perm2').checked = true;
                    document.getElementById('perm4').checked = true;
                    break;
                case 'accountant':
                    document.getElementById('perm1').checked = true;
                    document.getElementById('perm3').checked = true;
                    document.getElementById('perm4').checked = true;
                    break;
                case 'viewer':
                    document.getElementById('perm1').checked = true;
                    document.getElementById('perm4').checked = true;
                    break;
            }
        }
        
        function addTeamMember() {
            const firstName = document.getElementById('teamFirstName').value;
            const lastName = document.getElementById('teamLastName').value;
            const email = document.getElementById('teamEmail').value;
            
            if (!firstName || !lastName || !email) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            showToast(`Team member ${firstName} ${lastName} added successfully`, 'success');
            closeAddTeamMemberModal();
        }
        
        function editTeamMember(id) {
            showToast('Opening edit form for team member', 'info');
        }
        
        function removeTeamMember(id) {
            if (confirm('Are you sure you want to remove this team member?')) {
                showToast('Team member removed successfully', 'success');
            }
        }
        
        function resendInvite(id) {
            showToast('Invitation email resent successfully', 'success');
        }
        
        function markAllRead() {
            showToast('All notifications marked as read', 'success');
        }
        
        function addPaymentMethod() {
            showToast('Opening payment method form...', 'info');
        }
        
        // Quality Assurance Functions
        function reviewWorkOrder(workOrderId) {
            document.getElementById('qaWorkOrderTitle').textContent = `Work Order: ${workOrderId}`;
            document.getElementById('qaReviewModal').style.display = 'block';
        }
        
        function closeQAReviewModal() {
            document.getElementById('qaReviewModal').style.display = 'none';
            // Reset form
            document.querySelectorAll('#qaReviewModal input[type="radio"]').forEach(radio => radio.checked = false);
            document.getElementById('qaComments').value = '';
            // Reset star ratings
            document.querySelectorAll('.star-rating').forEach(star => {
                star.style.color = '#ddd';
            });
        }
        
        function setRating(category, rating) {
            const container = document.getElementById(category + 'Rating');
            const stars = container.querySelectorAll('.star-rating');
            
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.style.color = '#ffc107';
                } else {
                    star.style.color = '#ddd';
                }
            });
        }
        
        function submitQAReview() {
            const approval = document.querySelector('input[name="approval"]:checked');
            if (!approval) {
                showToast('Please select an approval decision', 'error');
                return;
            }
            
            const decision = approval.value;
            let message = '';
            
            switch(decision) {
                case 'approve':
                    message = 'Work order approved successfully!';
                    break;
                case 'request-changes':
                    message = 'Change request submitted to vendor';
                    break;
                case 'reject':
                    message = 'Work order rejected. Vendor will be notified.';
                    break;
            }
            
            showToast(message, decision === 'approve' ? 'success' : 'warning');
            closeQAReviewModal();
        }
        
        // Cross-Portal Analytics Functions
        function updateAnalyticsPeriod(period) {
            showToast(`Analytics updated for ${period} period`, 'info');
        }
        
        function exportAnalytics() {
            showToast('Exporting analytics report...', 'info');
        }
        
        function scheduleReport() {
            showToast('Opening report scheduling options...', 'info');
        }
        
        function viewDetailedFlow() {
            showToast('Loading detailed communication flow analysis...', 'info');
        }
        
        function exportVendorReport() {
            showToast('Exporting vendor performance report...', 'info');
        }
        
        // User Administration Functions
        function showAddUserModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 700px;">
                    <div class="modal-header">
                        <h3>Add New User</h3>
                        <button class="close-btn" onclick="closeModal(this)">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="add-user-form">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label class="form-label">First Name *</label>
                                    <input type="text" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Last Name *</label>
                                    <input type="text" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email *</label>
                                    <input type="email" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Role *</label>
                                    <select class="form-select" required onchange="updateLocationOptions(this)">
                                        <option value="">Select role...</option>
                                        <option value="corporate_admin">Corporate Admin</option>
                                        <option value="regional_manager">Regional Manager</option>
                                        <option value="location_manager">Location Manager</option>
                                        <option value="staff">Staff</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Location Access *</label>
                                <div id="location-access-container">
                                    <select class="form-select">
                                        <option value="">Select locations...</option>
                                        <option value="all">All Locations (Corporate)</option>
                                        <option value="mcdonalds-sunset">McDonald's - Sunset</option>
                                        <option value="burger-king-melrose">Burger King - Melrose</option>
                                        <option value="delilah-la">Delilah LA</option>
                                        <option value="craigs">Craig's</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Permissions Template</label>
                                <select class="form-select" onchange="previewPermissions(this)">
                                    <option value="">Choose template...</option>
                                    <option value="full-access">Full Access</option>
                                    <option value="location-manager">Location Manager</option>
                                    <option value="staff-member">Staff Member</option>
                                    <option value="custom">Custom Permissions</option>
                                </select>
                            </div>
                            <div id="permission-preview" style="display: none; padding: 1rem; background: var(--gray-50); border-radius: 6px; margin-top: 1rem;">
                                <div style="font-weight: 600; margin-bottom: 0.5rem;">Permissions Preview:</div>
                                <div id="permission-list"></div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal(this)">Cancel</button>
                        <button class="btn btn-primary" onclick="sendUserInvite()">Send Invitation</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function showBulkInviteModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h3>Bulk User Invitation</h3>
                        <button class="close-btn" onclick="closeModal(this)">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="form-group">
                                <label class="form-label">CSV File Upload</label>
                                <input type="file" class="form-input" accept=".csv">
                                <p style="font-size: 0.875rem; color: var(--gray-600); margin-top: 0.5rem;">
                                    Upload a CSV with columns: Name, Email, Role, Location
                                </p>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Or paste email addresses (one per line)</label>
                                <textarea class="form-textarea" rows="6" placeholder="john.doe@company.com&#10;jane.smith@company.com"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Default Role</label>
                                <select class="form-select">
                                    <option value="staff">Staff</option>
                                    <option value="location_manager">Location Manager</option>
                                    <option value="regional_manager">Regional Manager</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal(this)">Cancel</button>
                        <button class="btn btn-primary" onclick="processBulkInvite()">Send Invitations</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function editUser(userId) {
            showToast(`Opening user editor for ${userId}...`, 'info');
        }
        
        function viewUserPermissions(userId) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h3>User Permissions - ${userId}</h3>
                        <button class="close-btn" onclick="closeModal(this)">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div>
                                <h4 style="margin-bottom: 1rem;">System Permissions</h4>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked> Create Work Orders
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked> Approve Quotes
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked> View Reports
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox"> Admin Panel
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox"> User Management
                                    </label>
                                </div>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 1rem;">Location Access</h4>
                                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked> McDonald's - Sunset
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox"> Burger King - Melrose
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" checked> Delilah LA
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox"> Craig's
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal(this)">Cancel</button>
                        <button class="btn btn-primary" onclick="saveUserPermissions('${userId}')">Save Changes</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function filterUsersByRole() {
            showToast('Filtering users by role...', 'info');
        }
        
        function filterUsersByLocation() {
            showToast('Filtering users by location...', 'info');
        }
        
        function filterUsersByStatus() {
            showToast('Filtering users by status...', 'info');
        }
        
        function searchUsers() {
            showToast('Searching users...', 'info');
        }
        
        function exportUsers() {
            showToast('Exporting user list to CSV...', 'info');
        }
        
        function resendInvite(userId) {
            showToast(`Resending invitation to ${userId}...`, 'success');
        }
        
        function cancelInvite(userId) {
            showToast(`Cancelled invitation for ${userId}`, 'warning');
        }
        
        function sendUserInvite() {
            showToast('User invitation sent successfully', 'success');
            closeModal(document.querySelector('.modal.active .close-btn'));
        }
        
        function processBulkInvite() {
            showToast('Processing bulk invitations...', 'info');
            closeModal(document.querySelector('.modal.active .close-btn'));
        }
        
        function saveUserPermissions(userId) {
            showToast(`Permissions updated for ${userId}`, 'success');
            closeModal(document.querySelector('.modal.active .close-btn'));
        }
        
        function showRoleManagementModal() {
            showToast('Opening role management...', 'info');
        }
        
        function showPermissionTemplatesModal() {
            showToast('Opening permission templates...', 'info');
        }
        
        function showCreateTemplateModal() {
            showToast('Opening template creator...', 'info');
        }
        
        function applyPermissionTemplate(template) {
            showToast(`Applying ${template} template...`, 'info');
        }
        
        function updateLocationOptions(roleSelect) {
            const container = document.getElementById('location-access-container');
            const role = roleSelect.value;
            
            if (role === 'corporate_admin') {
                container.innerHTML = '<div style="padding: 0.5rem; background: var(--success-light); border-radius: 4px; color: var(--success);">Full access to all locations</div>';
            } else {
                container.innerHTML = `
                    <select class="form-select" multiple style="height: 120px;">
                        <option value="mcdonalds-sunset">McDonald's - Sunset</option>
                        <option value="burger-king-melrose">Burger King - Melrose</option>
                        <option value="delilah-la">Delilah LA</option>
                        <option value="craigs">Craig's</option>
                    </select>
                    <p style="font-size: 0.875rem; color: var(--gray-600); margin-top: 0.5rem;">Hold Ctrl/Cmd to select multiple locations</p>
                `;
            }
        }
        
        function previewPermissions(templateSelect) {
            const preview = document.getElementById('permission-preview');
            const permissionList = document.getElementById('permission-list');
            const template = templateSelect.value;
            
            if (!template) {
                preview.style.display = 'none';
                return;
            }
            
            let permissions = [];
            switch(template) {
                case 'full-access':
                    permissions = ['All System Access', 'User Management', 'Reporting', 'Billing', 'Location Management', 'Asset Management', 'Vendor Management', 'Settings'];
                    break;
                case 'location-manager':
                    permissions = ['Work Orders', 'Quotes', 'Assets', 'Basic Reports', 'Location Settings'];
                    break;
                case 'staff-member':
                    permissions = ['View Work Orders', 'Submit Requests'];
                    break;
            }
            
            permissionList.innerHTML = permissions.map(p => `
                <span style="background: var(--primary-light); color: var(--primary); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; margin-right: 0.5rem; margin-bottom: 0.5rem; display: inline-block;">${p}</span>
            `).join('');
            
            preview.style.display = 'block';
        }
        
        // Keyframes are defined in CSS above
        
        // User dropdown functionality
        function toggleUserDropdown(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function closeDropdown(e) {
                if (!dropdown.contains(e.target)) {
                    dropdown.classList.remove('show');
                    document.removeEventListener('click', closeDropdown);
                }
            });
        }
        
        function hideUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.remove('show');
        }
        
        function logout() {
            if (confirm('Are you sure you want to sign out?')) {
                showToast('Signing out...', 'info');
                // In a real app, this would redirect to login page
                setTimeout(() => {
                    window.location.href = '/login';
                }, 1000);
            }
        }
        
        // Service Calendar Functions
        let currentServiceDate = new Date();
        let currentServiceView = 'month';

        const clientServiceOrders = [
            { id: 'SV-001', title: 'HVAC Maintenance', date: new Date(2025, 7, 28), status: 'Scheduled', type: 'Maintenance', time: '09:00 AM', technician: 'John Smith' },
            { id: 'SV-005', title: 'Monthly Deep Cleaning', date: new Date(2025, 8, 15), status: 'Recurring', type: 'Cleaning', time: '11:00 PM', technician: 'Jane Doe' },
            { id: 'SV-007', title: 'Kitchen Equipment Check', date: new Date(2025, 8, 22), status: 'Scheduled', type: 'Maintenance', time: '10:00 AM', technician: 'Mike Johnson' },
            { id: 'SV-002', title: 'Kitchen Deep Clean', date: new Date(2025, 7, 25), status: 'Completed', type: 'Cleaning', time: '02:00 PM', technician: 'Sarah Wilson' }
        ];

        function initializeServiceCalendar() {
            currentServiceDate = new Date();
            currentServiceView = document.getElementById('calendarView').value || 'month';
            renderServiceCalendar();
        }

        function changeServiceCalendarView() {
            currentServiceView = document.getElementById('calendarView').value;
            renderServiceCalendar();
        }

        function previousServicePeriod() {
            switch(currentServiceView) {
                case 'month':
                    currentServiceDate.setMonth(currentServiceDate.getMonth() - 1);
                    break;
                case 'week':
                    currentServiceDate.setDate(currentServiceDate.getDate() - 7);
                    break;
            }
            renderServiceCalendar();
        }

        function nextServicePeriod() {
            switch(currentServiceView) {
                case 'month':
                    currentServiceDate.setMonth(currentServiceDate.getMonth() + 1);
                    break;
                case 'week':
                    currentServiceDate.setDate(currentServiceDate.getDate() + 7);
                    break;
            }
            renderServiceCalendar();
        }

        function goToServiceToday() {
            currentServiceDate = new Date();
            renderServiceCalendar();
        }

        function renderServiceCalendar() {
            const periodElement = document.getElementById('currentServicePeriod');
            const calendarGrid = document.getElementById('serviceCalendarGrid');
            
            if (!periodElement || !calendarGrid) return;

            switch(currentServiceView) {
                case 'month':
                    renderServiceMonthView(periodElement, calendarGrid);
                    break;
                case 'week':
                    renderServiceWeekView(periodElement, calendarGrid);
                    break;
                case 'list':
                    renderServiceListView(periodElement, calendarGrid);
                    break;
            }
        }

        function renderServiceMonthView(periodElement, calendarGrid) {
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            
            periodElement.textContent = `${monthNames[currentServiceDate.getMonth()]} ${currentServiceDate.getFullYear()}`;
            
            const firstDay = new Date(currentServiceDate.getFullYear(), currentServiceDate.getMonth(), 1);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            const workOrders = getServiceOrdersForMonth(currentServiceDate);
            
            let calendarHTML = `
                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: var(--gray-200); border-radius: 8px; overflow: hidden;">
                    ${['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => 
                        `<div style="background: var(--primary); color: white; padding: 1rem; text-align: center; font-weight: 600; font-size: 0.875rem;">${day}</div>`
                    ).join('')}
            `;

            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const isCurrentMonth = date.getMonth() === currentServiceDate.getMonth();
                const isToday = date.toDateString() === new Date().toDateString();
                const dayOrders = workOrders.filter(wo => wo.date.toDateString() === date.toDateString());
                
                calendarHTML += `
                    <div style="background: white; min-height: 120px; padding: 0.75rem; ${!isCurrentMonth ? 'opacity: 0.3;' : ''} ${isToday ? 'border: 2px solid var(--primary);' : ''} cursor: pointer;" onclick="showServiceDayDetails('${date.toISOString()}')">
                        <div style="font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; ${isToday ? 'color: var(--primary);' : ''}">${date.getDate()}</div>
                        ${dayOrders.map(wo => `
                            <div style="background: ${getClientStatusColor(wo.status)}; color: white; padding: 0.25rem 0.5rem; margin-bottom: 0.25rem; border-radius: 4px; font-size: 0.75rem; cursor: pointer;" onclick="event.stopPropagation(); showServiceDetails('${wo.id}')">
                                <div style="font-weight: 600;">${wo.title}</div>
                                <div style="opacity: 0.9;">${wo.time}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            calendarHTML += '</div>';
            calendarGrid.innerHTML = calendarHTML;
        }

        function renderServiceWeekView(periodElement, calendarGrid) {
            const startOfWeek = new Date(currentServiceDate);
            startOfWeek.setDate(currentServiceDate.getDate() - currentServiceDate.getDay());
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            periodElement.textContent = `${startOfWeek.toLocaleDateString()} - ${endOfWeek.toLocaleDateString()}`;
            
            const workOrders = getServiceOrdersForWeek(startOfWeek);
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            
            let calendarHTML = '<div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 1rem;">';
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(startOfWeek);
                date.setDate(startOfWeek.getDate() + i);
                const isToday = date.toDateString() === new Date().toDateString();
                const dayOrders = workOrders.filter(wo => wo.date.toDateString() === date.toDateString());
                
                calendarHTML += `
                    <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 1rem; background: white; ${isToday ? 'border-color: var(--primary); box-shadow: 0 0 10px rgba(99, 102, 241, 0.1);' : ''}">
                        <div style="text-align: center; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 1px solid var(--gray-200);">
                            <div style="font-weight: 600; color: var(--gray-600); font-size: 0.875rem;">${days[i]}</div>
                            <div style="font-size: 1.5rem; font-weight: 700; ${isToday ? 'color: var(--primary);' : ''}">${date.getDate()}</div>
                        </div>
                        <div>
                            ${dayOrders.length === 0 ? 
                                '<p style="text-align: center; color: var(--gray-400); font-size: 0.875rem;">No services</p>' :
                                dayOrders.map(wo => `
                                    <div style="background: ${getClientStatusColor(wo.status)}; color: white; padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 6px; cursor: pointer;" onclick="showServiceDetails('${wo.id}')">
                                        <div style="font-weight: 600; margin-bottom: 0.25rem;">${wo.title}</div>
                                        <div style="opacity: 0.9; font-size: 0.75rem;">${wo.time} ‚Ä¢ ${wo.technician}</div>
                                    </div>
                                `).join('')
                            }
                        </div>
                    </div>
                `;
            }
            
            calendarHTML += '</div>';
            calendarGrid.innerHTML = calendarHTML;
        }

        function renderServiceListView(periodElement, calendarGrid) {
            periodElement.textContent = 'Upcoming Services';
            
            const allOrders = clientServiceOrders.sort((a, b) => a.date - b.date);
            const upcomingOrders = allOrders.filter(wo => wo.date >= new Date() || wo.status === 'Completed');
            
            let listHTML = '<div>';
            
            if (upcomingOrders.length === 0) {
                listHTML += '<p style="text-align: center; color: var(--gray-500); padding: 2rem;">No upcoming services scheduled.</p>';
            } else {
                upcomingOrders.forEach(wo => {
                    listHTML += `
                        <div class="table-container" style="margin-bottom: 1rem; cursor: pointer; transition: all 0.3s ease;" onclick="showServiceDetails('${wo.id}')" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='none'">
                            <div style="padding: 1.5rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem;">
                                    <div>
                                        <h3 style="color: var(--gray-900); margin-bottom: 0.25rem;">${wo.title}</h3>
                                        <p style="color: var(--gray-600); font-size: 0.875rem;">${wo.date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                                    </div>
                                    <span class="status-badge ${wo.status.toLowerCase()}">${wo.status}</span>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; font-size: 0.875rem; color: var(--gray-600);">
                                    <div><strong>Time:</strong> ${wo.time}</div>
                                    <div><strong>Type:</strong> ${wo.type}</div>
                                    <div><strong>Technician:</strong> ${wo.technician}</div>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            listHTML += '</div>';
            calendarGrid.innerHTML = listHTML;
        }

        function getClientStatusColor(status) {
            switch(status.toLowerCase()) {
                case 'completed': return 'var(--success)';
                case 'scheduled': return 'var(--primary)';
                case 'upcoming': return 'var(--warning)';
                case 'recurring': return 'var(--secondary)';
                default: return 'var(--gray-500)';
            }
        }

        function getServiceOrdersForMonth(date) {
            return clientServiceOrders.filter(wo => {
                return wo.date.getMonth() === date.getMonth() && wo.date.getFullYear() === date.getFullYear();
            });
        }

        function getServiceOrdersForWeek(startDate) {
            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + 6);
            
            return clientServiceOrders.filter(wo => wo.date >= startDate && wo.date <= endDate);
        }

        function showServiceDayDetails(dateString) {
            const date = new Date(dateString);
            const dayOrders = clientServiceOrders.filter(wo => wo.date.toDateString() === date.toDateString());
            
            if (dayOrders.length === 0) {
                showToast(`No services scheduled for ${date.toLocaleDateString()}`, 'info');
            } else {
                const serviceList = dayOrders.map(wo => `‚Ä¢ ${wo.title} at ${wo.time}`).join('\\n');
                showToast(`Services for ${date.toLocaleDateString()}:\\n${serviceList}`, 'info');
            }
        }

        function showServiceDetails(serviceId) {
            const service = clientServiceOrders.find(order => order.id === serviceId);
            if (service) {
                showToast(`Service: ${service.title}\\nDate: ${service.date.toLocaleDateString()}\\nTime: ${service.time}\\nTechnician: ${service.technician}`, 'info');
            }
        }

        // Make functions globally accessible
        window.initializeServiceCalendar = initializeServiceCalendar;
        window.changeServiceCalendarView = changeServiceCalendarView;
        window.previousServicePeriod = previousServicePeriod;
        window.nextServicePeriod = nextServicePeriod;
        window.goToServiceToday = goToServiceToday;
        window.showServiceDetails = showServiceDetails;
        window.showServiceDayDetails = showServiceDayDetails;
        
        // Role-based visibility
        const currentUserRole = 'Corporate Admin'; // This would come from auth system
        const hasMultiLocationAccess = true; // This would come from user permissions
        
        function initializeRoleBasedVisibility() {
            const adminOnlyElements = document.querySelectorAll('.admin-only');
            const isAdmin = currentUserRole === 'Corporate Admin' || currentUserRole === 'Administrator';
            
            adminOnlyElements.forEach(element => {
                if (!isAdmin) {
                    element.style.display = 'none';
                }
            });
            
            // Show/hide location selector based on multi-location access
            const multiLocationElements = document.querySelectorAll('.multi-location-only');
            multiLocationElements.forEach(element => {
                if (!hasMultiLocationAccess) {
                    element.style.display = 'none';
                }
            });
        }
        
        // Location dropdown functionality
        function toggleLocationDropdown(event) {
            event.stopPropagation();
            const dropdown = document.getElementById('locationDropdown');
            dropdown.classList.toggle('show');
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function closeDropdown(e) {
                if (!dropdown.contains(e.target)) {
                    dropdown.classList.remove('show');
                    document.removeEventListener('click', closeDropdown);
                }
            });
        }
        
        function selectLocation(locationId, locationName, locationType) {
            event.stopPropagation();
            
            // Update the selector display
            const selector = document.querySelector('.location-selector');
            const nameElement = selector.querySelector('.location-name');
            const typeElement = selector.querySelector('.location-type');
            
            nameElement.textContent = locationName;
            typeElement.textContent = locationType;
            
            // Update selected state in dropdown
            document.querySelectorAll('.location-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Close dropdown
            document.getElementById('locationDropdown').classList.remove('show');
            
            // Filter data based on selected location
            showToast(`Filtering data for: ${locationName}`, 'info');
            
            // In a real app, this would trigger data refresh for the selected location
            refreshDashboardData(locationId);
        }
        
        function refreshDashboardData(locationId) {
            // This would fetch and update data based on selected location
            console.log(`Loading data for location: ${locationId}`);
        }
        
        // Initialize role-based visibility when dashboard loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                initializeRoleBasedVisibility();
                initializeEnhancements();
            }, 100);
        });

        // ENHANCEMENTS: Table Sorting, Form Validation, PWA
        function initializeEnhancements() {
            initializeTableSorting();
            initializeFormValidation();
            initializePWA();
            showToast('‚ú® Enhanced features active', 'success', 4000);
        }

        function initializeTableSorting() {
            document.querySelectorAll('table th').forEach((header, index) => {
                if (header.textContent.trim()) {
                    header.style.cursor = 'pointer';
                    header.style.userSelect = 'none';
                    header.innerHTML += ' <span style="font-size:0.75rem;color:#9ca3af;">‚Üï</span>';
                    
                    header.addEventListener('click', () => {
                        const table = header.closest('table');
                        const tbody = table.querySelector('tbody');
                        const rows = Array.from(tbody.querySelectorAll('tr'));
                        
                        const isAsc = header.dataset.sort !== 'asc';
                        header.dataset.sort = isAsc ? 'asc' : 'desc';
                        
                        // Reset other headers
                        table.querySelectorAll('th').forEach(h => {
                            if (h !== header) h.dataset.sort = '';
                        });
                        
                        rows.sort((a, b) => {
                            const aText = a.cells[index].textContent.trim();
                            const bText = b.cells[index].textContent.trim();
                            
                            if (isAsc) {
                                return aText.localeCompare(bText, undefined, {numeric: true});
                            } else {
                                return bText.localeCompare(aText, undefined, {numeric: true});
                            }
                        });
                        
                        rows.forEach(row => tbody.appendChild(row));
                        showToast('Table sorted', 'info', 2000);
                    });
                }
            });
        }

        function initializeFormValidation() {
            document.querySelectorAll('input, select, textarea').forEach(field => {
                field.addEventListener('blur', () => {
                    if (field.hasAttribute('required') && !field.value.trim()) {
                        field.style.borderColor = '#ef4444';
                        showToast('Required field cannot be empty', 'error', 3000);
                    } else {
                        field.style.borderColor = '';
                    }
                });
            });
        }

        function initializePWA() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js').catch(() => {});
            }
        }

        function showToast(message, type = 'info', duration = 4000) {
            const container = document.getElementById('toast-container') || (() => {
                const cont = document.createElement('div');
                cont.id = 'toast-container';
                cont.style.cssText = 'position:fixed;bottom:1rem;right:1rem;z-index:10000;';
                document.body.appendChild(cont);
                return cont;
            })();
            
            const toast = document.createElement('div');
            toast.style.cssText = `
                background:white;border-radius:8px;padding:1rem 1.5rem;margin-bottom:0.5rem;
                box-shadow:0 4px 6px -1px rgba(0,0,0,0.1);display:flex;align-items:center;gap:0.75rem;
                border-left:4px solid ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                animation:slideIn 0.3s ease;max-width:300px;
            `;
            
            const icons = {success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è'};
            toast.innerHTML = `${icons[type] || icons.info} ${message}`;
            
            container.appendChild(toast);
            setTimeout(() => toast.remove(), duration);
        }
    </script>
</body>
</html>