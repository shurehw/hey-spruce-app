<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subcontractor Portal - Hey Spruce</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            /* Layout Variables */
            --sidebar-width: 260px;
            --header-height: 60px;
            
            /* Portal Theme Colors - Subcontractor (Green) */
            --primary: #10b981;
            --primary-dark: #059669;
            --primary-light: #d1fae5;
            --secondary: #14b8a6;
            --secondary-dark: #0f766e;
            --secondary-light: #ccfbf1;
            
            /* Status Colors */
            --success: #10b981;
            --success-light: #d1fae5;
            --warning: #f59e0b;
            --warning-light: #fed7aa;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --info: #3b82f6;
            --info-light: #dbeafe;
            
            /* Gray Scale */
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            
            /* Typography */
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            
            /* Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            
            /* Border Radius */
            --radius-sm: 4px;
            --radius-md: 6px;
            --radius-lg: 8px;
            --radius-xl: 12px;
            --radius-full: 9999px;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-family);
            background: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.6;
        }
        
        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: white;
            padding: 0 2rem;
            border-bottom: 1px solid var(--gray-200);
            box-shadow: var(--shadow-sm);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--primary);
        }
        
        .portal-badge {
            background: var(--primary);
            color: white;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
            font-weight: 500;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: #10b981;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        /* User Dropdown Styles */
        .user-dropdown {
            position: relative;
        }
        
        .user-dropdown-toggle {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            transition: background 0.2s;
            background: transparent;
            border: none;
        }
        
        .user-dropdown-toggle:hover {
            background: #f3f4f6;
        }
        
        .dropdown-arrow {
            font-size: 0.625rem;
            color: #6b7280;
            transition: transform 0.2s;
        }
        
        .user-dropdown.active .dropdown-arrow {
            transform: rotate(180deg);
        }
        
        .user-dropdown-menu {
            position: absolute;
            top: calc(100% + 0.5rem);
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 220px;
            display: none;
            z-index: 1000;
        }
        
        .user-dropdown.active .user-dropdown-menu {
            display: block;
        }
        
        .dropdown-header {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .dropdown-company {
            font-weight: 600;
            color: #111827;
            margin-bottom: 0.25rem;
        }
        
        .dropdown-email {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: #374151;
            text-decoration: none;
            transition: background 0.2s;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 0.875rem;
        }
        
        .dropdown-item:hover {
            background: #f9fafb;
        }
        
        .dropdown-item-icon {
            width: 1.25rem;
            color: #6b7280;
        }
        
        .dropdown-divider {
            height: 1px;
            background: #e5e7eb;
            margin: 0;
        }
        
        /* Layout */
        .container {
            display: flex;
            min-height: 100vh;
            background: white;
            padding-top: 60px;
        }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            border-right: 1px solid var(--gray-200);
            display: flex;
            flex-direction: column;
            position: fixed;
            left: 0;
            top: var(--header-height);
            height: calc(100vh - var(--header-height));
            z-index: 50;
        }
        
        .sidebar-nav {
            flex: 1;
            padding: 1rem 0;
            overflow-y: auto;
        }
        
        .sidebar-section {
            margin-bottom: 2rem;
        }
        
        .sidebar-title {
            padding: 0 1.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: #6b7280;
            letter-spacing: 0.05em;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.625rem 1.5rem;
            color: #4b5563;
            text-decoration: none;
            transition: all 0.2s;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .nav-item:hover {
            background: #f9fafb;
            color: #10b981;
        }
        
        .nav-item.active {
            background: #d1fae5;
            color: #10b981;
            font-weight: 500;
            position: relative;
        }
        
        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #10b981;
        }
        
        .nav-item .icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            margin-top: 60px;
            padding: 2rem;
            overflow-y: auto;
            min-height: calc(100vh - 60px);
            background: white;
        }
        
        .dashboard-header {
            margin-bottom: 2rem;
        }
        
        .dashboard-title {
            font-size: 2rem;
            font-weight: 700;
            color: #111827;
            margin-bottom: 0.5rem;
        }
        
        .dashboard-subtitle {
            color: #6b7280;
        }
        
        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .metric-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            box-shadow: var(--shadow-sm);
        }
        
        .metric-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #111827;
        }
        
        .metric-change {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.5rem;
        }
        
        .metric-change.positive {
            color: #10b981;
        }
        
        /* Section Cards */
        .section-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid #e5e7eb;
            box-shadow: var(--shadow-sm);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
        }
        
        /* RFP List */
        .rfp-item {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }
        
        .rfp-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .rfp-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .rfp-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #111827;
        }
        
        .rfp-client {
            color: #6b7280;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
        
        .rfp-budget {
            text-align: right;
        }
        
        .budget-amount {
            font-size: 1.25rem;
            font-weight: 600;
            color: #10b981;
        }
        
        .rfp-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            padding: 1rem 0;
            border-top: 1px solid #f3f4f6;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .rfp-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }
        
        /* Work Orders */
        .work-order-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .work-order-card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.25rem;
            background: white;
        }
        
        .wo-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-in-progress {
            background: #fed7aa;
            color: #ea580c;
        }
        
        .status-scheduled {
            background: #dbeafe;
            color: #2563eb;
        }
        
        /* Buttons */
        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 6px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }
        
        .btn-primary {
            background: #10b981;
            color: white;
        }
        
        .btn-primary:hover {
            background: #059669;
        }
        
        .btn-secondary {
            background: white;
            color: #374151;
            border: 1px solid #d1d5db;
        }
        
        .btn-secondary:hover {
            background: #f9fafb;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: none;
            background: #f3f4f6;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .form-input {
            width: 100%;
            padding: 0.625rem 0.875rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        
        .cost-summary {
            background: #f9fafb;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }
        
        .cost-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .cost-row.total {
            font-weight: 600;
            font-size: 1.125rem;
            padding-top: 0.5rem;
            border-top: 1px solid #e5e7eb;
        }
        
        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }
        
        /* Badge Styles */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-high {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .badge-normal {
            background: #e0e7ff;
            color: #4f46e5;
        }
        
        .badge-pending {
            background: #fed7aa;
            color: #ea580c;
        }
        
        .badge-in-progress {
            background: #fef3c7;
            color: #d97706;
        }
        
        .badge-completed {
            background: #d1fae5;
            color: #059669;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo-section">
            <img src="https://cdn.prod.website-files.com/67edc7c78e3151d3b06686b2/681007b1b7f5a5cc527f1b94_Hey_SPRUCE_logo_font.png" alt="Hey Spruce" class="logo" style="height: 32px; width: auto;">
            <span class="portal-badge">Subcontractor Portal</span>
        </div>
        
        <!-- Global Search -->
        <div class="header-search" style="flex: 1; max-width: 400px; margin: 0 2rem;">
            <div style="position: relative;">
                <input type="text" 
                       id="subcontractorGlobalSearch" 
                       placeholder="Search RFPs, work orders, clients..." 
                       style="width: 100%; padding: 0.5rem 0.75rem 0.5rem 2.5rem; border: 1px solid var(--gray-300); border-radius: 6px; font-size: 0.875rem;"
                       onkeyup="handleSubcontractorGlobalSearch(this.value)"
                       onkeydown="handleSubcontractorSearchKeydown(event)">
                <div style="position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: var(--gray-400); pointer-events: none;">
                    üîç
                </div>
                <div id="subcontractorSearchResults" class="search-results" style="position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid var(--gray-200); border-top: none; border-radius: 0 0 6px 6px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); z-index: 1000; display: none; max-height: 300px; overflow-y: auto;">
                    <!-- Search results will be populated here -->
                </div>
                <div style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); font-size: 0.75rem; color: var(--gray-400); pointer-events: none;">
                    Ctrl+K
                </div>
            </div>
        </div>
        
        <div class="user-info">
            <div class="user-dropdown" id="userDropdown">
                <button class="user-dropdown-toggle" onclick="toggleUserDropdown()">
                    <div class="user-avatar">JE</div>
                    <span style="font-weight: 500; color: #111827;">Johnson Electric</span>
                    <span class="dropdown-arrow">‚ñº</span>
                </button>
                <div class="user-dropdown-menu">
                    <div class="dropdown-header">
                        <div class="dropdown-company">Johnson Electric</div>
                        <div class="dropdown-email">mike@johnsonelectric.com</div>
                    </div>
                    <a href="#" class="dropdown-item" onclick="showSection('profile'); closeUserDropdown(); return false;">
                        <span class="dropdown-item-icon">üë§</span>
                        <span>Profile</span>
                    </a>
                    <a href="#" class="dropdown-item" onclick="showSection('settings'); closeUserDropdown(); return false;">
                        <span class="dropdown-item-icon">‚öôÔ∏è</span>
                        <span>Settings</span>
                    </a>
                    <a href="#" class="dropdown-item" onclick="showSection('team'); closeUserDropdown(); return false;">
                        <span class="dropdown-item-icon">üë•</span>
                        <span>Team Management</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item" onclick="alert('Logging out...'); return false;">
                        <span class="dropdown-item-icon">üö™</span>
                        <span>Sign Out</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-nav">
                <div class="sidebar-section">
                    <div class="sidebar-title">Main</div>
                    <a class="nav-item active" onclick="showSection('dashboard')">
                        <span class="icon"></span>
                        Dashboard
                    </a>
                    <a class="nav-item" onclick="showSection('rfps')">
                        <span class="icon"></span>
                        Available RFPs
                    </a>
                    <a class="nav-item" onclick="showSection('work-orders')">
                        <span class="icon"></span>
                        Work Orders
                    </a>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-title">Finance</div>
                    <a class="nav-item" onclick="showSection('payments')">
                        <span class="icon"></span>
                        Payments
                    </a>
                    <a class="nav-item" onclick="showSection('performance')">
                        <span class="icon"></span>
                        Performance
                    </a>
                    <a class="nav-item" onclick="showSection('analytics')">
                        <span class="icon">üìä</span>
                        Analytics
                    </a>
                </div>
                <div class="sidebar-section">
                    <div class="sidebar-title">Communication</div>
                    <a class="nav-item" onclick="showSection('messages')">
                        <span class="icon">üí¨</span>
                        Messages
                        <span class="badge" style="background: var(--danger); color: white; font-size: 0.75rem; padding: 0.125rem 0.375rem; border-radius: 10px; margin-left: auto;">2</span>
                    </a>
                    <a class="nav-item" onclick="showSection('notifications')">
                        <span class="icon">üîî</span>
                        Notifications
                        <span class="badge" style="background: var(--warning); color: white; font-size: 0.75rem; padding: 0.125rem 0.375rem; border-radius: 10px; margin-left: auto;">4</span>
                    </a>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Breadcrumb Navigation -->
            <div id="breadcrumbContainer" style="padding: 0 20px;"></div>
            
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="content-section">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Welcome back, Johnson Electric</h1>
                    <p class="dashboard-subtitle">Here's what's happening with your business today.</p>
                </div>

                <!-- Metrics -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Active Work Orders</div>
                        <div class="metric-value">8</div>
                        <div class="metric-change positive">+2 from last week</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">Pending Bids</div>
                        <div class="metric-value">5</div>
                        <div class="metric-change">Response needed by today</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">Monthly Revenue</div>
                        <div class="metric-value">$24,580</div>
                        <div class="metric-change positive">+15% from last month</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">Avg. Rating</div>
                        <div class="metric-value">4.8 ‚≠ê</div>
                        <div class="metric-change">Based on 47 reviews</div>
                    </div>
                </div>

                <!-- Available RFPs Preview -->
                <div class="section-card">
                    <div class="section-header">
                        <h2 class="section-title">Available RFPs - Respond Today</h2>
                        <button class="btn btn-primary" onclick="showSection('rfps')">View All RFPs</button>
                    </div>
                    
                    <div class="rfp-item">
                        <div class="rfp-header">
                            <div>
                                <div class="rfp-title">Commercial HVAC System Repair</div>
                                <div class="rfp-client">OpenWrench Facilities - Downtown Office</div>
                            </div>
                            <div class="rfp-budget">
                                <div style="font-size: 0.75rem; color: #6b7280;">Budget Range</div>
                                <div class="budget-amount">$5,000 - $8,000</div>
                            </div>
                        </div>
                        <div class="rfp-details">
                            <div>
                                <div style="font-size: 0.75rem; color: #6b7280;">Service Type</div>
                                <div style="font-weight: 500;">HVAC Repair</div>
                            </div>
                            <div>
                                <div style="font-size: 0.75rem; color: #6b7280;">Location</div>
                                <div style="font-weight: 500;">123 Main St</div>
                            </div>
                            <div>
                                <div style="font-size: 0.75rem; color: #6b7280;">Deadline</div>
                                <div style="font-weight: 500; color: #dc2626;">Today, 5:00 PM</div>
                            </div>
                        </div>
                        <div class="rfp-actions">
                            <button class="btn btn-primary" onclick="openBidModal('RFP-2024-001')">Submit Bid</button>
                            <button class="btn btn-secondary" onclick="viewRFPDetails('RFP-2024-001')">View Details</button>
                        </div>
                    </div>
                </div>

                <!-- Active Work Orders Preview -->
                <div class="section-card">
                    <div class="section-header">
                        <h2 class="section-title">Active Work Orders</h2>
                        <button class="btn btn-secondary" onclick="showSection('work-orders')">View All</button>
                    </div>
                    
                    <div class="work-order-grid">
                        <div class="work-order-card">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">WO #1001</div>
                                    <div style="font-weight: 600;">Emergency Plumbing Repair</div>
                                </div>
                                <span class="wo-status status-in-progress">In Progress</span>
                            </div>
                            <div style="color: #6b7280; margin-bottom: 1rem;">456 Oak Street, Building B</div>
                            <div style="display: flex; justify-content: space-between;">
                                <div style="font-size: 0.875rem;">Due: Today, 3:00 PM</div>
                                <div style="font-weight: 600; color: #10b981;">$3,500</div>
                            </div>
                        </div>
                        
                        <div class="work-order-card">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">WO #1002</div>
                                    <div style="font-weight: 600;">HVAC Maintenance</div>
                                </div>
                                <span class="wo-status status-scheduled">Scheduled</span>
                            </div>
                            <div style="color: #6b7280; margin-bottom: 1rem;">123 Main St, Suite 200</div>
                            <div style="display: flex; justify-content: space-between;">
                                <div style="font-size: 0.875rem;">Tomorrow, 9:00 AM</div>
                                <div style="font-weight: 600; color: #10b981;">$1,200</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RFPs Section (hidden by default) -->
            <div id="rfps-section" class="content-section" style="display: none;">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Available RFPs</h1>
                    <p class="dashboard-subtitle">Browse and submit bids for new opportunities</p>
                </div>
                
                <div class="section-card">
                    <div class="rfp-item">
                        <div class="rfp-header">
                            <div>
                                <div class="rfp-title">Commercial HVAC System Repair</div>
                                <div class="rfp-client">OpenWrench Facilities - Downtown Office</div>
                            </div>
                            <div class="rfp-budget">
                                <div style="font-size: 0.75rem; color: #6b7280;">Budget Range</div>
                                <div class="budget-amount">$5,000 - $8,000</div>
                            </div>
                        </div>
                        <div class="rfp-actions">
                            <button class="btn btn-primary" onclick="openBidModal('RFP-2024-001')">Submit Bid</button>
                            <button class="btn btn-secondary" onclick="viewRFPDetails('RFP-2024-001')">View Details</button>
                        </div>
                    </div>
                    
                    <div class="rfp-item">
                        <div class="rfp-header">
                            <div>
                                <div class="rfp-title">Electrical Panel Upgrade</div>
                                <div class="rfp-client">Tech Startup Hub - Building A</div>
                            </div>
                            <div class="rfp-budget">
                                <div style="font-size: 0.75rem; color: #6b7280;">Budget Range</div>
                                <div class="budget-amount">$12,000 - $15,000</div>
                            </div>
                        </div>
                        <div class="rfp-actions">
                            <button class="btn btn-primary" onclick="openBidModal('RFP-2024-002')">Submit Bid</button>
                            <button class="btn btn-secondary" onclick="viewRFPDetails('RFP-2024-002')">View Details</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Work Orders Section (hidden by default) -->
            <div id="work-orders-section" class="content-section" style="display: none;">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Your Work Orders</h1>
                    <p class="dashboard-subtitle">View and manage your assigned work orders</p>
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                        <button id="listViewBtn" class="btn btn-secondary" onclick="switchToListView()" style="padding: 0.5rem 1rem;">
                            üìã List View
                        </button>
                        <button id="calendarViewBtn" class="btn btn-primary" onclick="switchToCalendarView()" style="padding: 0.5rem 1rem;">
                            üìÖ Calendar View
                        </button>
                    </div>
                </div>
                
                <!-- Calendar View -->
                <div id="calendarViewContainer" class="section-card" style="margin-bottom: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <button class="btn btn-secondary" onclick="previousPeriod()" style="padding: 0.5rem;">‚óÄ</button>
                            <button class="btn btn-secondary" onclick="goToToday()">Today</button>
                            <button class="btn btn-secondary" onclick="nextPeriod()" style="padding: 0.5rem;">‚ñ∂</button>
                        </div>
                        <h2 id="currentPeriod" style="font-size: 1.25rem; font-weight: 600;">September 2025</h2>
                        <select id="calendarView" onchange="changeCalendarView()" style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                            <option value="month">Month View</option>
                            <option value="week">Week View</option>
                            <option value="day">Day View</option>
                        </select>
                    </div>
                    
                    <div id="calendarGrid">
                        <!-- Calendar will be rendered here -->
                    </div>
                </div>
                
                <!-- List View -->
                <div id="listViewContainer" class="section-card" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h2 style="font-size: 1.25rem; font-weight: 600;">All Work Orders</h2>
                        <select onchange="filterWorkOrders(this.value)" style="padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;">
                            <option value="all">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="in-progress">In Progress</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    <div id="workOrdersList">
                        <!-- Work orders list will be rendered here -->
                    </div>
                </div>
            </div>

            <!-- Payments Section (hidden by default) -->
            <div id="payments-section" class="content-section" style="display: none;">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Payments</h1>
                    <p class="dashboard-subtitle">Track your invoices and payment history</p>
                </div>
                
                <div class="section-card">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                <th style="text-align: left; padding: 0.75rem;">Invoice #</th>
                                <th style="text-align: left; padding: 0.75rem;">Work Order</th>
                                <th style="text-align: left; padding: 0.75rem;">Amount</th>
                                <th style="text-align: left; padding: 0.75rem;">Status</th>
                                <th style="text-align: left; padding: 0.75rem;">Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid #f3f4f6; cursor: pointer; transition: background 0.2s;" onclick="viewInvoiceDetails('INV-2024-0145')" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background=''">
                                <td style="padding: 0.75rem; color: #3b82f6; text-decoration: underline;">INV-2024-0145</td>
                                <td style="padding: 0.75rem;">WO #998</td>
                                <td style="padding: 0.75rem; font-weight: 600; color: #10b981;">$3,500</td>
                                <td style="padding: 0.75rem;">
                                    <span style="background: #d1fae5; color: #065f46; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem;">Paid</span>
                                </td>
                                <td style="padding: 0.75rem;">Jan 24, 2024</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #f3f4f6; cursor: pointer; transition: background 0.2s;" onclick="viewInvoiceDetails('INV-2024-0144')" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background=''">
                                <td style="padding: 0.75rem; color: #3b82f6; text-decoration: underline;">INV-2024-0144</td>
                                <td style="padding: 0.75rem;">WO #997</td>
                                <td style="padding: 0.75rem; font-weight: 600; color: #10b981;">$5,200</td>
                                <td style="padding: 0.75rem;">
                                    <span style="background: #d1fae5; color: #065f46; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem;">Paid</span>
                                </td>
                                <td style="padding: 0.75rem;">Jan 22, 2024</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #f3f4f6; cursor: pointer; transition: background 0.2s;" onclick="viewInvoiceDetails('INV-2024-0143')" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background=''">
                                <td style="padding: 0.75rem; color: #3b82f6; text-decoration: underline;">INV-2024-0143</td>
                                <td style="padding: 0.75rem;">WO #996</td>
                                <td style="padding: 0.75rem; font-weight: 600; color: #10b981;">$1,800</td>
                                <td style="padding: 0.75rem;">
                                    <span style="background: #fed7aa; color: #7c2d12; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem;">Processing</span>
                                </td>
                                <td style="padding: 0.75rem;">Jan 20, 2024</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Performance Section (hidden by default) -->
            <div id="performance-section" class="content-section" style="display: none;">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Performance Dashboard</h1>
                    <p class="dashboard-subtitle">Monitor your ratings and performance metrics</p>
                </div>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Overall Rating</div>
                        <div class="metric-value">4.8 ‚≠ê</div>
                        <div class="metric-change">Based on 47 reviews</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">On-Time Rate</div>
                        <div class="metric-value">98%</div>
                        <div class="metric-change positive">Above average</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">Jobs Completed</div>
                        <div class="metric-value">24</div>
                        <div class="metric-change">This month</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-label">Bid Win Rate</div>
                        <div class="metric-value">75%</div>
                        <div class="metric-change positive">18 of 24 bids won</div>
                    </div>
                </div>
            </div>
            
            <!-- Analytics Section (hidden by default) -->
            <div id="analytics-section" class="content-section" style="display: none;">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Analytics Dashboard</h1>
                    <p class="dashboard-subtitle">Detailed insights into your business performance</p>
                    <div style="margin-top: 1rem;">
                        <select id="subcontractorAnalyticsPeriod" style="padding: 0.5rem 1rem; border: 1px solid var(--gray-300); border-radius: 6px; margin-right: 1rem;" onchange="updateSubcontractorAnalyticsPeriod(this.value)">
                            <option value="30d" selected>Last 30 Days</option>
                            <option value="90d">Last 90 Days</option>
                            <option value="1y">Last 12 Months</option>
                        </select>
                        <button class="btn btn-secondary" onclick="exportSubcontractorAnalytics()">Export Data</button>
                    </div>
                </div>
                
                <!-- Loading State -->
                <div id="subcontractorAnalyticsLoading" style="display: flex; justify-content: center; align-items: center; height: 200px; color: var(--gray-500);">
                    <div>Loading analytics data...</div>
                </div>
                
                <!-- Analytics Content -->
                <div id="subcontractorAnalyticsContent" style="display: none;">
                    <!-- KPI Cards -->
                    <div id="subcontractorKPICards" class="metrics-grid" style="margin-bottom: 2rem;">
                        <!-- Will be populated by JavaScript -->
                    </div>
                    
                    <!-- Charts Section -->
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                        <div class="section-card">
                            <div class="card-header">
                                <h3 class="card-title">Revenue Trends</h3>
                            </div>
                            <div style="padding: 1rem; height: 350px;">
                                <canvas id="subcontractorRevenueChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="section-card">
                            <div class="card-header">
                                <h3 class="card-title">Job Status Distribution</h3>
                            </div>
                            <div style="padding: 1rem; height: 350px; display: flex; align-items: center; justify-content: center;">
                                <canvas id="subcontractorStatusChart" style="max-height: 300px;"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Performance Metrics -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div class="section-card">
                            <div class="card-header">
                                <h3 class="card-title">Weekly Performance</h3>
                            </div>
                            <div style="padding: 1rem; height: 300px;">
                                <canvas id="subcontractorWeeklyChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="section-card">
                            <div class="card-header">
                                <h3 class="card-title">Performance Metrics</h3>
                            </div>
                            <div id="subcontractorPerformanceMetrics">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Messages Section (hidden by default) -->
            <div id="messages-section" class="content-section" style="display: none;">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Messages</h1>
                    <p class="dashboard-subtitle">Communicate with clients and team members</p>
                </div>
                
                <div class="card" style="padding: 0;">
                    <div style="display: flex; height: 600px;">
                        <!-- Conversations List -->
                        <div style="width: 300px; border-right: 1px solid var(--gray-200); overflow-y: auto;">
                            <div style="padding: 0.75rem; border-bottom: 1px solid var(--gray-200);">
                                <input type="text" placeholder="Search conversations..." 
                                    style="width: 100%; padding: 0.5rem; border: 1px solid var(--gray-300); border-radius: 6px;">
                            </div>
                            
                            <!-- Conversation Items -->
                            <div id="conversationsList">
                                <div class="conversation-item active" onclick="selectConversation('1')" 
                                    style="padding: 0.75rem; border-bottom: 1px solid var(--gray-100); cursor: pointer; background: var(--primary-light);">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div style="font-weight: 600; color: var(--gray-900);">Sarah Johnson</div>
                                            <div style="font-size: 0.75rem; color: var(--gray-600); margin-top: 0.25rem;">Hey Spruce Admin</div>
                                            <div style="font-size: 0.75rem; color: var(--gray-600); margin-top: 0.25rem;">About the HVAC project...</div>
                                        </div>
                                        <div style="text-align: right;">
                                            <div style="font-size: 0.6rem; color: var(--gray-500);">2:30 PM</div>
                                            <div style="background: var(--danger); color: white; border-radius: 10px; padding: 2px 6px; font-size: 0.6rem; margin-top: 0.25rem;">2</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="conversation-item" onclick="selectConversation('2')" 
                                    style="padding: 0.75rem; border-bottom: 1px solid var(--gray-100); cursor: pointer;">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div style="font-weight: 600; color: var(--gray-900);">Mike's Plumbing Co.</div>
                                            <div style="font-size: 0.75rem; color: var(--gray-600); margin-top: 0.25rem;">Team Member</div>
                                            <div style="font-size: 0.75rem; color: var(--gray-600); margin-top: 0.25rem;">Thanks for the update</div>
                                        </div>
                                        <div style="font-size: 0.6rem; color: var(--gray-500);">Yesterday</div>
                                    </div>
                                </div>
                                
                                <div class="conversation-item" onclick="selectConversation('3')" 
                                    style="padding: 0.75rem; border-bottom: 1px solid var(--gray-100); cursor: pointer;">
                                    <div style="display: flex; justify-content: space-between; align-items: start;">
                                        <div>
                                            <div style="font-weight: 600; color: var(--gray-900);">Property Manager</div>
                                            <div style="font-size: 0.75rem; color: var(--gray-600); margin-top: 0.25rem;">Building A Client</div>
                                            <div style="font-size: 0.75rem; color: var(--gray-600); margin-top: 0.25rem;">When can you start?</div>
                                        </div>
                                        <div style="font-size: 0.6rem; color: var(--gray-500);">Mon</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Message Thread -->
                        <div style="flex: 1; display: flex; flex-direction: column;">
                            <!-- Message Header -->
                            <div style="padding: 0.75rem; border-bottom: 1px solid var(--gray-200); background: white;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="font-weight: 600;">Sarah Johnson</div>
                                        <div style="font-size: 0.75rem; color: var(--gray-600);">Hey Spruce Admin ‚Ä¢ Online</div>
                                    </div>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <button style="padding: 0.5rem; background: none; border: 1px solid var(--gray-300); border-radius: 6px; cursor: pointer;">üìû</button>
                                        <button style="padding: 0.5rem; background: none; border: 1px solid var(--gray-300); border-radius: 6px; cursor: pointer;">üìπ</button>
                                        <button style="padding: 0.5rem; background: none; border: 1px solid var(--gray-300); border-radius: 6px; cursor: pointer;">‚ÑπÔ∏è</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Messages Container -->
                            <div id="messagesContainer" style="flex: 1; overflow-y: auto; padding: 1rem; background: var(--gray-50);">
                                <!-- Received Message -->
                                <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                                    <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; flex-shrink: 0;">
                                        SJ
                                    </div>
                                    <div style="max-width: 70%;">
                                        <div style="background: white; padding: 0.75rem; border-radius: 8px; box-shadow: var(--shadow-sm);">
                                            <div style="font-size: 0.875rem;">Hi! I need to discuss the HVAC maintenance schedule for next week. Are you available?</div>
                                        </div>
                                        <div style="font-size: 0.6rem; color: var(--gray-500); margin-top: 0.25rem;">2:15 PM</div>
                                    </div>
                                </div>
                                
                                <!-- Sent Message -->
                                <div style="display: flex; justify-content: flex-end; margin-bottom: 1rem;">
                                    <div style="max-width: 70%;">
                                        <div style="background: var(--primary); color: white; padding: 0.75rem; border-radius: 8px;">
                                            <div style="font-size: 0.875rem;">Yes, I'm available. What specific days work best for your team?</div>
                                        </div>
                                        <div style="font-size: 0.6rem; color: var(--gray-500); margin-top: 0.25rem; text-align: right;">2:20 PM</div>
                                    </div>
                                </div>
                                
                                <!-- Received Message -->
                                <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                                    <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; flex-shrink: 0;">
                                        SJ
                                    </div>
                                    <div style="max-width: 70%;">
                                        <div style="background: white; padding: 0.75rem; border-radius: 8px; box-shadow: var(--shadow-sm);">
                                            <div style="font-size: 0.875rem;">Tuesday or Thursday morning would be ideal. We need to service all units in Building A.</div>
                                        </div>
                                        <div style="font-size: 0.6rem; color: var(--gray-500); margin-top: 0.25rem;">2:25 PM</div>
                                    </div>
                                </div>
                                
                                <!-- Typing Indicator -->
                                <div style="display: flex; gap: 0.5rem;">
                                    <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; flex-shrink: 0;">
                                        SJ
                                    </div>
                                    <div style="background: white; padding: 0.75rem; border-radius: 8px; box-shadow: var(--shadow-sm);">
                                        <div style="display: flex; gap: 0.25rem;">
                                            <div style="width: 8px; height: 8px; background: var(--gray-400); border-radius: 50%; animation: pulse 1.4s infinite;"></div>
                                            <div style="width: 8px; height: 8px; background: var(--gray-400); border-radius: 50%; animation: pulse 1.4s infinite 0.2s;"></div>
                                            <div style="width: 8px; height: 8px; background: var(--gray-400); border-radius: 50%; animation: pulse 1.4s infinite 0.4s;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Message Input -->
                            <div style="padding: 0.75rem; border-top: 1px solid var(--gray-200); background: white;">
                                <div style="display: flex; gap: 0.5rem;">
                                    <button style="padding: 0.5rem; background: none; border: none; cursor: pointer; color: var(--gray-600);">üìé</button>
                                    <input type="text" id="messageInput" placeholder="Type a message..." 
                                        style="flex: 1; padding: 0.5rem; border: 1px solid var(--gray-300); border-radius: 6px;"
                                        onkeypress="if(event.key === 'Enter') sendMessage()">
                                    <button style="padding: 0.5rem; background: none; border: none; cursor: pointer; color: var(--gray-600);">üòä</button>
                                    <button onclick="sendMessage()" style="padding: 0.5rem 1rem; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer;">Send</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <style>
                    @keyframes pulse {
                        0%, 60%, 100% {
                            opacity: 0.3;
                        }
                        30% {
                            opacity: 1;
                        }
                    }
                    
                    .conversation-item:hover {
                        background: var(--gray-50) !important;
                    }
                    
                    .conversation-item.active {
                        background: var(--primary-light) !important;
                    }
                </style>
            </div>
            
            <!-- Team Section (hidden by default) -->
            <div id="team-section" class="content-section" style="display: none;">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Team Management</h1>
                    <p class="dashboard-subtitle">Manage your team members and their access</p>
                </div>
                
                <!-- Add Team Member -->
                <div class="section-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h2 style="font-size: 1.25rem; margin-bottom: 0.5rem;">Grow Your Team</h2>
                            <p style="opacity: 0.9;">Add technicians and staff to handle more work orders</p>
                        </div>
                        <button class="btn" style="background: white; color: #10b981;" onclick="openAddTeamModal()">
                            + Add Team Member
                        </button>
                    </div>
                </div>
                
                <!-- Team Members List -->
                <div class="section-card">
                    <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem;">Current Team Members</h2>
                    
                    <div style="display: grid; gap: 1rem;">
                        <!-- Owner -->
                        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.25rem;">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div style="display: flex; gap: 1rem;">
                                    <div style="width: 48px; height: 48px; background: #10b981; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                                        JD
                                    </div>
                                    <div>
                                        <div style="font-weight: 600; font-size: 1.125rem;">John Doe</div>
                                        <div style="color: #6b7280;">john@johnsonelectric.com</div>
                                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                                            <span style="background: #d1fae5; color: #065f46; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600;">Owner</span>
                                            <span style="background: #dbeafe; color: #1e40af; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600;">Master Electrician</span>
                                        </div>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 0.875rem; color: #6b7280;">Joined Jan 2023</div>
                                    <div style="font-size: 0.875rem; color: #10b981; margin-top: 0.25rem;">Active</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Team Member 1 -->
                        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.25rem;">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div style="display: flex; gap: 1rem;">
                                    <div style="width: 48px; height: 48px; background: #3b82f6; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                                        MS
                                    </div>
                                    <div>
                                        <div style="font-weight: 600; font-size: 1.125rem;">Mike Smith</div>
                                        <div style="color: #6b7280;">mike@johnsonelectric.com</div>
                                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                                            <span style="background: #dbeafe; color: #1e40af; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600;">Technician</span>
                                            <span style="background: #f3f4f6; color: #374151; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem;">Journeyman</span>
                                        </div>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 0.875rem; color: #6b7280;">Joined Mar 2023</div>
                                    <div style="font-size: 0.875rem; color: #10b981; margin-top: 0.25rem;">Active</div>
                                    <button class="btn btn-secondary" style="font-size: 0.75rem; padding: 0.25rem 0.5rem; margin-top: 0.5rem;" onclick="editTeamMember('MS')">Edit</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Team Member 2 -->
                        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.25rem;">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div style="display: flex; gap: 1rem;">
                                    <div style="width: 48px; height: 48px; background: #8b5cf6; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;">
                                        SJ
                                    </div>
                                    <div>
                                        <div style="font-weight: 600; font-size: 1.125rem;">Sarah Johnson</div>
                                        <div style="color: #6b7280;">sarah@johnsonelectric.com</div>
                                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                                            <span style="background: #ede9fe; color: #5b21b6; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600;">Office Manager</span>
                                            <span style="background: #fef3c7; color: #92400e; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem;">Estimator</span>
                                        </div>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 0.875rem; color: #6b7280;">Joined Feb 2023</div>
                                    <div style="font-size: 0.875rem; color: #10b981; margin-top: 0.25rem;">Active</div>
                                    <button class="btn btn-secondary" style="font-size: 0.75rem; padding: 0.25rem 0.5rem; margin-top: 0.5rem;" onclick="editTeamMember('SJ')">Edit</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Permissions Overview -->
                <div class="section-card">
                    <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Role Permissions</h2>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 2px solid #e5e7eb;">
                                <th style="text-align: left; padding: 0.75rem;">Role</th>
                                <th style="text-align: center; padding: 0.75rem;">View RFPs</th>
                                <th style="text-align: center; padding: 0.75rem;">Submit Bids</th>
                                <th style="text-align: center; padding: 0.75rem;">Manage Work Orders</th>
                                <th style="text-align: center; padding: 0.75rem;">View Payments</th>
                                <th style="text-align: center; padding: 0.75rem;">Manage Team</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid #f3f4f6;">
                                <td style="padding: 0.75rem; font-weight: 500;">Owner</td>
                                <td style="text-align: center; padding: 0.75rem;">‚úì</td>
                                <td style="text-align: center; padding: 0.75rem;">‚úì</td>
                                <td style="text-align: center; padding: 0.75rem;">‚úì</td>
                                <td style="text-align: center; padding: 0.75rem;">‚úì</td>
                                <td style="text-align: center; padding: 0.75rem;">‚úì</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #f3f4f6;">
                                <td style="padding: 0.75rem; font-weight: 500;">Office Manager</td>
                                <td style="text-align: center; padding: 0.75rem;">‚úì</td>
                                <td style="text-align: center; padding: 0.75rem;">‚úì</td>
                                <td style="text-align: center; padding: 0.75rem;">‚úì</td>
                                <td style="text-align: center; padding: 0.75rem;">‚úì</td>
                                <td style="text-align: center; padding: 0.75rem;">-</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #f3f4f6;">
                                <td style="padding: 0.75rem; font-weight: 500;">Technician</td>
                                <td style="text-align: center; padding: 0.75rem;">‚úì</td>
                                <td style="text-align: center; padding: 0.75rem;">-</td>
                                <td style="text-align: center; padding: 0.75rem;">‚úì</td>
                                <td style="text-align: center; padding: 0.75rem;">-</td>
                                <td style="text-align: center; padding: 0.75rem;">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Settings Section (hidden by default) -->
            <div id="settings-section" class="content-section" style="display: none;">
                <div class="dashboard-header">
                    <h1 class="dashboard-title">Settings</h1>
                    <p class="dashboard-subtitle">Manage your company profile and payment settings</p>
                </div>
                
                <!-- Company Profile -->
                <div class="section-card">
                    <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem;">Company Profile</h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                        <div>
                            <label class="form-label">Company Name</label>
                            <input type="text" class="form-input" value="Johnson Electric" id="companyName">
                        </div>
                        <div>
                            <label class="form-label">License Number</label>
                            <input type="text" class="form-input" value="EL-2024-789" id="licenseNumber">
                        </div>
                        <div>
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-input" value="(555) 123-4567" id="companyPhone">
                        </div>
                        <div>
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" value="info@johnsonelectric.com" id="companyEmail">
                        </div>
                        <div style="grid-column: span 2;">
                            <label class="form-label">Address</label>
                            <input type="text" class="form-input" value="123 Industrial Blvd, Suite 200, City, ST 12345" id="companyAddress">
                        </div>
                        <div style="grid-column: span 2;">
                            <label class="form-label">Service Areas</label>
                            <input type="text" class="form-input" value="Downtown, Midtown, North County, South County" placeholder="Comma-separated list of service areas">
                        </div>
                        <div style="grid-column: span 2;">
                            <label class="form-label">Specializations</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked> Commercial Electrical
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked> HVAC Systems
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox"> Plumbing
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked> Emergency Services
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox"> Solar Installation
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" style="margin-top: 1.5rem;" onclick="saveCompanyProfile()">Save Company Profile</button>
                </div>
                
                <!-- Stripe Connect Settings -->
                <div class="section-card">
                    <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem;">Payment Settings - Stripe Connect</h2>
                    
                    <div style="background: #f9fafb; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; margin-bottom: 0.5rem;">Stripe Account Status</div>
                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                    <span style="background: #d1fae5; color: #065f46; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.875rem; font-weight: 600;">Connected</span>
                                    <span style="color: #6b7280;">Account ID: acct_1MZh4K2eZvKYlo2C</span>
                                </div>
                            </div>
                            <button class="btn btn-secondary" onclick="openStripeDashboard()">Open Stripe Dashboard</button>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                        <div>
                            <label class="form-label">Bank Account (Last 4)</label>
                            <input type="text" class="form-input" value="****6789" readonly style="background: #f9fafb;">
                        </div>
                        <div>
                            <label class="form-label">Routing Number</label>
                            <input type="text" class="form-input" value="****5678" readonly style="background: #f9fafb;">
                        </div>
                        <div>
                            <label class="form-label">Account Holder Name</label>
                            <input type="text" class="form-input" value="Johnson Electric LLC" id="accountHolder">
                        </div>
                        <div>
                            <label class="form-label">Tax ID (EIN)</label>
                            <input type="text" class="form-input" value="**-***3456" readonly style="background: #f9fafb;">
                        </div>
                    </div>
                    
                    <div style="margin-top: 1.5rem;">
                        <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Payout Schedule</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <label class="form-label">Payout Frequency</label>
                                <select class="form-input" id="payoutFrequency">
                                    <option value="daily">Daily</option>
                                    <option value="weekly" selected>Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Payout Delay</label>
                                <select class="form-input" id="payoutDelay">
                                    <option value="2">2 business days</option>
                                    <option value="7" selected>7 business days</option>
                                    <option value="14">14 business days</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                        <button class="btn btn-primary" onclick="updateStripeSettings()">Update Payment Settings</button>
                        <button class="btn btn-secondary" onclick="updateBankAccount()">Update Bank Account</button>
                        <button class="btn btn-secondary" style="background: #fee2e2; color: #991b1b; border: 1px solid #fecaca;" onclick="disconnectStripe()">Disconnect Stripe</button>
                    </div>
                </div>
                
                <!-- Notifications -->
                <div class="section-card">
                    <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem;">Notification Preferences</h2>
                    
                    <div style="display: grid; gap: 1.5rem;">
                        <!-- New RFP Notifications -->
                        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1rem;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem;">New RFP Notifications</div>
                            <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 1rem;">Get notified when new RFPs match your specializations</div>
                            <div style="display: flex; gap: 1rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked>
                                    <span>Email</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked>
                                    <span>Text</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox">
                                    <span>App</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Bid Status Updates -->
                        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1rem;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem;">Bid Status Updates</div>
                            <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 1rem;">Receive updates when your bids are accepted or rejected</div>
                            <div style="display: flex; gap: 1rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked>
                                    <span>Email</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox">
                                    <span>Text</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked>
                                    <span>App</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Work Order Changes -->
                        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1rem;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem;">Work Order Changes</div>
                            <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 1rem;">Get alerts for schedule changes or updates to work orders</div>
                            <div style="display: flex; gap: 1rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked>
                                    <span>Email</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked>
                                    <span>Text</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked>
                                    <span>App</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Payment Notifications -->
                        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1rem;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem;">Payment Notifications</div>
                            <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 1rem;">Receive alerts when payments are processed</div>
                            <div style="display: flex; gap: 1rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked>
                                    <span>Email</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox">
                                    <span>Text</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox">
                                    <span>App</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" style="margin-top: 1.5rem;" onclick="saveNotifications()">Save Notification Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Team Member Modal -->
    <div id="addTeamModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">Add Team Member</h3>
                <button class="modal-close" onclick="closeAddTeamModal()">‚úï</button>
            </div>
            
            <div class="modal-body">
                <!-- Personal Information -->
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Personal Information</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label class="form-label">First Name</label>
                            <input type="text" class="form-input" id="teamFirstName" placeholder="John">
                        </div>
                        <div>
                            <label class="form-label">Last Name</label>
                            <input type="text" class="form-input" id="teamLastName" placeholder="Smith">
                        </div>
                        <div>
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="teamEmail" placeholder="john@company.com">
                        </div>
                        <div>
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-input" id="teamPhone" placeholder="(555) 123-4567">
                        </div>
                    </div>
                </div>
                
                <!-- Role & Permissions -->
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Role & Permissions</h4>
                    <div style="display: grid; gap: 1rem;">
                        <div>
                            <label class="form-label">Role</label>
                            <select class="form-input" id="teamRole" onchange="updatePermissions()">
                                <option value="">Select Role</option>
                                <option value="technician">Technician</option>
                                <option value="lead_technician">Lead Technician</option>
                                <option value="office_manager">Office Manager</option>
                                <option value="estimator">Estimator</option>
                                <option value="admin">Administrator</option>
                            </select>
                        </div>
                        
                        <div style="background: #f9fafb; padding: 1rem; border-radius: 6px;">
                            <div style="font-weight: 500; margin-bottom: 0.75rem;">Permissions</div>
                            <div style="display: grid; gap: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="permViewRFPs"> View RFPs
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="permSubmitBids"> Submit Bids
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="permManageWO"> Manage Work Orders
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="permViewPayments"> View Payments
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="permManageTeam"> Manage Team
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Certifications -->
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem;">Certifications & Licenses</h4>
                    <div style="display: grid; gap: 1rem;">
                        <div>
                            <label class="form-label">License Type</label>
                            <select class="form-input" id="licenseType">
                                <option value="">None</option>
                                <option value="journeyman">Journeyman</option>
                                <option value="master">Master Electrician</option>
                                <option value="hvac_cert">HVAC Certified</option>
                                <option value="plumbing">Plumbing License</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">License Number</label>
                            <input type="text" class="form-input" id="licenseNumber" placeholder="Optional">
                        </div>
                        <div>
                            <label class="form-label">Expiration Date</label>
                            <input type="date" class="form-input" id="licenseExpiry">
                        </div>
                    </div>
                </div>
                
                <!-- Send Invitation -->
                <div style="background: #f0fdf4; padding: 1rem; border-radius: 6px; border: 1px solid #bbf7d0;">
                    <label style="display: flex; align-items: center; gap: 0.5rem;">
                        <input type="checkbox" checked id="sendInvite">
                        <span>Send invitation email to new team member</span>
                    </label>
                    <p style="font-size: 0.875rem; color: #6b7280; margin-top: 0.5rem; margin-bottom: 0;">
                        They'll receive an email to set up their account and password
                    </p>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAddTeamModal()">Cancel</button>
                <button class="btn btn-primary" onclick="addTeamMember()">Add Team Member</button>
            </div>
        </div>
    </div>
    
    <!-- Bid Submission Modal -->
    <div id="bidModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">Submit Your Bid</h3>
                <button class="modal-close" onclick="closeBidModal()">‚úï</button>
            </div>
            
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <!-- RFP Info -->
                <div style="background: #f9fafb; padding: 1rem; border-radius: 6px; margin-bottom: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <label class="form-label">RFP Reference</label>
                            <input type="text" class="form-input" id="rfpReference" readonly style="background: transparent; border: none; font-weight: 600; padding: 0;">
                        </div>
                        <div id="rfpBudgetRange" style="text-align: right;">
                            <div style="font-size: 0.75rem; color: #6b7280;">Budget Range</div>
                            <div style="font-weight: 600; color: #10b981;">$5,000 - $8,000</div>
                        </div>
                    </div>
                </div>
                
                <!-- Labor Section -->
                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.25rem; margin-bottom: 1.5rem;">
                    <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; color: #111827;">Labor Details</h4>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label class="form-label">Labor Type</label>
                        </div>
                        <div>
                            <label class="form-label">Hours</label>
                        </div>
                        <div>
                            <label class="form-label">Rate/Hour</label>
                        </div>
                        <div>
                            <label class="form-label">Total</label>
                        </div>
                    </div>
                    
                    <div id="laborItems">
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 1rem; margin-bottom: 0.75rem;">
                            <input type="text" class="form-input" placeholder="Standard Labor" value="Standard Labor">
                            <input type="number" class="form-input labor-hours" placeholder="0" oninput="calculateLabor()">
                            <input type="number" class="form-input labor-rate" placeholder="0.00" value="150" oninput="calculateLabor()">
                            <input type="text" class="form-input labor-total" readonly style="background: #f9fafb;" value="$0.00">
                        </div>
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 1rem; margin-bottom: 0.75rem;">
                            <input type="text" class="form-input" placeholder="Overtime Labor" value="Overtime Labor">
                            <input type="number" class="form-input labor-hours" placeholder="0" oninput="calculateLabor()">
                            <input type="number" class="form-input labor-rate" placeholder="0.00" value="225" oninput="calculateLabor()">
                            <input type="text" class="form-input labor-total" readonly style="background: #f9fafb;" value="$0.00">
                        </div>
                    </div>
                    
                    <div style="border-top: 1px solid #e5e7eb; padding-top: 0.75rem; margin-top: 0.75rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 600;">Total Labor:</span>
                            <span id="laborSubtotal" style="font-size: 1.125rem; font-weight: 600; color: #10b981;">$0.00</span>
                        </div>
                    </div>
                </div>
                
                <!-- Materials Section -->
                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.25rem; margin-bottom: 1.5rem;">
                    <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; color: #111827;">Materials & Equipment</h4>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 0.75rem; margin-bottom: 1rem;">
                        <div>
                            <label class="form-label">Item Description</label>
                        </div>
                        <div>
                            <label class="form-label">Quantity</label>
                        </div>
                        <div>
                            <label class="form-label">Unit Price</label>
                        </div>
                        <div>
                            <label class="form-label">Total</label>
                        </div>
                        <div></div>
                    </div>
                    
                    <div id="materialItems">
                        <div class="material-row" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 0.75rem; margin-bottom: 0.75rem;">
                            <input type="text" class="form-input material-desc" placeholder="e.g., HVAC Filter 20x25x4">
                            <input type="number" class="form-input material-qty" placeholder="0" oninput="calculateMaterials()">
                            <input type="number" class="form-input material-price" placeholder="0.00" oninput="calculateMaterials()">
                            <input type="text" class="form-input material-total" readonly style="background: #f9fafb;" value="$0.00">
                            <button class="btn btn-secondary" style="padding: 0.5rem;" onclick="removeMaterialRow(this)">‚úï</button>
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary" style="font-size: 0.875rem;" onclick="addMaterialRow()">+ Add Material</button>
                    
                    <div style="border-top: 1px solid #e5e7eb; padding-top: 0.75rem; margin-top: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 600;">Total Materials:</span>
                            <span id="materialsSubtotal" style="font-size: 1.125rem; font-weight: 600; color: #10b981;">$0.00</span>
                        </div>
                    </div>
                </div>
                
                <!-- Additional Costs -->
                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.25rem; margin-bottom: 1.5rem;">
                    <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; color: #111827;">Additional Costs</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label class="form-label">Equipment Rental</label>
                            <input type="number" class="form-input" id="equipmentRental" placeholder="0.00" oninput="calculateTotal()">
                        </div>
                        <div>
                            <label class="form-label">Permits & Licenses</label>
                            <input type="number" class="form-input" id="permits" placeholder="0.00" oninput="calculateTotal()">
                        </div>
                        <div>
                            <label class="form-label">Transportation</label>
                            <input type="number" class="form-input" id="transportation" placeholder="0.00" oninput="calculateTotal()">
                        </div>
                        <div>
                            <label class="form-label">Disposal Fees</label>
                            <input type="number" class="form-input" id="disposal" placeholder="0.00" oninput="calculateTotal()">
                        </div>
                    </div>
                </div>
                
                <!-- Schedule & Terms -->
                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.25rem; margin-bottom: 1.5rem;">
                    <h4 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; color: #111827;">Schedule & Terms</h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label class="form-label">Start Date</label>
                            <input type="date" class="form-input" id="startDate">
                        </div>
                        <div>
                            <label class="form-label">Completion Date</label>
                            <input type="date" class="form-input" id="completionDate">
                        </div>
                        <div>
                            <label class="form-label">Warranty Period</label>
                            <select class="form-input" id="warrantyPeriod">
                                <option value="90">90 Days</option>
                                <option value="180">6 Months</option>
                                <option value="365">1 Year</option>
                                <option value="730">2 Years</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Payment Terms</label>
                            <select class="form-input" id="paymentTerms">
                                <option value="net30">Net 30</option>
                                <option value="net15">Net 15</option>
                                <option value="cod">Payment on Completion</option>
                                <option value="5050">50% Deposit, 50% Completion</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="form-label">Scope of Work / Notes</label>
                        <textarea class="form-input" id="scopeNotes" rows="4" placeholder="Describe your approach, any assumptions, exclusions, or special conditions..."></textarea>
                    </div>
                </div>
                
                <!-- Cost Summary -->
                <div class="cost-summary" style="background: #f9fafb; padding: 1.25rem;">
                    <div class="cost-row">
                        <span>Labor:</span>
                        <span id="laborDisplay">$0.00</span>
                    </div>
                    <div class="cost-row">
                        <span>Materials:</span>
                        <span id="materialsDisplay">$0.00</span>
                    </div>
                    <div class="cost-row">
                        <span>Additional Costs:</span>
                        <span id="additionalDisplay">$0.00</span>
                    </div>
                    <div class="cost-row" style="padding-top: 0.5rem; border-top: 1px solid #e5e7eb;">
                        <span>Subtotal:</span>
                        <span id="subtotalDisplay">$0.00</span>
                    </div>
                    <div class="cost-row">
                        <span>Overhead & Profit (15%):</span>
                        <span id="profitDisplay">$0.00</span>
                    </div>
                    <div class="cost-row total" style="font-size: 1.25rem;">
                        <span>Total Bid:</span>
                        <span id="totalDisplay">$0.00</span>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeBidModal()">Cancel</button>
                <button class="btn btn-secondary" onclick="saveDraft()">Save Draft</button>
                <button class="btn btn-primary" onclick="submitBid()">Submit Bid</button>
            </div>
        </div>
    </div>

    <!-- Advanced Features Script -->
    <script src="/scripts/advanced-features.js"></script>
    
    <script>
        // Initialize
        console.log('Subcontractor Portal Loading...');
        
        // Set today's date for availability
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            const availabilityInput = document.getElementById('availability');
            if (availabilityInput) {
                availabilityInput.min = today;
                availabilityInput.value = today;
            }
            console.log('Portal loaded successfully');
        });
        
        // Section Navigation
        function showSection(sectionName) {
            console.log('Showing section:', sectionName);
            
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            const sectionId = sectionName + '-section';
            const section = document.getElementById(sectionId);
            if (section) {
                section.style.display = 'block';
            }
            
            // Update nav active state
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Initialize calendar if showing work orders
            if (sectionName === 'work-orders') {
                renderCalendar();
            }
        }
        
        // Bid Modal Functions
        function openBidModal(rfpId) {
            console.log('Opening bid modal for:', rfpId);
            document.getElementById('rfpReference').value = rfpId;
            
            // Set budget range based on RFP
            const budgetRange = rfpId === 'RFP-2024-001' ? '$5,000 - $8,000' : '$12,000 - $15,000';
            document.querySelector('#rfpBudgetRange div:last-child').textContent = budgetRange;
            
            // Set default dates
            const today = new Date();
            const startDate = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000); // 1 week from now
            const completionDate = new Date(today.getTime() + 14 * 24 * 60 * 60 * 1000); // 2 weeks from now
            
            document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
            document.getElementById('completionDate').value = completionDate.toISOString().split('T')[0];
            
            document.getElementById('bidModal').classList.add('active');
        }
        
        function closeBidModal() {
            console.log('Closing bid modal');
            document.getElementById('bidModal').classList.remove('active');
            // Reset form
            resetBidForm();
        }
        
        function resetBidForm() {
            // Reset all inputs
            document.querySelectorAll('#bidModal input[type="number"], #bidModal input[type="text"]:not(#rfpReference)').forEach(input => {
                if (!input.readOnly) input.value = '';
            });
            document.getElementById('scopeNotes').value = '';
            
            // Reset labor defaults
            document.querySelectorAll('.labor-rate')[0].value = '150';
            document.querySelectorAll('.labor-rate')[1].value = '225';
            
            // Clear extra material rows
            const materialItems = document.getElementById('materialItems');
            while (materialItems.children.length > 1) {
                materialItems.removeChild(materialItems.lastChild);
            }
            
            calculateTotal();
        }
        
        function calculateLabor() {
            let totalLabor = 0;
            const laborRows = document.querySelectorAll('#laborItems > div');
            
            laborRows.forEach(row => {
                const hours = parseFloat(row.querySelector('.labor-hours').value) || 0;
                const rate = parseFloat(row.querySelector('.labor-rate').value) || 0;
                const rowTotal = hours * rate;
                row.querySelector('.labor-total').value = '$' + rowTotal.toFixed(2);
                totalLabor += rowTotal;
            });
            
            document.getElementById('laborSubtotal').textContent = '$' + totalLabor.toFixed(2);
            calculateTotal();
        }
        
        function calculateMaterials() {
            let totalMaterials = 0;
            const materialRows = document.querySelectorAll('.material-row');
            
            materialRows.forEach(row => {
                const qty = parseFloat(row.querySelector('.material-qty').value) || 0;
                const price = parseFloat(row.querySelector('.material-price').value) || 0;
                const rowTotal = qty * price;
                row.querySelector('.material-total').value = '$' + rowTotal.toFixed(2);
                totalMaterials += rowTotal;
            });
            
            document.getElementById('materialsSubtotal').textContent = '$' + totalMaterials.toFixed(2);
            calculateTotal();
        }
        
        function addMaterialRow() {
            const materialItems = document.getElementById('materialItems');
            const newRow = document.createElement('div');
            newRow.className = 'material-row';
            newRow.style = 'display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 0.75rem; margin-bottom: 0.75rem;';
            newRow.innerHTML = `
                <input type="text" class="form-input material-desc" placeholder="e.g., HVAC Filter 20x25x4">
                <input type="number" class="form-input material-qty" placeholder="0" oninput="calculateMaterials()">
                <input type="number" class="form-input material-price" placeholder="0.00" oninput="calculateMaterials()">
                <input type="text" class="form-input material-total" readonly style="background: #f9fafb;" value="$0.00">
                <button class="btn btn-secondary" style="padding: 0.5rem;" onclick="removeMaterialRow(this)">‚úï</button>
            `;
            materialItems.appendChild(newRow);
        }
        
        function removeMaterialRow(button) {
            const materialItems = document.getElementById('materialItems');
            if (materialItems.children.length > 1) {
                button.parentElement.remove();
                calculateMaterials();
            }
        }
        
        function calculateTotal() {
            // Get labor total
            const laborText = document.getElementById('laborSubtotal').textContent;
            const labor = parseFloat(laborText.replace('$', '').replace(',', '')) || 0;
            
            // Get materials total
            const materialsText = document.getElementById('materialsSubtotal').textContent;
            const materials = parseFloat(materialsText.replace('$', '').replace(',', '')) || 0;
            
            // Get additional costs
            const equipment = parseFloat(document.getElementById('equipmentRental').value) || 0;
            const permits = parseFloat(document.getElementById('permits').value) || 0;
            const transportation = parseFloat(document.getElementById('transportation').value) || 0;
            const disposal = parseFloat(document.getElementById('disposal').value) || 0;
            
            const additionalCosts = equipment + permits + transportation + disposal;
            const subtotal = labor + materials + additionalCosts;
            const profit = subtotal * 0.15; // 15% overhead & profit
            const total = subtotal + profit;
            
            // Update displays
            document.getElementById('laborDisplay').textContent = '$' + labor.toFixed(2);
            document.getElementById('materialsDisplay').textContent = '$' + materials.toFixed(2);
            document.getElementById('additionalDisplay').textContent = '$' + additionalCosts.toFixed(2);
            document.getElementById('subtotalDisplay').textContent = '$' + subtotal.toFixed(2);
            document.getElementById('profitDisplay').textContent = '$' + profit.toFixed(2);
            document.getElementById('totalDisplay').textContent = '$' + total.toFixed(2);
        }
        
        function submitBid() {
            const rfpId = document.getElementById('rfpReference').value;
            const totalText = document.getElementById('totalDisplay').textContent;
            const startDate = document.getElementById('startDate').value;
            const completionDate = document.getElementById('completionDate').value;
            const scopeNotes = document.getElementById('scopeNotes').value;
            
            // Check for required fields
            const laborTotal = document.getElementById('laborSubtotal').textContent;
            if (laborTotal === '$0.00') {
                alert('Please enter labor hours and rates');
                return;
            }
            
            if (!startDate || !completionDate) {
                alert('Please enter start and completion dates');
                return;
            }
            
            if (!scopeNotes) {
                alert('Please describe your scope of work');
                return;
            }
            
            alert(`Bid submitted successfully!\n\nRFP: ${rfpId}\nTotal Bid: ${totalText}\nSchedule: ${startDate} to ${completionDate}\n\nYour bid has been sent to the client for review.`);
            closeBidModal();
        }
        
        function saveDraft() {
            alert('Bid draft saved!\n\nYou can access your saved drafts from the Bids section of your dashboard.');
        }
        
        // User Dropdown Functions
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('active');
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function closeDropdown(e) {
                if (!dropdown.contains(e.target)) {
                    dropdown.classList.remove('active');
                    document.removeEventListener('click', closeDropdown);
                }
            });
            
            // Prevent the document click from immediately closing
            event.stopPropagation();
        }
        
        function closeUserDropdown() {
            document.getElementById('userDropdown').classList.remove('active');
        }
        
        // Team Management Functions
        function openAddTeamModal() {
            document.getElementById('addTeamModal').classList.add('active');
        }
        
        function closeAddTeamModal() {
            document.getElementById('addTeamModal').classList.remove('active');
            // Reset form
            document.getElementById('teamFirstName').value = '';
            document.getElementById('teamLastName').value = '';
            document.getElementById('teamEmail').value = '';
            document.getElementById('teamPhone').value = '';
            document.getElementById('teamRole').value = '';
            document.getElementById('licenseType').value = '';
            document.getElementById('licenseNumber').value = '';
            document.getElementById('licenseExpiry').value = '';
            // Reset checkboxes
            document.querySelectorAll('#addTeamModal input[type="checkbox"]').forEach(cb => {
                if (cb.id !== 'sendInvite') cb.checked = false;
            });
            document.getElementById('sendInvite').checked = true;
        }
        
        function updatePermissions() {
            const role = document.getElementById('teamRole').value;
            const permissions = {
                technician: { viewRFPs: true, submitBids: false, manageWO: true, viewPayments: false, manageTeam: false },
                lead_technician: { viewRFPs: true, submitBids: true, manageWO: true, viewPayments: false, manageTeam: false },
                office_manager: { viewRFPs: true, submitBids: true, manageWO: true, viewPayments: true, manageTeam: false },
                estimator: { viewRFPs: true, submitBids: true, manageWO: false, viewPayments: true, manageTeam: false },
                admin: { viewRFPs: true, submitBids: true, manageWO: true, viewPayments: true, manageTeam: true }
            };
            
            if (permissions[role]) {
                document.getElementById('permViewRFPs').checked = permissions[role].viewRFPs;
                document.getElementById('permSubmitBids').checked = permissions[role].submitBids;
                document.getElementById('permManageWO').checked = permissions[role].manageWO;
                document.getElementById('permViewPayments').checked = permissions[role].viewPayments;
                document.getElementById('permManageTeam').checked = permissions[role].manageTeam;
            }
        }
        
        function addTeamMember() {
            const firstName = document.getElementById('teamFirstName').value;
            const lastName = document.getElementById('teamLastName').value;
            const email = document.getElementById('teamEmail').value;
            const role = document.getElementById('teamRole').value;
            
            if (!firstName || !lastName || !email || !role) {
                alert('Please fill in all required fields');
                return;
            }
            
            const sendInvite = document.getElementById('sendInvite').checked;
            
            alert(`Team Member Added Successfully!\n\nName: ${firstName} ${lastName}\nEmail: ${email}\nRole: ${role}\n\n${sendInvite ? 'Invitation email has been sent.' : 'No invitation sent.'}`);
            closeAddTeamModal();
        }
        
        function editTeamMember(memberId) {
            alert(`Edit Team Member ${memberId}\n\nThis would allow you to:\n‚Ä¢ Update contact information\n‚Ä¢ Change role and permissions\n‚Ä¢ Update certifications\n‚Ä¢ Deactivate access if needed`);
        }
        
        // Settings Functions
        function saveCompanyProfile() {
            alert('Company Profile Saved!\n\nYour company information has been updated successfully.');
        }
        
        function openStripeDashboard() {
            alert('Opening Stripe Dashboard...\n\nThis would redirect to your Stripe Connect dashboard where you can:\n‚Ä¢ View payment history\n‚Ä¢ Update bank details\n‚Ä¢ Download tax documents\n‚Ä¢ Manage payout settings');
            // In production: window.open('https://dashboard.stripe.com/connect/accounts/[account_id]', '_blank');
        }
        
        function updateStripeSettings() {
            alert('Payment Settings Updated!\n\nYour payout schedule has been updated:\n‚Ä¢ Frequency: ' + document.getElementById('payoutFrequency').value + '\n‚Ä¢ Delay: ' + document.getElementById('payoutDelay').value + ' business days');
        }
        
        function updateBankAccount() {
            alert('Update Bank Account\n\nThis would open a secure form to:\n‚Ä¢ Enter new bank account details\n‚Ä¢ Verify micro-deposits\n‚Ä¢ Update tax information\n\nAll information is encrypted and handled by Stripe.');
        }
        
        function disconnectStripe() {
            if (confirm('Disconnect Stripe Account?\n\nWarning: This will:\n‚Ä¢ Stop all future payments\n‚Ä¢ Prevent you from receiving work order payments\n‚Ä¢ Require re-verification to reconnect\n\nAre you sure?')) {
                alert('Account disconnected. You will need to reconnect to receive payments.');
            }
        }
        
        function saveNotifications() {
            alert('Notification Preferences Saved!\n\nYou will receive notifications based on your selected preferences.');
        }
        
        console.log('All functions loaded');
        
        // Calendar functionality
        let currentDate = new Date();
        let currentView = 'month';
        
        function changeCalendarView() {
            currentView = document.getElementById('calendarView').value;
            renderCalendar();
        }
        
        function previousPeriod() {
            switch(currentView) {
                case 'month':
                    currentDate.setMonth(currentDate.getMonth() - 1);
                    break;
                case 'week':
                    currentDate.setDate(currentDate.getDate() - 7);
                    break;
                case 'day':
                    currentDate.setDate(currentDate.getDate() - 1);
                    break;
            }
            renderCalendar();
        }
        
        function nextPeriod() {
            switch(currentView) {
                case 'month':
                    currentDate.setMonth(currentDate.getMonth() + 1);
                    break;
                case 'week':
                    currentDate.setDate(currentDate.getDate() + 7);
                    break;
                case 'day':
                    currentDate.setDate(currentDate.getDate() + 1);
                    break;
            }
            renderCalendar();
        }
        
        function goToToday() {
            currentDate = new Date();
            renderCalendar();
        }
        
        function renderCalendar() {
            const periodElement = document.getElementById('currentPeriod');
            const calendarGrid = document.getElementById('calendarGrid');
            
            if (!periodElement || !calendarGrid) return;
            
            switch(currentView) {
                case 'month':
                    renderMonthView(periodElement, calendarGrid);
                    break;
                case 'week':
                    renderWeekView(periodElement, calendarGrid);
                    break;
                case 'day':
                    renderDayView(periodElement, calendarGrid);
                    break;
            }
            
            // Also update the work orders list
            renderWorkOrdersList();
        }
        
        function renderMonthView(periodElement, calendarGrid) {
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            
            periodElement.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const workOrders = getSubcontractorWorkOrders();
            
            let calendarHTML = `
                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: #e5e7eb;">
                    ${['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => 
                        `<div style="background: #f9fafb; padding: 0.75rem; text-align: center; font-weight: 600; font-size: 0.875rem;">${day}</div>`
                    ).join('')}
            `;
            
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const isCurrentMonth = date.getMonth() === currentDate.getMonth();
                const isToday = date.toDateString() === new Date().toDateString();
                const dayWorkOrders = workOrders.filter(wo => {
                    const woDate = new Date(wo.date);
                    return woDate.toDateString() === date.toDateString();
                });
                
                calendarHTML += `
                    <div style="background: white; min-height: 100px; padding: 0.5rem; ${!isCurrentMonth ? 'opacity: 0.3;' : ''} ${isToday ? 'border: 2px solid #10b981;' : 'border: 1px solid #e5e7eb;'}" onclick="viewDayDetail('${date.toISOString()}')">
                        <div style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.25rem; ${isToday ? 'color: #10b981;' : ''}">${date.getDate()}</div>
                        ${dayWorkOrders.map(wo => `
                            <div style="background: ${getStatusColor(wo.status)}; color: white; padding: 0.125rem 0.25rem; margin-bottom: 0.125rem; border-radius: 3px; font-size: 0.675rem; cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" onclick="event.stopPropagation(); viewWorkOrderDetail('${wo.id}')" title="${wo.title} - ${wo.client}">
                                ${wo.time} ${wo.title}
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            calendarHTML += '</div>';
            calendarGrid.innerHTML = calendarHTML;
        }
        
        function renderWeekView(periodElement, calendarGrid) {
            const startOfWeek = new Date(currentDate);
            startOfWeek.setDate(currentDate.getDate() - currentDate.getDay());
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            periodElement.textContent = `Week of ${startOfWeek.toLocaleDateString()} - ${endOfWeek.toLocaleDateString()}`;
            
            const workOrders = getSubcontractorWorkOrders();
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            
            let calendarHTML = '<div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 1rem;">';
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(startOfWeek);
                date.setDate(startOfWeek.getDate() + i);
                const isToday = date.toDateString() === new Date().toDateString();
                const dayWorkOrders = workOrders.filter(wo => {
                    const woDate = new Date(wo.date);
                    return woDate.toDateString() === date.toDateString();
                });
                
                calendarHTML += `
                    <div style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 0.75rem; ${isToday ? 'border-color: #10b981; border-width: 2px;' : ''}">
                        <div style="font-weight: 600; margin-bottom: 0.5rem; ${isToday ? 'color: #10b981;' : ''}">${days[i]}</div>
                        <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.75rem;">${date.getDate()}</div>
                        ${dayWorkOrders.length === 0 ? '<div style="color: #9ca3af; font-size: 0.875rem;">No work orders</div>' : ''}
                        ${dayWorkOrders.map(wo => `
                            <div style="background: ${getStatusColor(wo.status)}; color: white; padding: 0.5rem; margin-bottom: 0.5rem; border-radius: 6px; font-size: 0.875rem; cursor: pointer;" onclick="viewWorkOrderDetail('${wo.id}')">
                                <div style="font-weight: 600;">${wo.time}</div>
                                <div>${wo.title}</div>
                                <div style="font-size: 0.75rem; opacity: 0.9;">${wo.client}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            calendarHTML += '</div>';
            calendarGrid.innerHTML = calendarHTML;
        }
        
        function renderDayView(periodElement, calendarGrid) {
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            
            periodElement.textContent = `${dayNames[currentDate.getDay()]}, ${monthNames[currentDate.getMonth()]} ${currentDate.getDate()}, ${currentDate.getFullYear()}`;
            
            const workOrders = getSubcontractorWorkOrders().filter(wo => {
                const woDate = new Date(wo.date);
                return woDate.toDateString() === currentDate.toDateString();
            });
            
            let calendarHTML = '<div style="background: white; padding: 1.5rem;">';
            
            if (workOrders.length === 0) {
                calendarHTML += '<div style="text-align: center; color: #6b7280; padding: 3rem;">No work orders scheduled for this day</div>';
            } else {
                // Sort by time
                workOrders.sort((a, b) => {
                    const timeA = parseInt(a.time.replace(/[^\d]/g, ''));
                    const timeB = parseInt(b.time.replace(/[^\d]/g, ''));
                    return timeA - timeB;
                });
                
                calendarHTML += '<div style="display: grid; gap: 1rem;">';
                workOrders.forEach(wo => {
                    calendarHTML += `
                        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.25rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow=''" onclick="viewWorkOrderDetail('${wo.id}')">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">WO #${wo.id}</div>
                                    <div style="font-size: 1.125rem; font-weight: 600; margin: 0.25rem 0;">${wo.title}</div>
                                    <div style="color: #6b7280;">${wo.client}</div>
                                </div>
                                <span style="background: ${getStatusColor(wo.status)}; color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase;">
                                    ${wo.status}
                                </span>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; padding-top: 1rem; border-top: 1px solid #f3f4f6;">
                                <div>
                                    <div style="font-size: 0.75rem; color: #6b7280;">Time</div>
                                    <div style="font-weight: 500;">${wo.time}</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.75rem; color: #6b7280;">Priority</div>
                                    <div style="font-weight: 500;">${wo.priority}</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.75rem; color: #6b7280;">Payment</div>
                                    <div style="font-weight: 600; color: #10b981;">$${wo.payment.toLocaleString()}</div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                calendarHTML += '</div>';
            }
            
            calendarHTML += '</div>';
            calendarGrid.innerHTML = calendarHTML;
        }
        
        function renderWorkOrdersList() {
            const workOrdersList = document.getElementById('workOrdersList');
            if (!workOrdersList) return;
            
            const workOrders = getSubcontractorWorkOrders();
            const futureOrders = workOrders.filter(wo => new Date(wo.date) >= new Date()).slice(0, 5);
            
            if (futureOrders.length === 0) {
                workOrdersList.innerHTML = '<div style="text-align: center; color: #6b7280; padding: 2rem;">No upcoming work orders</div>';
                return;
            }
            
            let listHTML = '<div style="display: grid; gap: 1rem;">';
            futureOrders.forEach(wo => {
                const woDate = new Date(wo.date);
                listHTML += `
                    <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1rem; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow=''" onclick="viewWorkOrderDetail('${wo.id}')">
                        <div>
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                                <span style="font-size: 0.875rem; color: #6b7280;">WO #${wo.id}</span>
                                <span style="background: ${getStatusColor(wo.status)}; color: white; padding: 0.125rem 0.5rem; border-radius: 12px; font-size: 0.75rem; font-weight: 600;">${wo.status}</span>
                            </div>
                            <div style="font-weight: 600;">${wo.title}</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">${wo.client} ‚Ä¢ ${woDate.toLocaleDateString()} at ${wo.time}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.125rem; font-weight: 600; color: #10b981;">$${wo.payment.toLocaleString()}</div>
                            <div style="font-size: 0.75rem; color: #6b7280;">${wo.priority} Priority</div>
                        </div>
                    </div>
                `;
            });
            listHTML += '</div>';
            workOrdersList.innerHTML = listHTML;
        }
        
        function getSubcontractorWorkOrders() {
            // Sample work orders assigned to this subcontractor (Johnson Electric)
            return [
                { id: '1001', title: 'Emergency Plumbing Repair', client: 'OpenWrench Facilities', date: '2025-09-01', status: 'in-progress', priority: 'High', time: '3:00 PM', payment: 3500 },
                { id: '1002', title: 'HVAC Maintenance', client: 'Tech Startup Hub', date: '2025-09-02', status: 'scheduled', priority: 'Medium', time: '9:00 AM', payment: 1200 },
                { id: '1003', title: 'Lighting Installation', client: 'Downtown Office', date: '2025-09-03', status: 'scheduled', priority: 'Normal', time: '10:00 AM', payment: 5800 },
                { id: '1004', title: 'Electrical Panel Check', client: 'Retail Center', date: '2025-09-05', status: 'scheduled', priority: 'High', time: '8:00 AM', payment: 2400 },
                { id: '1005', title: 'Monthly HVAC Service', client: 'ABC Restaurant', date: '2025-09-15', status: 'recurring', priority: 'Normal', time: '11:00 AM', payment: 800 },
                { id: '1006', title: 'Emergency Electrical', client: 'XYZ Hotel', date: '2025-09-08', status: 'urgent', priority: 'High', time: '2:00 PM', payment: 4200 },
                { id: '1007', title: 'Preventive Maintenance', client: 'Tech Campus B', date: '2025-09-10', status: 'scheduled', priority: 'Low', time: '1:00 PM', payment: 950 },
                { id: '1008', title: 'Lighting Repair', client: 'Mall Complex', date: '2025-09-12', status: 'scheduled', priority: 'Medium', time: '4:00 PM', payment: 1800 }
            ];
        }
        
        function getStatusColor(status) {
            switch(status.toLowerCase()) {
                case 'in-progress': return '#f59e0b';
                case 'scheduled': return '#3b82f6';
                case 'completed': return '#10b981';
                case 'urgent': return '#ef4444';
                case 'recurring': return '#8b5cf6';
                case 'overdue': return '#dc2626';
                default: return '#6b7280';
            }
        }
        
        function viewDayDetail(dateString) {
            currentDate = new Date(dateString);
            currentView = 'day';
            document.getElementById('calendarView').value = 'day';
            renderCalendar();
        }
        
        function viewWorkOrderDetail(workOrderId) {
            // Find the work order
            const workOrder = getSubcontractorWorkOrders().find(wo => wo.id === workOrderId);
            if (!workOrder) {
                alert('Work order not found');
                return;
            }
            
            // Show work order detail view
            showWorkOrderDetailView(workOrder);
        }
        
        function showWorkOrderDetailView(workOrder) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Create or update work order detail section
            let detailSection = document.getElementById('work-order-detail-section');
            if (!detailSection) {
                detailSection = document.createElement('div');
                detailSection.id = 'work-order-detail-section';
                detailSection.className = 'content-section';
                document.querySelector('.main-content').appendChild(detailSection);
            }
            
            const woDate = new Date(workOrder.date);
            const statusColor = getStatusColor(workOrder.status);
            
            detailSection.innerHTML = `
                <div class="dashboard-header">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <button class="btn btn-secondary" onclick="showSection('work-orders')" style="margin-bottom: 1rem;">‚Üê Back to Work Orders</button>
                            <h1 class="dashboard-title">Work Order #${workOrder.id}</h1>
                            <p class="dashboard-subtitle">${workOrder.title}</p>
                        </div>
                        <span style="background: ${statusColor}; color: white; padding: 0.5rem 1rem; border-radius: 20px; font-weight: 600; text-transform: uppercase;">
                            ${workOrder.status}
                        </span>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="section-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                    <h2 style="font-size: 1.25rem; margin-bottom: 1rem;">Quick Actions</h2>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        ${workOrder.status === 'scheduled' || workOrder.status === 'recurring' ? `
                            <button class="btn" style="background: white; color: #10b981;" onclick="checkInWorkOrder('${workOrder.id}')">
                                ‚úì Check In
                            </button>
                        ` : ''}
                        ${workOrder.status === 'in-progress' ? `
                            <button class="btn" style="background: white; color: #10b981;" onclick="completeWorkOrder('${workOrder.id}')">
                                ‚úì Mark Complete
                            </button>
                            <button class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white;" onclick="requestHelp('${workOrder.id}')">
                                Request Help
                            </button>
                            <button class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white;" onclick="reportIssue('${workOrder.id}')">
                                Report Issue
                            </button>
                        ` : ''}
                        ${workOrder.status === 'urgent' ? `
                            <button class="btn" style="background: #ef4444; color: white;" onclick="acknowledgeUrgent('${workOrder.id}')">
                                Acknowledge Urgent
                            </button>
                        ` : ''}
                        <button class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white;" onclick="callClient('${workOrder.id}')">
                            üìû Call Client
                        </button>
                        <button class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white;" onclick="getDirections('${workOrder.id}')">
                            üìç Get Directions
                        </button>
                    </div>
                </div>
                
                <!-- Work Order Details Grid -->
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem;">
                    <!-- Left Column -->
                    <div>
                        <!-- Job Details -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Job Details</h2>
                            <div style="display: grid; gap: 1rem;">
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Service Type</div>
                                    <div style="font-weight: 500;">${workOrder.title}</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Description</div>
                                    <div style="line-height: 1.6;">
                                        ${workOrder.description || 'Perform scheduled maintenance and repairs as specified in the service agreement. Check all systems and ensure proper functioning.'}
                                    </div>
                                </div>
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Special Instructions</div>
                                    <div style="background: #fef3c7; padding: 1rem; border-radius: 6px; border-left: 4px solid #f59e0b;">
                                        ${workOrder.instructions || 'Contact site manager upon arrival. Access code: 4523. Service elevator required for equipment.'}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Materials & Equipment -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Materials & Equipment</h2>
                            <div style="display: grid; gap: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked> HVAC diagnostic tools
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked> Replacement filters (bring 3)
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox"> Refrigerant (if needed)
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox"> Safety equipment
                                </label>
                            </div>
                        </div>
                        
                        <!-- Work Log -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Work Log</h2>
                            <div style="margin-bottom: 1rem;">
                                <textarea placeholder="Enter work performed, issues found, parts used..." style="width: 100%; min-height: 120px; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; font-family: inherit;" id="workLog"></textarea>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div>
                                    <label style="display: block; font-size: 0.875rem; margin-bottom: 0.25rem;">Start Time</label>
                                    <input type="time" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;" id="startTime">
                                </div>
                                <div>
                                    <label style="display: block; font-size: 0.875rem; margin-bottom: 0.25rem;">End Time</label>
                                    <input type="time" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;" id="endTime">
                                </div>
                            </div>
                            <button class="btn btn-primary" style="margin-top: 1rem;" onclick="saveWorkLog('${workOrder.id}')">Save Work Log</button>
                        </div>
                        
                        <!-- Photos -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Photos</h2>
                            <div style="border: 2px dashed #d1d5db; border-radius: 8px; padding: 2rem; text-align: center;">
                                <button class="btn btn-secondary">üì∑ Upload Photos</button>
                                <p style="margin-top: 0.5rem; color: #6b7280; font-size: 0.875rem;">Take before/after photos for documentation</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column -->
                    <div>
                        <!-- Client Information -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Client Information</h2>
                            <div style="display: grid; gap: 1rem;">
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Client</div>
                                    <div style="font-weight: 500;">${workOrder.client}</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Contact</div>
                                    <div>John Smith</div>
                                    <div style="font-size: 0.875rem; color: #3b82f6; cursor: pointer;" onclick="callClient('${workOrder.id}')">(555) 123-4567</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Location</div>
                                    <div>123 Main Street, Suite 500</div>
                                    <div>Downtown, CA 90210</div>
                                    <button class="btn btn-secondary" style="margin-top: 0.5rem; font-size: 0.875rem;" onclick="getDirections('${workOrder.id}')">
                                        üìç Get Directions
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Schedule Information -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Schedule</h2>
                            <div style="display: grid; gap: 1rem;">
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Date</div>
                                    <div style="font-weight: 500;">${woDate.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Time</div>
                                    <div style="font-weight: 500;">${workOrder.time}</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Duration</div>
                                    <div>Estimated 2-3 hours</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Priority</div>
                                    <div style="font-weight: 500; color: ${workOrder.priority === 'High' ? '#ef4444' : workOrder.priority === 'Medium' ? '#f59e0b' : '#6b7280'}">
                                        ${workOrder.priority} Priority
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Payment Information -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Payment</h2>
                            <div style="display: grid; gap: 1rem;">
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Service Amount</div>
                                    <div style="font-size: 1.5rem; font-weight: 700; color: #10b981;">$${workOrder.payment.toLocaleString()}</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Payment Terms</div>
                                    <div>Net 30 - Invoice upon completion</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Additional Charges</div>
                                    <input type="number" placeholder="Enter additional charges" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;" id="additionalCharges">
                                    <textarea placeholder="Explain additional charges..." style="width: 100%; margin-top: 0.5rem; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 6px;" rows="2"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Status History -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Status History</h2>
                            <div style="display: grid; gap: 0.75rem;">
                                <div style="display: flex; gap: 0.75rem; align-items: start;">
                                    <div style="width: 10px; height: 10px; background: #10b981; border-radius: 50%; margin-top: 0.25rem;"></div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 500;">Created</div>
                                        <div style="font-size: 0.875rem; color: #6b7280;">Aug 25, 2025 - 10:30 AM</div>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 0.75rem; align-items: start;">
                                    <div style="width: 10px; height: 10px; background: #3b82f6; border-radius: 50%; margin-top: 0.25rem;"></div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 500;">Assigned to Johnson Electric</div>
                                        <div style="font-size: 0.875rem; color: #6b7280;">Aug 25, 2025 - 11:00 AM</div>
                                    </div>
                                </div>
                                ${workOrder.status === 'in-progress' ? `
                                    <div style="display: flex; gap: 0.75rem; align-items: start;">
                                        <div style="width: 10px; height: 10px; background: #f59e0b; border-radius: 50%; margin-top: 0.25rem;"></div>
                                        <div style="flex: 1;">
                                            <div style="font-weight: 500;">Checked In</div>
                                            <div style="font-size: 0.875rem; color: #6b7280;">Today - ${new Date().toLocaleTimeString()}</div>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            detailSection.style.display = 'block';
        }
        
        function checkInWorkOrder(workOrderId) {
            if (confirm('Check in to Work Order #' + workOrderId + '?\n\nThis will:\n‚Ä¢ Update status to In Progress\n‚Ä¢ Record your arrival time\n‚Ä¢ Notify the client')) {
                // Update the work order status
                const workOrders = getSubcontractorWorkOrders();
                const wo = workOrders.find(w => w.id === workOrderId);
                if (wo) {
                    wo.status = 'in-progress';
                    // Set start time to current time
                    const now = new Date();
                    document.getElementById('startTime').value = now.toTimeString().slice(0, 5);
                    alert('Successfully checked in to Work Order #' + workOrderId);
                    showWorkOrderDetailView(wo);
                }
            }
        }
        
        function completeWorkOrder(workOrderId) {
            const workLog = document.getElementById('workLog').value;
            const endTime = document.getElementById('endTime').value;
            
            if (!workLog) {
                alert('Please enter work performed in the work log before marking complete.');
                return;
            }
            
            if (!endTime) {
                alert('Please enter the end time before marking complete.');
                return;
            }
            
            if (confirm('Mark Work Order #' + workOrderId + ' as complete?\n\nThis will:\n‚Ä¢ Update status to Completed\n‚Ä¢ Submit work log\n‚Ä¢ Generate invoice\n‚Ä¢ Notify the client')) {
                alert('Work Order #' + workOrderId + ' marked as complete!\n\nInvoice has been generated and sent to the client.');
                showSection('work-orders');
            }
        }
        
        function saveWorkLog(workOrderId) {
            const workLog = document.getElementById('workLog').value;
            if (workLog) {
                alert('Work log saved for Work Order #' + workOrderId);
            } else {
                alert('Please enter work details before saving.');
            }
        }
        
        function requestHelp(workOrderId) {
            const reason = prompt('What kind of help do you need?');
            if (reason) {
                alert('Help request sent to dispatcher for Work Order #' + workOrderId + '\n\nReason: ' + reason + '\n\nSomeone will contact you shortly.');
            }
        }
        
        function reportIssue(workOrderId) {
            const issue = prompt('Describe the issue:');
            if (issue) {
                alert('Issue reported for Work Order #' + workOrderId + '\n\nIssue: ' + issue + '\n\nDispatcher has been notified.');
            }
        }
        
        function acknowledgeUrgent(workOrderId) {
            alert('Urgent status acknowledged for Work Order #' + workOrderId + '\n\nClient has been notified of your acknowledgment.');
        }
        
        function callClient(workOrderId) {
            alert('Calling client at (555) 123-4567...\n\nThis would initiate a phone call on a mobile device.');
        }
        
        function getDirections(workOrderId) {
            alert('Opening directions to:\n123 Main Street, Suite 500\nDowntown, CA 90210\n\nThis would open in your default maps application.');
        }
        
        function viewRFPDetails(rfpId) {
            const rfpDetails = {
                'RFP-2024-001': {
                    title: 'Commercial HVAC System Repair',
                    client: 'OpenWrench Facilities - Downtown Office',
                    budget: '$5,000 - $8,000',
                    deadline: 'Today, 5:00 PM',
                    location: '123 Main St, Suite 500',
                    description: 'Complete HVAC system diagnostic and repair needed for a 15,000 sq ft commercial office space. System is experiencing intermittent cooling failures and unusual noises.',
                    scope: [
                        'Diagnose cooling system failure',
                        'Check and replace filters if needed',
                        'Inspect ductwork for leaks',
                        'Test thermostat functionality',
                        'Verify refrigerant levels',
                        'Clean condenser coils',
                        'Provide detailed report of findings'
                    ],
                    requirements: [
                        'Licensed HVAC technician required',
                        'Must have commercial experience',
                        'Liability insurance minimum $1M',
                        'Available for emergency callbacks',
                        '24/7 support capabilities preferred'
                    ],
                    timeline: '2-3 days for complete diagnosis and repair',
                    contact: 'John Smith - Facility Manager',
                    phone: '(555) 123-4567',
                    email: 'jsmith@heyspruce.com'
                },
                'RFP-2024-002': {
                    title: 'Electrical Panel Upgrade',
                    client: 'Tech Startup Hub - Building A',
                    budget: '$12,000 - $15,000',
                    deadline: 'Tomorrow, 12:00 PM',
                    location: '789 Tech Blvd',
                    description: 'Upgrade main electrical panel from 200A to 400A service to support increased load from new server room and EV charging stations.',
                    scope: [
                        'Remove existing 200A panel',
                        'Install new 400A panel and breakers',
                        'Upgrade main service entrance cables',
                        'Install surge protection',
                        'Add dedicated circuits for EV chargers',
                        'Update grounding system',
                        'Coordinate with utility company for service upgrade'
                    ],
                    requirements: [
                        'Master electrician license required',
                        'Experience with commercial panel upgrades',
                        'Ability to pull permits',
                        'Weekend work availability',
                        'References from similar projects'
                    ],
                    timeline: '3-5 days including utility coordination',
                    contact: 'Sarah Johnson - Operations Manager',
                    phone: '(555) 987-6543',
                    email: 'sjohnson@techstartup.com'
                }
            };
            
            const rfp = rfpDetails[rfpId];
            if (!rfp) {
                alert('RFP details not found');
                return;
            }
            
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Create or update RFP detail section
            let detailSection = document.getElementById('rfp-detail-section');
            if (!detailSection) {
                detailSection = document.createElement('div');
                detailSection.id = 'rfp-detail-section';
                detailSection.className = 'content-section';
                document.querySelector('.main-content').appendChild(detailSection);
            }
            
            detailSection.innerHTML = `
                <div class="dashboard-header">
                    <button class="btn btn-secondary" onclick="showSection('rfps')" style="margin-bottom: 1rem;">‚Üê Back to RFPs</button>
                    <h1 class="dashboard-title">${rfp.title}</h1>
                    <p class="dashboard-subtitle">${rfp.client}</p>
                </div>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem;">
                    <!-- Left Column -->
                    <div>
                        <!-- Project Overview -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Project Overview</h2>
                            <p style="line-height: 1.6; margin-bottom: 1rem;">${rfp.description}</p>
                            
                            <div style="background: #fef3c7; padding: 1rem; border-radius: 6px; border-left: 4px solid #f59e0b; margin-bottom: 1rem;">
                                <div style="font-weight: 600; margin-bottom: 0.5rem;">‚ö†Ô∏è Important</div>
                                <div>Deadline: ${rfp.deadline}</div>
                            </div>
                        </div>
                        
                        <!-- Site Photos -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Site Photos</h2>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                ${rfpId === 'RFP-2024-001' ? `
                                    <div style="position: relative; border-radius: 8px; overflow: hidden; background: #f3f4f6; height: 150px; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="alert('View full size image')">
                                        <div style="text-align: center;">
                                            <div style="font-size: 2rem;">üè¢</div>
                                            <div style="font-size: 0.875rem; color: #6b7280;">Building Exterior</div>
                                        </div>
                                    </div>
                                    <div style="position: relative; border-radius: 8px; overflow: hidden; background: #f3f4f6; height: 150px; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="alert('View full size image')">
                                        <div style="text-align: center;">
                                            <div style="font-size: 2rem;">‚ùÑÔ∏è</div>
                                            <div style="font-size: 0.875rem; color: #6b7280;">HVAC Unit - Rooftop</div>
                                        </div>
                                    </div>
                                    <div style="position: relative; border-radius: 8px; overflow: hidden; background: #f3f4f6; height: 150px; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="alert('View full size image')">
                                        <div style="text-align: center;">
                                            <div style="font-size: 2rem;">üîß</div>
                                            <div style="font-size: 0.875rem; color: #6b7280;">Mechanical Room</div>
                                        </div>
                                    </div>
                                    <div style="position: relative; border-radius: 8px; overflow: hidden; background: #f3f4f6; height: 150px; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="alert('View full size image')">
                                        <div style="text-align: center;">
                                            <div style="font-size: 2rem;">üìä</div>
                                            <div style="font-size: 0.875rem; color: #6b7280;">Control Panel</div>
                                        </div>
                                    </div>
                                ` : `
                                    <div style="position: relative; border-radius: 8px; overflow: hidden; background: #f3f4f6; height: 150px; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="alert('View full size image')">
                                        <div style="text-align: center;">
                                            <div style="font-size: 2rem;">‚ö°</div>
                                            <div style="font-size: 0.875rem; color: #6b7280;">Current Panel - 200A</div>
                                        </div>
                                    </div>
                                    <div style="position: relative; border-radius: 8px; overflow: hidden; background: #f3f4f6; height: 150px; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="alert('View full size image')">
                                        <div style="text-align: center;">
                                            <div style="font-size: 2rem;">üìç</div>
                                            <div style="font-size: 0.875rem; color: #6b7280;">Panel Location</div>
                                        </div>
                                    </div>
                                    <div style="position: relative; border-radius: 8px; overflow: hidden; background: #f3f4f6; height: 150px; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="alert('View full size image')">
                                        <div style="text-align: center;">
                                            <div style="font-size: 2rem;">üöó</div>
                                            <div style="font-size: 0.875rem; color: #6b7280;">EV Charging Area</div>
                                        </div>
                                    </div>
                                    <div style="position: relative; border-radius: 8px; overflow: hidden; background: #f3f4f6; height: 150px; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="alert('View full size image')">
                                        <div style="text-align: center;">
                                            <div style="font-size: 2rem;">üíª</div>
                                            <div style="font-size: 0.875rem; color: #6b7280;">Server Room</div>
                                        </div>
                                    </div>
                                `}
                            </div>
                            <div style="margin-top: 1rem; padding: 0.75rem; background: #f9fafb; border-radius: 6px;">
                                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem;">üì∏ Click any image to view full size</p>
                                <button class="btn btn-secondary" style="font-size: 0.875rem;" onclick="alert('Downloading all photos as ZIP file...')">
                                    ‚¨áÔ∏è Download All Photos
                                </button>
                            </div>
                        </div>
                        
                        <!-- Scope of Work -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Scope of Work</h2>
                            <ul style="list-style: none; padding: 0;">
                                ${rfp.scope.map(item => `
                                    <li style="display: flex; align-items: start; gap: 0.5rem; margin-bottom: 0.75rem;">
                                        <span style="color: #10b981; font-weight: 600;">‚úì</span>
                                        <span>${item}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        
                        <!-- Requirements -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Requirements</h2>
                            <ul style="list-style: none; padding: 0;">
                                ${rfp.requirements.map(req => `
                                    <li style="display: flex; align-items: start; gap: 0.5rem; margin-bottom: 0.75rem;">
                                        <span style="color: #3b82f6; font-weight: 600;">‚Ä¢</span>
                                        <span>${req}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        
                        <!-- Documents & Blueprints -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Documents & Blueprints</h2>
                            <div style="display: grid; gap: 0.75rem;">
                                ${rfpId === 'RFP-2024-001' ? `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: #f9fafb; border-radius: 6px; border: 1px solid #e5e7eb;">
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <span style="font-size: 1.5rem;">üìÑ</span>
                                            <div>
                                                <div style="font-weight: 500;">HVAC System Specifications.pdf</div>
                                                <div style="font-size: 0.75rem; color: #6b7280;">2.3 MB</div>
                                            </div>
                                        </div>
                                        <button class="btn btn-secondary" style="font-size: 0.875rem; padding: 0.375rem 0.75rem;">Download</button>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: #f9fafb; border-radius: 6px; border: 1px solid #e5e7eb;">
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <span style="font-size: 1.5rem;">üìê</span>
                                            <div>
                                                <div style="font-weight: 500;">Building Floor Plans.dwg</div>
                                                <div style="font-size: 0.75rem; color: #6b7280;">8.7 MB</div>
                                            </div>
                                        </div>
                                        <button class="btn btn-secondary" style="font-size: 0.875rem; padding: 0.375rem 0.75rem;">Download</button>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: #f9fafb; border-radius: 6px; border: 1px solid #e5e7eb;">
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <span style="font-size: 1.5rem;">üìä</span>
                                            <div>
                                                <div style="font-weight: 500;">Energy Usage Report.xlsx</div>
                                                <div style="font-size: 0.75rem; color: #6b7280;">456 KB</div>
                                            </div>
                                        </div>
                                        <button class="btn btn-secondary" style="font-size: 0.875rem; padding: 0.375rem 0.75rem;">Download</button>
                                    </div>
                                ` : `
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: #f9fafb; border-radius: 6px; border: 1px solid #e5e7eb;">
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <span style="font-size: 1.5rem;">üìÑ</span>
                                            <div>
                                                <div style="font-weight: 500;">Electrical Load Calculations.pdf</div>
                                                <div style="font-size: 0.75rem; color: #6b7280;">1.8 MB</div>
                                            </div>
                                        </div>
                                        <button class="btn btn-secondary" style="font-size: 0.875rem; padding: 0.375rem 0.75rem;">Download</button>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: #f9fafb; border-radius: 6px; border: 1px solid #e5e7eb;">
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <span style="font-size: 1.5rem;">üìê</span>
                                            <div>
                                                <div style="font-weight: 500;">Single Line Diagram.dwg</div>
                                                <div style="font-size: 0.75rem; color: #6b7280;">3.2 MB</div>
                                            </div>
                                        </div>
                                        <button class="btn btn-secondary" style="font-size: 0.875rem; padding: 0.375rem 0.75rem;">Download</button>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: #f9fafb; border-radius: 6px; border: 1px solid #e5e7eb;">
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <span style="font-size: 1.5rem;">üìã</span>
                                            <div>
                                                <div style="font-weight: 500;">EV Charger Specifications.pdf</div>
                                                <div style="font-size: 0.75rem; color: #6b7280;">892 KB</div>
                                            </div>
                                        </div>
                                        <button class="btn btn-secondary" style="font-size: 0.875rem; padding: 0.375rem 0.75rem;">Download</button>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: #f9fafb; border-radius: 6px; border: 1px solid #e5e7eb;">
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <span style="font-size: 1.5rem;">üèóÔ∏è</span>
                                            <div>
                                                <div style="font-weight: 500;">Site Access Requirements.pdf</div>
                                                <div style="font-size: 0.75rem; color: #6b7280;">234 KB</div>
                                            </div>
                                        </div>
                                        <button class="btn btn-secondary" style="font-size: 0.875rem; padding: 0.375rem 0.75rem;">Download</button>
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column -->
                    <div>
                        <!-- Budget & Timeline -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Budget & Timeline</h2>
                            <div style="display: grid; gap: 1rem;">
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Budget Range</div>
                                    <div style="font-size: 1.5rem; font-weight: 700; color: #10b981;">${rfp.budget}</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Submission Deadline</div>
                                    <div style="font-weight: 600; color: #ef4444;">${rfp.deadline}</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Project Timeline</div>
                                    <div>${rfp.timeline}</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Location -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Location</h2>
                            <div style="margin-bottom: 1rem;">
                                <div style="font-weight: 500;">${rfp.client}</div>
                                <div style="color: #6b7280;">${rfp.location}</div>
                            </div>
                            <button class="btn btn-secondary" style="width: 100%;">üìç View on Map</button>
                        </div>
                        
                        <!-- Contact Information -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Contact Information</h2>
                            <div style="display: grid; gap: 1rem;">
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Contact Person</div>
                                    <div style="font-weight: 500;">${rfp.contact}</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Phone</div>
                                    <div style="color: #3b82f6; cursor: pointer;">${rfp.phone}</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Email</div>
                                    <div style="color: #3b82f6; cursor: pointer;">${rfp.email}</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Actions -->
                        <div class="section-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                            <h2 style="font-size: 1.25rem; margin-bottom: 1rem;">Ready to Bid?</h2>
                            <button class="btn" style="background: white; color: #10b981; width: 100%; margin-bottom: 0.75rem;" onclick="openBidModal('${rfpId}')">
                                Submit Your Bid
                            </button>
                            <button class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white; width: 100%;">
                                Ask a Question
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            detailSection.style.display = 'block';
        }
        
        function viewInvoiceDetails(invoiceId) {
            const invoiceData = {
                'INV-2024-0145': {
                    invoiceNumber: 'INV-2024-0145',
                    workOrder: 'WO #998',
                    service: 'Emergency Plumbing Repair',
                    client: 'OpenWrench Facilities',
                    location: '456 Oak Street, Building B',
                    dateIssued: 'January 24, 2024',
                    dueDate: 'February 23, 2024',
                    datePaid: 'January 28, 2024',
                    status: 'Paid',
                    laborHours: 4.5,
                    laborRate: 150,
                    laborTotal: 675,
                    materials: [
                        { item: 'Pipe Fittings', qty: 12, price: 25, total: 300 },
                        { item: 'PVC Piping 2"', qty: 20, price: 15, total: 300 },
                        { item: 'Valves', qty: 3, price: 85, total: 255 },
                        { item: 'Sealant', qty: 2, price: 35, total: 70 }
                    ],
                    emergencyFee: 500,
                    afterHoursFee: 400,
                    subtotal: 2500,
                    tax: 200,
                    total: 3500,
                    paymentMethod: 'ACH Transfer',
                    paymentReference: 'REF-2024-8934'
                },
                'INV-2024-0144': {
                    invoiceNumber: 'INV-2024-0144',
                    workOrder: 'WO #997',
                    service: 'HVAC System Maintenance',
                    client: 'Tech Startup Hub',
                    location: '789 Tech Blvd, Building A',
                    dateIssued: 'January 22, 2024',
                    dueDate: 'February 21, 2024',
                    datePaid: 'January 25, 2024',
                    status: 'Paid',
                    laborHours: 8,
                    laborRate: 150,
                    laborTotal: 1200,
                    materials: [
                        { item: 'HVAC Filters (20x25x4)', qty: 6, price: 45, total: 270 },
                        { item: 'Refrigerant R410A', qty: 10, price: 85, total: 850 },
                        { item: 'Belt Set', qty: 2, price: 125, total: 250 },
                        { item: 'Cleaning Supplies', qty: 1, price: 80, total: 80 }
                    ],
                    preventiveMaintenance: 1200,
                    diagnosticFee: 350,
                    subtotal: 4200,
                    tax: 336,
                    total: 5200,
                    paymentMethod: 'Credit Card',
                    paymentReference: 'CC-2024-1122'
                },
                'INV-2024-0143': {
                    invoiceNumber: 'INV-2024-0143',
                    workOrder: 'WO #996',
                    service: 'Electrical Panel Inspection',
                    client: 'Downtown Office Complex',
                    location: '123 Main St, Suite 200',
                    dateIssued: 'January 20, 2024',
                    dueDate: 'February 19, 2024',
                    datePaid: null,
                    status: 'Processing',
                    laborHours: 3,
                    laborRate: 150,
                    laborTotal: 450,
                    materials: [
                        { item: 'Circuit Breakers 20A', qty: 4, price: 35, total: 140 },
                        { item: 'Wire Nuts', qty: 50, price: 0.5, total: 25 },
                        { item: 'Electrical Tape', qty: 3, price: 8, total: 24 },
                        { item: 'Labels', qty: 1, price: 15, total: 15 }
                    ],
                    inspectionFee: 650,
                    reportGeneration: 200,
                    subtotal: 1504,
                    tax: 120,
                    total: 1800,
                    paymentMethod: 'Pending',
                    paymentReference: null
                }
            };
            
            const invoice = invoiceData[invoiceId];
            if (!invoice) {
                alert('Invoice not found');
                return;
            }
            
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Create or update invoice detail section
            let detailSection = document.getElementById('invoice-detail-section');
            if (!detailSection) {
                detailSection = document.createElement('div');
                detailSection.id = 'invoice-detail-section';
                detailSection.className = 'content-section';
                document.querySelector('.main-content').appendChild(detailSection);
            }
            
            const statusColor = invoice.status === 'Paid' ? '#10b981' : invoice.status === 'Processing' ? '#f59e0b' : '#ef4444';
            const statusBg = invoice.status === 'Paid' ? '#d1fae5' : invoice.status === 'Processing' ? '#fed7aa' : '#fee2e2';
            
            detailSection.innerHTML = `
                <div class="dashboard-header">
                    <button class="btn btn-secondary" onclick="showSection('payments')" style="margin-bottom: 1rem;">‚Üê Back to Payments</button>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h1 class="dashboard-title">Invoice ${invoice.invoiceNumber}</h1>
                            <p class="dashboard-subtitle">${invoice.service} - ${invoice.workOrder}</p>
                        </div>
                        <div style="text-align: right;">
                            <span style="background: ${statusBg}; color: ${invoice.status === 'Paid' ? '#065f46' : '#7c2d12'}; padding: 0.5rem 1rem; border-radius: 20px; font-weight: 600;">
                                ${invoice.status}
                            </span>
                            ${invoice.datePaid ? `<div style="font-size: 0.875rem; color: #6b7280; margin-top: 0.5rem;">Paid on ${invoice.datePaid}</div>` : ''}
                        </div>
                    </div>
                </div>
                
                <!-- Invoice Actions -->
                <div class="section-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h2 style="font-size: 1.25rem;">Invoice Actions</h2>
                        <div style="display: flex; gap: 1rem;">
                            <button class="btn" style="background: white; color: #10b981;">
                                üìÑ Download PDF
                            </button>
                            <button class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid white;">
                                üñ®Ô∏è Print
                            </button>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem;">
                    <!-- Left Column - Invoice Details -->
                    <div>
                        <!-- Invoice Header -->
                        <div class="section-card">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 2rem;">
                                <div>
                                    <div style="font-size: 2rem; font-weight: 700; color: #10b981;">HEY SPRUCE</div>
                                    <div style="color: #6b7280;">Johnson Electric</div>
                                    <div style="color: #6b7280;">License #EL-2024-789</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 1.5rem; font-weight: 700;">INVOICE</div>
                                    <div style="color: #6b7280;">${invoice.invoiceNumber}</div>
                                    <div style="color: #6b7280;">Date: ${invoice.dateIssued}</div>
                                </div>
                            </div>
                            
                            <!-- Bill To -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Bill To:</div>
                                    <div style="color: #4b5563;">
                                        ${invoice.client}<br>
                                        ${invoice.location}<br>
                                        Accounts Payable
                                    </div>
                                </div>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Service Location:</div>
                                    <div style="color: #4b5563;">
                                        ${invoice.location}<br>
                                        Work Order: ${invoice.workOrder}<br>
                                        Service: ${invoice.service}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Labor Charges -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Labor Charges</h2>
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="border-bottom: 2px solid #e5e7eb;">
                                        <th style="text-align: left; padding: 0.5rem;">Description</th>
                                        <th style="text-align: center; padding: 0.5rem;">Hours</th>
                                        <th style="text-align: right; padding: 0.5rem;">Rate</th>
                                        <th style="text-align: right; padding: 0.5rem;">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="border-bottom: 1px solid #f3f4f6;">
                                        <td style="padding: 0.5rem;">Standard Labor</td>
                                        <td style="text-align: center; padding: 0.5rem;">${invoice.laborHours}</td>
                                        <td style="text-align: right; padding: 0.5rem;">$${invoice.laborRate}/hr</td>
                                        <td style="text-align: right; padding: 0.5rem; font-weight: 600;">$${invoice.laborTotal.toFixed(2)}</td>
                                    </tr>
                                    ${invoice.emergencyFee ? `
                                        <tr style="border-bottom: 1px solid #f3f4f6;">
                                            <td style="padding: 0.5rem;">Emergency Service Fee</td>
                                            <td style="text-align: center; padding: 0.5rem;">-</td>
                                            <td style="text-align: right; padding: 0.5rem;">-</td>
                                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">$${invoice.emergencyFee.toFixed(2)}</td>
                                        </tr>
                                    ` : ''}
                                    ${invoice.afterHoursFee ? `
                                        <tr style="border-bottom: 1px solid #f3f4f6;">
                                            <td style="padding: 0.5rem;">After Hours Fee</td>
                                            <td style="text-align: center; padding: 0.5rem;">-</td>
                                            <td style="text-align: right; padding: 0.5rem;">-</td>
                                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">$${invoice.afterHoursFee.toFixed(2)}</td>
                                        </tr>
                                    ` : ''}
                                    ${invoice.preventiveMaintenance ? `
                                        <tr style="border-bottom: 1px solid #f3f4f6;">
                                            <td style="padding: 0.5rem;">Preventive Maintenance</td>
                                            <td style="text-align: center; padding: 0.5rem;">-</td>
                                            <td style="text-align: right; padding: 0.5rem;">-</td>
                                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">$${invoice.preventiveMaintenance.toFixed(2)}</td>
                                        </tr>
                                    ` : ''}
                                    ${invoice.diagnosticFee ? `
                                        <tr style="border-bottom: 1px solid #f3f4f6;">
                                            <td style="padding: 0.5rem;">Diagnostic Fee</td>
                                            <td style="text-align: center; padding: 0.5rem;">-</td>
                                            <td style="text-align: right; padding: 0.5rem;">-</td>
                                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">$${invoice.diagnosticFee.toFixed(2)}</td>
                                        </tr>
                                    ` : ''}
                                    ${invoice.inspectionFee ? `
                                        <tr style="border-bottom: 1px solid #f3f4f6;">
                                            <td style="padding: 0.5rem;">Inspection Fee</td>
                                            <td style="text-align: center; padding: 0.5rem;">-</td>
                                            <td style="text-align: right; padding: 0.5rem;">-</td>
                                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">$${invoice.inspectionFee.toFixed(2)}</td>
                                        </tr>
                                    ` : ''}
                                    ${invoice.reportGeneration ? `
                                        <tr style="border-bottom: 1px solid #f3f4f6;">
                                            <td style="padding: 0.5rem;">Report Generation</td>
                                            <td style="text-align: center; padding: 0.5rem;">-</td>
                                            <td style="text-align: right; padding: 0.5rem;">-</td>
                                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">$${invoice.reportGeneration.toFixed(2)}</td>
                                        </tr>
                                    ` : ''}
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Materials -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Materials & Parts</h2>
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="border-bottom: 2px solid #e5e7eb;">
                                        <th style="text-align: left; padding: 0.5rem;">Item</th>
                                        <th style="text-align: center; padding: 0.5rem;">Qty</th>
                                        <th style="text-align: right; padding: 0.5rem;">Unit Price</th>
                                        <th style="text-align: right; padding: 0.5rem;">Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${invoice.materials.map(item => `
                                        <tr style="border-bottom: 1px solid #f3f4f6;">
                                            <td style="padding: 0.5rem;">${item.item}</td>
                                            <td style="text-align: center; padding: 0.5rem;">${item.qty}</td>
                                            <td style="text-align: right; padding: 0.5rem;">$${item.price.toFixed(2)}</td>
                                            <td style="text-align: right; padding: 0.5rem; font-weight: 600;">$${item.total.toFixed(2)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Right Column - Summary -->
                    <div>
                        <!-- Invoice Summary -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Invoice Summary</h2>
                            <div style="display: grid; gap: 0.75rem;">
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #f3f4f6;">
                                    <span>Subtotal</span>
                                    <span style="font-weight: 600;">$${invoice.subtotal.toFixed(2)}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #f3f4f6;">
                                    <span>Tax (8%)</span>
                                    <span style="font-weight: 600;">$${invoice.tax.toFixed(2)}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 1rem 0; border-top: 2px solid #e5e7eb;">
                                    <span style="font-size: 1.25rem; font-weight: 600;">Total Due</span>
                                    <span style="font-size: 1.5rem; font-weight: 700; color: #10b981;">$${invoice.total.toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Payment Information -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Payment Information</h2>
                            <div style="display: grid; gap: 1rem;">
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Due Date</div>
                                    <div style="font-weight: 600;">${invoice.dueDate}</div>
                                </div>
                                <div>
                                    <div style="font-size: 0.875rem; color: #6b7280;">Payment Method</div>
                                    <div style="font-weight: 600;">${invoice.paymentMethod}</div>
                                </div>
                                ${invoice.paymentReference ? `
                                    <div>
                                        <div style="font-size: 0.875rem; color: #6b7280;">Payment Reference</div>
                                        <div style="font-weight: 600;">${invoice.paymentReference}</div>
                                    </div>
                                ` : ''}
                                ${invoice.datePaid ? `
                                    <div>
                                        <div style="font-size: 0.875rem; color: #6b7280;">Payment Date</div>
                                        <div style="font-weight: 600; color: #10b981;">${invoice.datePaid}</div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- Terms & Conditions -->
                        <div class="section-card">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1rem;">Terms & Conditions</h2>
                            <div style="font-size: 0.875rem; color: #6b7280; line-height: 1.6;">
                                <p style="margin-bottom: 0.5rem;">‚Ä¢ Payment is due within 30 days of invoice date</p>
                                <p style="margin-bottom: 0.5rem;">‚Ä¢ Late payments subject to 1.5% monthly interest</p>
                                <p style="margin-bottom: 0.5rem;">‚Ä¢ All work guaranteed for 90 days</p>
                                <p>‚Ä¢ Materials warranty as per manufacturer</p>
                            </div>
                        </div>
                        
                        <!-- Contact Support -->
                        <div class="section-card" style="background: #f9fafb;">
                            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.75rem;">Questions about this invoice?</h3>
                            <button class="btn btn-secondary" style="width: 100%; margin-bottom: 0.5rem;">üìû Call Billing Support</button>
                            <button class="btn btn-secondary" style="width: 100%;">‚úâÔ∏è Email Accounts</button>
                        </div>
                    </div>
                </div>
            `;
            
            detailSection.style.display = 'block';
        }

        // ENHANCEMENTS: Table Sorting, Form Validation, PWA
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                initializeEnhancements();
            }, 500);
        });

        function initializeEnhancements() {
            initializeTableSorting();
            initializeFormValidation();
            initializePWA();
            showToast('‚ú® Enhanced features active', 'success', 4000);
        }

        function initializeTableSorting() {
            document.querySelectorAll('table th').forEach((header, index) => {
                if (header.textContent.trim()) {
                    header.style.cursor = 'pointer';
                    header.style.userSelect = 'none';
                    header.innerHTML += ' <span style="font-size:0.75rem;color:#9ca3af;">‚Üï</span>';
                    
                    header.addEventListener('click', () => {
                        const table = header.closest('table');
                        const tbody = table.querySelector('tbody');
                        if (!tbody) return;
                        
                        const rows = Array.from(tbody.querySelectorAll('tr'));
                        const isAsc = header.dataset.sort !== 'asc';
                        header.dataset.sort = isAsc ? 'asc' : 'desc';
                        
                        // Reset other headers
                        table.querySelectorAll('th').forEach(h => {
                            if (h !== header) h.dataset.sort = '';
                        });
                        
                        rows.sort((a, b) => {
                            const aText = a.cells[index]?.textContent.trim() || '';
                            const bText = b.cells[index]?.textContent.trim() || '';
                            
                            if (isAsc) {
                                return aText.localeCompare(bText, undefined, {numeric: true});
                            } else {
                                return bText.localeCompare(aText, undefined, {numeric: true});
                            }
                        });
                        
                        rows.forEach(row => tbody.appendChild(row));
                        showToast('Table sorted', 'info', 2000);
                    });
                }
            });
        }

        function initializeFormValidation() {
            document.querySelectorAll('input, select, textarea').forEach(field => {
                field.addEventListener('blur', () => {
                    if (field.hasAttribute('required') && !field.value.trim()) {
                        field.style.borderColor = '#ef4444';
                        showToast('Required field cannot be empty', 'error', 3000);
                    } else {
                        field.style.borderColor = '';
                    }
                });
            });
        }

        function initializePWA() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js').catch(() => {});
            }
        }

        function showToast(message, type = 'info', duration = 4000) {
            const container = document.getElementById('toast-container') || (() => {
                const cont = document.createElement('div');
                cont.id = 'toast-container';
                cont.style.cssText = 'position:fixed;bottom:1rem;right:1rem;z-index:10000;';
                document.body.appendChild(cont);
                return cont;
            })();
            
            const toast = document.createElement('div');
            toast.style.cssText = `
                background:white;border-radius:8px;padding:1rem 1.5rem;margin-bottom:0.5rem;
                box-shadow:0 4px 6px -1px rgba(0,0,0,0.1);display:flex;align-items:center;gap:0.75rem;
                border-left:4px solid ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                animation:slideIn 0.3s ease;max-width:300px;
            `;
            
            const icons = {success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è'};
            toast.innerHTML = `${icons[type] || icons.info} ${message}`;
            
            container.appendChild(toast);
            setTimeout(() => toast.remove(), duration);
        }
        
        // Subcontractor Analytics JavaScript Functions
        let subcontractorAnalyticsCharts = {};
        let currentSubcontractorAnalyticsPeriod = '30d';
        
        async function initializeSubcontractorAnalytics() {
            try {
                showSubcontractorAnalyticsLoading(true);
                await loadSubcontractorAnalyticsData(currentSubcontractorAnalyticsPeriod);
                showSubcontractorAnalyticsLoading(false);
            } catch (error) {
                console.error('Failed to initialize subcontractor analytics:', error);
                showSubcontractorAnalyticsError('Failed to load analytics data');
            }
        }
        
        async function loadSubcontractorAnalyticsData(period) {
            const token = localStorage.getItem('supabase_token');
            if (!token) {
                throw new Error('Authentication required');
            }
            
            try {
                // Load different types of analytics data for subcontractors
                const [financial, performance, workOrders] = await Promise.all([
                    fetch(`/api/analytics?type=financial&period=${period}`, {
                        headers: { Authorization: `Bearer ${token}` }
                    }).then(r => r.json()),
                    fetch(`/api/analytics?type=performance&period=${period}`, {
                        headers: { Authorization: `Bearer ${token}` }
                    }).then(r => r.json()),
                    fetch(`/api/analytics?type=work-orders&period=${period}`, {
                        headers: { Authorization: `Bearer ${token}` }
                    }).then(r => r.json())
                ]);
                
                // Update KPI cards
                updateSubcontractorKPICards(financial.data, performance.data, workOrders.data);
                
                // Create or update charts
                createSubcontractorRevenueChart(financial.data);
                createSubcontractorStatusChart(workOrders.data);
                createSubcontractorWeeklyChart(workOrders.data);
                
                // Update performance metrics table
                updateSubcontractorPerformanceMetrics(performance.data);
                
            } catch (error) {
                console.error('Subcontractor Analytics API Error:', error);
                throw error;
            }
        }
        
        function updateSubcontractorKPICards(financial, performance, workOrders) {
            const kpiHTML = `
                <div class="metric-card">
                    <div class="metric-label">Total Earnings</div>
                    <div class="metric-value">$${(financial.completed_spend || 0).toLocaleString()}</div>
                    <div class="metric-change positive">‚Üë From ${workOrders.total || 0} jobs</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-label">Jobs Completed</div>
                    <div class="metric-value">${workOrders.status_distribution?.completed || 0}</div>
                    <div class="metric-change">Out of ${workOrders.total || 0} total</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-label">Average Rating</div>
                    <div class="metric-value">${performance.average_rating || 0}‚òÖ</div>
                    <div class="metric-change positive">${performance.customer_satisfaction || 0}% satisfaction</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-label">On-Time Rate</div>
                    <div class="metric-value">${performance.on_time_rate || 0}%</div>
                    <div class="metric-change positive">Above average</div>
                </div>
            `;
            document.getElementById('subcontractorKPICards').innerHTML = kpiHTML;
        }
        
        function createSubcontractorRevenueChart(data) {
            const ctx = document.getElementById('subcontractorRevenueChart').getContext('2d');
            
            if (subcontractorAnalyticsCharts.revenue) {
                subcontractorAnalyticsCharts.revenue.destroy();
            }
            
            const monthlyData = data.monthly_spend || [];
            const labels = monthlyData.map(d => new Date(d.month + '-01').toLocaleDateString('en-US', { month: 'short' }));
            const amounts = monthlyData.map(d => d.amount);
            
            subcontractorAnalyticsCharts.revenue = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Earnings',
                        data: amounts,
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function createSubcontractorStatusChart(data) {
            const ctx = document.getElementById('subcontractorStatusChart').getContext('2d');
            
            if (subcontractorAnalyticsCharts.status) {
                subcontractorAnalyticsCharts.status.destroy();
            }
            
            const statusData = data.status_distribution || {};
            
            subcontractorAnalyticsCharts.status = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Pending', 'In Progress', 'Completed', 'Cancelled'],
                    datasets: [{
                        data: [
                            statusData.pending || 0,
                            statusData.in_progress || 0,
                            statusData.completed || 0,
                            statusData.cancelled || 0
                        ],
                        backgroundColor: [
                            '#f59e0b',
                            '#3b82f6',
                            '#10b981',
                            '#ef4444'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        function createSubcontractorWeeklyChart(data) {
            const ctx = document.getElementById('subcontractorWeeklyChart').getContext('2d');
            
            if (subcontractorAnalyticsCharts.weekly) {
                subcontractorAnalyticsCharts.weekly.destroy();
            }
            
            // Generate weekly data from daily counts
            const weeklyData = [];
            const dailyCounts = data.daily_counts || [];
            
            // Group by weeks
            let weekStart = 0;
            while (weekStart < dailyCounts.length) {
                const weekEnd = Math.min(weekStart + 7, dailyCounts.length);
                const weekSlice = dailyCounts.slice(weekStart, weekEnd);
                const weekTotal = weekSlice.reduce((sum, day) => sum + day.completed, 0);
                weeklyData.push(weekTotal);
                weekStart = weekEnd;
            }
            
            const labels = weeklyData.map((_, i) => `Week ${i + 1}`);
            
            subcontractorAnalyticsCharts.weekly = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Jobs Completed',
                        data: weeklyData,
                        backgroundColor: '#f59e0b',
                        borderColor: '#d97706',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        function updateSubcontractorPerformanceMetrics(data) {
            const metricsHTML = `
                <div style="padding: 1.5rem;">
                    <div style="margin-bottom: 1.5rem; padding: 1rem; background: var(--gray-50); border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 600;">Completion Rate</span>
                            <span style="font-size: 1.25rem; font-weight: 700; color: var(--success);">${data.completion_rate || 0}%</span>
                        </div>
                    </div>
                    <div style="margin-bottom: 1.5rem; padding: 1rem; background: var(--gray-50); border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 600;">On-Time Rate</span>
                            <span style="font-size: 1.25rem; font-weight: 700; color: var(--success);">${data.on_time_rate || 0}%</span>
                        </div>
                    </div>
                    <div style="margin-bottom: 1.5rem; padding: 1rem; background: var(--gray-50); border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 600;">Customer Rating</span>
                            <span style="font-size: 1.25rem; font-weight: 700; color: var(--warning);">${data.average_rating || 0}‚òÖ</span>
                        </div>
                    </div>
                    <div style="padding: 1rem; background: var(--gray-50); border-radius: 6px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: 600;">Total Jobs</span>
                            <span style="font-size: 1.25rem; font-weight: 700; color: var(--primary);">${data.total_jobs || 0}</span>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('subcontractorPerformanceMetrics').innerHTML = metricsHTML;
        }
        
        function showSubcontractorAnalyticsLoading(show) {
            document.getElementById('subcontractorAnalyticsLoading').style.display = show ? 'flex' : 'none';
            document.getElementById('subcontractorAnalyticsContent').style.display = show ? 'none' : 'block';
        }
        
        function showSubcontractorAnalyticsError(message) {
            document.getElementById('subcontractorAnalyticsLoading').innerHTML = `
                <div style="text-align: center; color: var(--danger);">
                    <div style="font-size: 1.5rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                    <div>${message}</div>
                    <button class="btn btn-secondary" onclick="initializeSubcontractorAnalytics()" style="margin-top: 1rem;">
                        Retry
                    </button>
                </div>
            `;
            document.getElementById('subcontractorAnalyticsLoading').style.display = 'flex';
            document.getElementById('subcontractorAnalyticsContent').style.display = 'none';
        }
        
        async function updateSubcontractorAnalyticsPeriod(period) {
            currentSubcontractorAnalyticsPeriod = period;
            await loadSubcontractorAnalyticsData(period);
            showToast(`Analytics updated for ${period} period`, 'info');
        }
        
        function exportSubcontractorAnalytics() {
            showToast('Exporting subcontractor analytics data...', 'info');
        }
        
        // Initialize analytics when analytics section is shown
        function showSection(sectionName) {
            console.log('Showing section:', sectionName);
            
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            const sectionId = sectionName + '-section';
            const section = document.getElementById(sectionId);
            if (section) {
                section.style.display = 'block';
                
                // Initialize analytics if showing analytics section
                if (sectionName === 'analytics') {
                    setTimeout(initializeSubcontractorAnalytics, 100);
                }
            }
            
            // Update nav active state
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            if (event && event.target) {
                event.target.classList.add('active');
            }
        }
        
        // Messaging Functions
        function selectConversation(conversationId) {
            console.log('Selecting conversation:', conversationId);
            
            // Update active state
            document.querySelectorAll('.conversation-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Here you would load conversation details from backend
            // For now, just update the header
            const conversationHeaders = {
                '1': { name: 'Sarah Johnson', role: 'Hey Spruce Admin', status: 'Online' },
                '2': { name: "Mike's Plumbing Co.", role: 'Team Member', status: 'Offline' },
                '3': { name: 'Property Manager', role: 'Building A Client', status: 'Away' }
            };
            
            const header = conversationHeaders[conversationId];
            if (header) {
                const headerElement = document.querySelector('#messages-section .message-header');
                if (headerElement) {
                    headerElement.querySelector('div:first-child').textContent = header.name;
                    headerElement.querySelector('div:last-child').textContent = `${header.role} ‚Ä¢ ${header.status}`;
                }
            }
        }
        
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const messagesContainer = document.getElementById('messagesContainer');
            
            // Remove typing indicator if present
            const typingIndicator = messagesContainer.querySelector('.typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
            
            // Add sent message
            const messageHtml = `
                <div style="display: flex; justify-content: flex-end; margin-bottom: 1rem;">
                    <div style="max-width: 70%;">
                        <div style="background: var(--primary); color: white; padding: 0.75rem; border-radius: 8px;">
                            <div style="font-size: 0.875rem;">${message}</div>
                        </div>
                        <div style="font-size: 0.6rem; color: var(--gray-500); margin-top: 0.25rem; text-align: right;">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                    </div>
                </div>
            `;
            
            messagesContainer.insertAdjacentHTML('beforeend', messageHtml);
            
            // Clear input
            input.value = '';
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Simulate received message after delay
            setTimeout(() => {
                const responses = [
                    "Thanks for the quick response!",
                    "I'll check on that and get back to you.",
                    "That works perfectly for our schedule.",
                    "Let me confirm with the team."
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                
                const receivedHtml = `
                    <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                        <div style="width: 32px; height: 32px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; flex-shrink: 0;">
                            SJ
                        </div>
                        <div style="max-width: 70%;">
                            <div style="background: white; padding: 0.75rem; border-radius: 8px; box-shadow: var(--shadow-sm);">
                                <div style="font-size: 0.875rem;">${randomResponse}</div>
                            </div>
                            <div style="font-size: 0.6rem; color: var(--gray-500); margin-top: 0.25rem;">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                        </div>
                    </div>
                `;
                
                messagesContainer.insertAdjacentHTML('beforeend', receivedHtml);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 2000);
        }
        
        // View switching functions
        function switchToListView() {
            document.getElementById('listViewContainer').style.display = 'block';
            document.getElementById('calendarViewContainer').style.display = 'none';
            document.getElementById('listViewBtn').classList.remove('btn-secondary');
            document.getElementById('listViewBtn').classList.add('btn-primary');
            document.getElementById('calendarViewBtn').classList.remove('btn-primary');
            document.getElementById('calendarViewBtn').classList.add('btn-secondary');
            
            // Load list view data
            loadWorkOrdersList();
        }
        
        function switchToCalendarView() {
            document.getElementById('listViewContainer').style.display = 'none';
            document.getElementById('calendarViewContainer').style.display = 'block';
            document.getElementById('calendarViewBtn').classList.remove('btn-secondary');
            document.getElementById('calendarViewBtn').classList.add('btn-primary');
            document.getElementById('listViewBtn').classList.remove('btn-primary');
            document.getElementById('listViewBtn').classList.add('btn-secondary');
            
            // Load calendar if not already loaded
            if (typeof renderCalendar === 'function') {
                renderCalendar();
            }
        }
        
        function loadWorkOrdersList() {
            const workOrders = [
                { id: 'WO-001', title: 'Emergency Plumbing Repair', client: 'McDonald\'s - Sunset', date: '2025-09-08', time: '9:00 AM', status: 'in-progress', priority: 'high' },
                { id: 'WO-002', title: 'HVAC Maintenance', client: 'Burger King - Melrose', date: '2025-09-09', time: '10:00 AM', status: 'pending', priority: 'normal' },
                { id: 'WO-003', title: 'Electrical Inspection', client: 'Delilah LA', date: '2025-09-10', time: '2:00 PM', status: 'pending', priority: 'normal' },
                { id: 'WO-004', title: 'Kitchen Equipment Repair', client: 'McDonald\'s - Downtown', date: '2025-09-11', time: '11:00 AM', status: 'pending', priority: 'high' },
                { id: 'WO-005', title: 'Grease Trap Cleaning', client: 'Pizza Palace', date: '2025-09-12', time: '8:00 AM', status: 'completed', priority: 'normal' }
            ];
            
            const listContainer = document.getElementById('workOrdersList');
            listContainer.innerHTML = workOrders.map(wo => `
                <div style="padding: 1rem; border: 1px solid var(--gray-200); border-radius: 8px; margin-bottom: 0.75rem; cursor: pointer; transition: all 0.2s;" onclick="viewWorkOrder('${wo.id}')" onmouseover="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='none'">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <h3 style="font-weight: 600; margin: 0;">${wo.title}</h3>
                                <span class="badge badge-${wo.priority}" style="font-size: 0.625rem; padding: 0.125rem 0.5rem;">${wo.priority.toUpperCase()}</span>
                                <span class="badge badge-${wo.status}" style="font-size: 0.625rem; padding: 0.125rem 0.5rem;">${wo.status.replace('-', ' ').toUpperCase()}</span>
                            </div>
                            <div style="display: flex; gap: 1rem; font-size: 0.875rem; color: var(--gray-600);">
                                <span>üìç ${wo.client}</span>
                                <span>üìÖ ${wo.date}</span>
                                <span>üïê ${wo.time}</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-sm btn-secondary" onclick="event.stopPropagation(); viewDetails('${wo.id}')">View Details</button>
                            ${wo.status === 'pending' ? `<button class="btn btn-sm btn-primary" onclick="event.stopPropagation(); acceptJob('${wo.id}')">Accept Job</button>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function filterWorkOrders(status) {
            // Filter work orders based on status
            loadWorkOrdersList(); // For now, just reload all
            if (status !== 'all') {
                const items = document.querySelectorAll('#workOrdersList > div');
                items.forEach(item => {
                    const hasStatus = item.innerHTML.includes(`badge-${status}`);
                    item.style.display = hasStatus ? 'block' : 'none';
                });
            }
        }
        
        // Export global functions
        window.initializeSubcontractorAnalytics = initializeSubcontractorAnalytics;
        window.updateSubcontractorAnalyticsPeriod = updateSubcontractorAnalyticsPeriod;
        window.exportSubcontractorAnalytics = exportSubcontractorAnalytics;
        window.showSection = showSection;
        
        // Subcontractor Global Search Functions
        let subcontractorSearchTimeout;
        let subcontractorSearchData = {
            rfps: [
                { id: 'RFP-2024-001', title: 'Kitchen Equipment Replacement', client: 'Pizza Palace', type: 'rfp' },
                { id: 'RFP-2024-002', title: 'HVAC System Upgrade', client: 'Burger King', type: 'rfp' },
                { id: 'RFP-2024-003', title: 'Deep Cleaning Service', client: 'Fine Dining Co', type: 'rfp' }
            ],
            workOrders: [
                { id: 'WO-2024-101', title: 'Emergency HVAC Repair', client: 'McDonald\'s Downtown', type: 'work-order' },
                { id: 'WO-2024-102', title: 'Kitchen Deep Clean', client: 'Tasty Burgers', type: 'work-order' },
                { id: 'WO-2024-103', title: 'Electrical Maintenance', client: 'Coffee House', type: 'work-order' }
            ],
            clients: [
                { id: 'client-001', title: 'Pizza Palace', location: 'Downtown Seattle', type: 'client' },
                { id: 'client-002', title: 'Burger King', location: 'Bellevue Mall', type: 'client' },
                { id: 'client-003', title: 'Fine Dining Co', location: 'Capitol Hill', type: 'client' }
            ]
        };
        
        function handleSubcontractorGlobalSearch(query) {
            clearTimeout(subcontractorSearchTimeout);
            
            if (query.length < 2) {
                hideSubcontractorSearchResults();
                return;
            }
            
            subcontractorSearchTimeout = setTimeout(() => {
                performSubcontractorSearch(query);
            }, 300);
        }
        
        function performSubcontractorSearch(query) {
            const results = [];
            const lowerQuery = query.toLowerCase();
            
            // Search RFPs
            subcontractorSearchData.rfps.forEach(rfp => {
                if (rfp.title.toLowerCase().includes(lowerQuery) || 
                    rfp.client.toLowerCase().includes(lowerQuery) ||
                    rfp.id.toLowerCase().includes(lowerQuery)) {
                    results.push(rfp);
                }
            });
            
            // Search work orders
            subcontractorSearchData.workOrders.forEach(wo => {
                if (wo.title.toLowerCase().includes(lowerQuery) || 
                    wo.client.toLowerCase().includes(lowerQuery) ||
                    wo.id.toLowerCase().includes(lowerQuery)) {
                    results.push(wo);
                }
            });
            
            // Search clients
            subcontractorSearchData.clients.forEach(client => {
                if (client.title.toLowerCase().includes(lowerQuery) || 
                    client.location.toLowerCase().includes(lowerQuery)) {
                    results.push(client);
                }
            });
            
            displaySubcontractorSearchResults(results, query);
        }
        
        function displaySubcontractorSearchResults(results, query) {
            const resultsContainer = document.getElementById('subcontractorSearchResults');
            
            if (results.length === 0) {
                resultsContainer.innerHTML = `
                    <div style="padding: 1rem; text-align: center; color: var(--gray-500);">
                        No results found for "${query}"
                    </div>
                `;
            } else {
                const resultHTML = results.map(result => {
                    let icon, subtitle;
                    switch(result.type) {
                        case 'rfp':
                            icon = 'üìã';
                            subtitle = result.client;
                            break;
                        case 'work-order':
                            icon = 'üîß';
                            subtitle = result.client;
                            break;
                        case 'client':
                            icon = 'üè¢';
                            subtitle = result.location;
                            break;
                    }
                    
                    return `
                        <div class="search-result-item" style="padding: 0.75rem; border-bottom: 1px solid var(--gray-100); cursor: pointer; transition: background-color 0.15s;" 
                             onclick="selectSubcontractorSearchResult('${result.type}', '${result.id}')"
                             onmouseover="this.style.backgroundColor='var(--gray-50)'"
                             onmouseout="this.style.backgroundColor='white'">
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <span style="font-size: 1.25rem;">${icon}</span>
                                <div>
                                    <div style="font-weight: 600; color: var(--gray-900);">${result.title}</div>
                                    <div style="font-size: 0.875rem; color: var(--gray-600);">${subtitle}</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                resultsContainer.innerHTML = resultHTML;
            }
            
            resultsContainer.style.display = 'block';
        }
        
        function selectSubcontractorSearchResult(type, id) {
            hideSubcontractorSearchResults();
            document.getElementById('subcontractorGlobalSearch').value = '';
            
            // Navigate to the appropriate section
            switch(type) {
                case 'rfp':
                    showSection('rfps');
                    showToast(`Navigated to RFP ${id}`, 'info');
                    break;
                case 'work-order':
                    showSection('work-orders');
                    showToast(`Navigated to work order ${id}`, 'info');
                    break;
                case 'client':
                    showSection('dashboard');
                    showToast(`Navigated to client ${id}`, 'info');
                    break;
            }
        }
        
        function hideSubcontractorSearchResults() {
            document.getElementById('subcontractorSearchResults').style.display = 'none';
        }
        
        function handleSubcontractorSearchKeydown(event) {
            const resultsContainer = document.getElementById('subcontractorSearchResults');
            
            if (event.key === 'Escape') {
                hideSubcontractorSearchResults();
                document.getElementById('subcontractorGlobalSearch').blur();
            } else if (event.key === 'Enter') {
                const firstResult = resultsContainer.querySelector('.search-result-item');
                if (firstResult) {
                    firstResult.click();
                }
            }
        }
        
        // Keyboard shortcut for search (Ctrl+K) - subcontractor version
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                const searchInput = document.getElementById('subcontractorGlobalSearch');
                if (searchInput) {
                    searchInput.focus();
                }
            }
        });
        
        // Hide search results when clicking outside - subcontractor version
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.header-search')) {
                hideSubcontractorSearchResults();
            }
        });
        
        // Export subcontractor search functions
        window.handleSubcontractorGlobalSearch = handleSubcontractorGlobalSearch;
        window.handleSubcontractorSearchKeydown = handleSubcontractorSearchKeydown;
        window.selectSubcontractorSearchResult = selectSubcontractorSearchResult;
    </script>
</body>
</html>